
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fudge.processing.resonances.test.test_reconstructResonances &#8212; Fudge and GNDS 4.2.3 beta documentation</title>
    <link rel="stylesheet" href="../../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Fudge and GNDS 4.2.3 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.processing.resonances.test.test_reconstructResonances</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fudge.processing.resonances.test.test_reconstructResonances</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">fudge</span> <span class="kn">import</span> <span class="n">reactionSuite</span>
<span class="kn">from</span> <span class="nn">fudge.processing.resonances.reconstructResonances</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">fudge.processing.resonances.getCoulombWavefunctions</span> <span class="k">as</span> <span class="nn">getCoulombWavefunctions</span>


<span class="c1"># ----------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   Load the data files</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------------</span>

<span class="n">TEST_DATA_PATH</span><span class="p">,</span> <span class="n">this_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">DOFETESTS</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">brownies.BNL.restools</span>
    <span class="n">HAVEBRESTOOLS</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HAVEBRESTOOLS</span> <span class="o">=</span> <span class="kc">False</span>


<div class="viewcode-block" id="floatsAlmostEqual"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.floatsAlmostEqual">[docs]</a><span class="k">def</span> <span class="nf">floatsAlmostEqual</span><span class="p">(</span><span class="n">float1</span><span class="p">,</span> <span class="n">float2</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">float1</span> <span class="o">-</span> <span class="n">float2</span>
    <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">bigger</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">float1</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">float2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="n">bigger</span> <span class="o">*</span> <span class="n">epsilon</span></div>


<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading SLBWExample1SRes...&#39;</span><span class="p">)</span>
<span class="n">SLBWExample1SRes</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;SLBWExample1SRes_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading SLBWExample1PRes...&#39;</span><span class="p">)</span>
<span class="n">SLBWExample1PRes</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;SLBWExample1PRes_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading SLBWExample...&#39;</span><span class="p">)</span>
<span class="n">SLBWExample</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;SLBWExampleFull_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading MLBWExample...&#39;</span><span class="p">)</span>
<span class="n">MLBWExample</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;MLBWExampleFull_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading MLBWExample1PRes...&#39;</span><span class="p">)</span>
<span class="n">MLBWExample1PRes</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;MLBWExample1PRes_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading MLBWExampleZr90...&#39;</span><span class="p">)</span>
<span class="n">MLBWExampleZr90</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;MLBWExampleZr90_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading RMExample...&#39;</span><span class="p">)</span>
<span class="n">RMExample</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;RMExampleFull_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading RMExampleSmall...&#39;</span><span class="p">)</span>
<span class="n">RMExampleSmall</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;RMExampleSmall_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading RMLExample...&#39;</span><span class="p">)</span>
<span class="n">RMLExample</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;RMLExampleFull_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading RMLExampleSmall...&#39;</span><span class="p">)</span>
<span class="n">RMLExampleSmall</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;RMLExampleSmall_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">DOFETESTS</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reading RMLExampleFe...&#39;</span><span class="p">)</span>
    <span class="n">RMLExampleFe</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">readXML</span><span class="p">(</span><span class="n">TEST_DATA_PATH</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">+</span><span class="s1">&#39;RMLExampleFe_testFile.gnds.xml&#39;</span><span class="p">)</span>

<span class="c1"># ----------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   Assertion helper functions</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------------</span>

<span class="c1"># 0 degC   = 273.1 degK      = 0.0235339347844 eV since kB = 8.6173324e-5 eV/degK</span>
<span class="c1"># INTER uses 293.594338 degK = 2.53000E-02 eV</span>
<span class="c1"># RoomTemp = 295 degK        = 0.0254211305 eV</span>
<span class="c1">#            300 degK        = 0.0258519972 eV</span>


<div class="viewcode-block" id="complexString"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.complexString">[docs]</a><span class="k">def</span> <span class="nf">complexString</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;*e^&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestWithIsClose"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestWithIsClose">[docs]</a><span class="k">class</span> <span class="nc">TestWithIsClose</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestWithIsClose.assertWithinXPercent"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestWithIsClose.assertWithinXPercent">[docs]</a>    <span class="k">def</span> <span class="nf">assertWithinXPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">percent</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">absTol</span><span class="p">),</span> <span class="s1">&#39;a and b differ by </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestWithIsClose.assertAllWithinXPercent"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestWithIsClose.assertAllWithinXPercent">[docs]</a>    <span class="k">def</span> <span class="nf">assertAllWithinXPercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">aL</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bL</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">percent</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">absTol</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">aL</span><span class="p">,</span> <span class="n">bL</span><span class="p">)]),</span>
                        <span class="s1">&#39;Items in list not equal&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestWithIsClose.assertPQUEquivalent"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestWithIsClose.assertPQUEquivalent">[docs]</a>    <span class="k">def</span> <span class="nf">assertPQUEquivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;First argument not a PhysicalQuantity&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Second argument not a PhysicalQuantity&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">equivalent</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="s1">&#39;Arguments not within 1-sigma uncertainties of one another&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestWithIsClose.test_asserts"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestWithIsClose.test_asserts">[docs]</a>    <span class="k">def</span> <span class="nf">test_asserts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertPQUEquivalent</span><span class="p">(</span><span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.234e3</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">0.1e3</span><span class="p">),</span>
                                 <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">1.324</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="mf">1.234567</span><span class="p">,</span> <span class="mf">1.234568</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">)</span></div></div>


<span class="c1"># ----------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   The test cases</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="TestAngMomAdding"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAngMomAdding">[docs]</a><span class="k">class</span> <span class="nc">TestAngMomAdding</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestAngMomAdding.test_getAllowedTotalSpins"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAngMomAdding.test_getAllowedTotalSpins">[docs]</a>    <span class="k">def</span> <span class="nf">test_getAllowedTotalSpins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="p">[</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="TestChannelDesignator"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestChannelDesignator">[docs]</a><span class="k">class</span> <span class="nc">TestChannelDesignator</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestChannelDesignator.test_members"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestChannelDesignator.test_members">[docs]</a>    <span class="k">def</span> <span class="nf">test_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;He3&#39;</span><span class="p">,</span>
                              <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">gfact</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">particleA</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">particleB</span><span class="p">,</span> <span class="s1">&#39;He3&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">channelClass</span><span class="p">,</span> <span class="n">NEUTRONCHANNEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">useRelativistic</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">eliminated</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestChannelDesignator.test_equality"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestChannelDesignator.test_equality">[docs]</a>    <span class="k">def</span> <span class="nf">test_equality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ChannelDesignator</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;He3&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ChannelDesignator</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;He3&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestChannelDesignator.test_is_open"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestChannelDesignator.test_is_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Xi</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Fake threshold for testing</span>
        <span class="n">low_egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.002</span><span class="p">])</span>
        <span class="n">bad_egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.11</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span>
        <span class="n">hi_egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ChannelDesignator</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.875</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=</span><span class="n">Xi</span><span class="p">,</span>
                              <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_open</span><span class="p">(</span><span class="n">hi_egrid</span><span class="p">)))</span>  <span class="c1"># with hi_egrid, channel should all be open for all energies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_open</span><span class="p">(</span><span class="n">low_egrid</span><span class="p">)))</span>  <span class="c1"># with low_egrid, should all be closed for all energies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_open</span><span class="p">(</span><span class="n">bad_egrid</span><span class="p">)))</span>  <span class="c1"># with bad_egrid, the channel is open at some energies,</span>
                                                          <span class="c1"># closed at others.  A confusing situation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">is_open</span><span class="p">(</span><span class="n">bad_egrid</span><span class="p">)))</span></div></div>


<div class="viewcode-block" id="TestResonanceReconstruction"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction">[docs]</a><span class="k">class</span> <span class="nc">TestResonanceReconstruction</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestResonanceReconstruction.test_SLBWReconstructResonances"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction.test_SLBWReconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">test_SLBWReconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="p">(</span><span class="n">SLBWExample</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span><span class="p">})</span>
        <span class="c1"># Test thermal point and a few others, computed below</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">1.18726303</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">7.24518429</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">6.05792126</span><span class="p">}),</span>
            <span class="p">(</span><span class="mf">1009.0</span><span class="p">,</span>          <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">290.05432779892004</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">507.80854074065803</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                               <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">217.75421294173799</span><span class="p">})]</span>
        <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="c1"># next line gets either 2 sig figs or 2 digits</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">2e-3</span><span class="p">))</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">x</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestResonanceReconstruction.test_MLBWReconstructResonances"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction.test_MLBWReconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">test_MLBWReconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="p">(</span><span class="n">MLBWExample</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span><span class="p">})</span>
        <span class="c1"># Test thermal point, computed below</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">0.00015987</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">3.11326583</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">3.11310596</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="c1"># the following gets either 2 sig figs or 2 digits</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">),</span> <span class="mf">2e-3</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestResonanceReconstruction.test_RMReconstructResonances"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction.test_RMReconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">test_RMReconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="p">(</span><span class="n">RMExample</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span><span class="p">})</span>
        <span class="c1"># Test 0 deg C point</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">0.17536290484357434</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">2.1313431546619341</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                  <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">1.9559802498183596</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">),</span> <span class="mf">2e-3</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestResonanceReconstruction.test_RMLReconstructResonances"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction.test_RMLReconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">test_RMLReconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="p">(</span><span class="n">RMLExample</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span><span class="p">})</span>
        <span class="c1"># Test thermal point, computed below</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">45.04182664</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">66.22034846</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">20.68451381</span><span class="p">,</span>
                  <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span> <span class="mf">0.49400801</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">),</span> <span class="mf">2e-3</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestResonanceReconstruction.test_URRReconstructResonances"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestResonanceReconstruction.test_URRReconstructResonances">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;didn&#39;t write the test yet&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_URRReconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="p">(</span><span class="n">RMLExample</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">})</span>
        <span class="c1"># Test thermal point, computed below</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">2.5e-4</span><span class="p">),</span> <span class="mf">11.5362133</span><span class="p">,</span> <span class="mf">2e-3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;fission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="mf">2.5e-4</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">2.5e-4</span><span class="p">),</span> <span class="mf">0.29962655</span><span class="p">,</span> <span class="mf">2e-3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">2.5e-4</span><span class="p">),</span> <span class="mf">11.23658675</span><span class="p">,</span> <span class="mf">2e-3</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="TestSLBWClassAndBaseClasses"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses">[docs]</a><span class="k">class</span> <span class="nc">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span> <span class="o">=</span> <span class="n">SLBWcrossSection</span><span class="p">(</span><span class="n">SLBWExample</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span> <span class="o">=</span> <span class="n">SLBWcrossSection</span><span class="p">(</span><span class="n">SLBWExample1SRes</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span> <span class="o">=</span> <span class="n">SLBWcrossSection</span><span class="p">(</span><span class="n">SLBWExample1PRes</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">projectile</span><span class="p">),</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetSpin</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;Nb93&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="p">,</span> <span class="mf">92.1051</span><span class="p">),</span> <span class="mf">1e-7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="mf">1e-05</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="mf">7350.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">missingGfactor</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Js&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;gfact&#39;</span><span class="p">,</span> <span class="s1">&#39;channelSpins&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gfact&#39;</span><span class="p">],</span> <span class="mf">0.35</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                         <span class="p">{</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;channelSpin&#39;</span><span class="p">,</span> <span class="s1">&#39;captureWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fissionWidthB&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;shiftFactor&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;J&#39;</span><span class="p">],</span> <span class="mf">3.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">),</span> <span class="p">[</span><span class="o">-</span><span class="mf">105.4</span><span class="p">,</span> <span class="mf">35.9</span><span class="p">,</span> <span class="mf">42.3</span><span class="p">,</span> <span class="mf">94.3</span><span class="p">,</span> <span class="mf">105.8</span><span class="p">,</span>
                                                    <span class="mf">119.2</span><span class="p">,</span> <span class="mf">193.</span><span class="p">,</span> <span class="mf">244.</span><span class="p">,</span> <span class="mf">319.</span><span class="p">,</span> <span class="mf">335.5</span><span class="p">,</span>
                                                    <span class="mf">363.</span><span class="p">,</span> <span class="mf">365.</span><span class="p">,</span> <span class="mf">378.4</span><span class="p">,</span> <span class="mf">392.6</span><span class="p">,</span> <span class="mf">460.3</span><span class="p">,</span>
                                                    <span class="mf">500.6</span><span class="p">,</span> <span class="mf">599.2001</span><span class="p">,</span> <span class="mf">604.</span><span class="p">,</span> <span class="mf">617.6</span><span class="p">,</span> <span class="mf">640.9001</span><span class="p">,</span>
                                                    <span class="mf">672.</span><span class="p">,</span> <span class="mf">678.3</span><span class="p">,</span> <span class="mf">721.4001</span><span class="p">,</span> <span class="mf">741.5002</span><span class="p">,</span> <span class="mf">757.3</span><span class="p">,</span>
                                                    <span class="mf">912.5002</span><span class="p">,</span> <span class="mf">934.8002</span><span class="p">,</span> <span class="mf">952.9002</span><span class="p">,</span> <span class="mf">1009.</span><span class="p">,</span> <span class="mf">1016.</span><span class="p">,</span>
                                                    <span class="mf">1108.</span><span class="p">,</span> <span class="mf">1127.</span><span class="p">,</span> <span class="mf">1148.</span><span class="p">,</span> <span class="mf">1175.</span><span class="p">,</span> <span class="mf">1194.</span><span class="p">,</span>
                                                    <span class="mf">1229.</span><span class="p">,</span> <span class="mf">1243.</span><span class="p">,</span> <span class="mf">1284.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mf">1354.</span><span class="p">,</span>
                                                    <span class="mf">1393.</span><span class="p">,</span> <span class="mf">1452.</span><span class="p">,</span> <span class="mf">1467.</span><span class="p">,</span> <span class="mf">1529.</span><span class="p">,</span> <span class="mf">1540.</span><span class="p">,</span>
                                                    <span class="mf">1556.</span><span class="p">,</span> <span class="mf">1576.</span><span class="p">,</span> <span class="mf">1616.</span><span class="p">,</span> <span class="mf">1654.</span><span class="p">,</span> <span class="mf">1678.</span><span class="p">,</span>
                                                    <span class="mf">1712.</span><span class="p">,</span> <span class="mf">1768.</span><span class="p">,</span> <span class="mf">1811.</span><span class="p">,</span> <span class="mf">1833.</span><span class="p">,</span> <span class="mf">1946.</span><span class="p">,</span>
                                                    <span class="mf">1981.</span><span class="p">,</span> <span class="mf">1991.</span><span class="p">,</span> <span class="mf">2021.</span><span class="p">,</span> <span class="mf">2070.</span><span class="p">,</span> <span class="mf">2076.</span><span class="p">,</span>
                                                    <span class="mf">2117.</span><span class="p">,</span> <span class="mf">2147.</span><span class="p">,</span> <span class="mf">2155.</span><span class="p">,</span> <span class="mf">2186.</span><span class="p">,</span> <span class="mf">2230.</span><span class="p">,</span>
                                                    <span class="mf">2310.</span><span class="p">,</span> <span class="mf">2335.</span><span class="p">,</span> <span class="mf">2341.</span><span class="p">,</span> <span class="mf">2360.</span><span class="p">,</span> <span class="mf">2392.</span><span class="p">,</span>
                                                    <span class="mf">2420.</span><span class="p">,</span> <span class="mf">2455.</span><span class="p">,</span> <span class="mf">2465.</span><span class="p">,</span> <span class="mf">2509.</span><span class="p">,</span> <span class="mf">2544.</span><span class="p">,</span>
                                                    <span class="mf">2577.</span><span class="p">,</span> <span class="mf">2641.</span><span class="p">,</span> <span class="mf">2657.</span><span class="p">,</span> <span class="mf">2689.</span><span class="p">,</span> <span class="mf">2712.</span><span class="p">,</span>
                                                    <span class="mf">2755.</span><span class="p">,</span> <span class="mf">2836.</span><span class="p">,</span> <span class="mf">2927.</span><span class="p">,</span> <span class="mf">2943.</span><span class="p">,</span> <span class="mf">2953.</span><span class="p">,</span>
                                                    <span class="mf">2987.</span><span class="p">,</span> <span class="mf">2995.</span><span class="p">,</span> <span class="mf">3002.</span><span class="p">,</span> <span class="mf">3140.</span><span class="p">,</span> <span class="mf">3149.</span><span class="p">,</span>
                                                    <span class="mf">3229.</span><span class="p">,</span> <span class="mf">3259.</span><span class="p">,</span> <span class="mf">3275.</span><span class="p">,</span> <span class="mf">3285.</span><span class="p">,</span> <span class="mf">3359.</span><span class="p">,</span>
                                                    <span class="mf">3378.</span><span class="p">,</span> <span class="mf">3396.</span><span class="p">,</span> <span class="mf">3411.</span><span class="p">,</span> <span class="mf">3426.</span><span class="p">,</span> <span class="mf">3503.</span><span class="p">,</span>
                                                    <span class="mf">3525.</span><span class="p">,</span> <span class="mf">3592.</span><span class="p">,</span> <span class="mf">3609.</span><span class="p">,</span> <span class="mf">3624.</span><span class="p">,</span> <span class="mf">3655.</span><span class="p">,</span>
                                                    <span class="mf">3675.</span><span class="p">,</span> <span class="mf">3763.</span><span class="p">,</span> <span class="mf">3814.</span><span class="p">,</span> <span class="mf">3844.</span><span class="p">,</span> <span class="mf">3920.</span><span class="p">,</span>
                                                    <span class="mf">3927.</span><span class="p">,</span> <span class="mf">3946.</span><span class="p">,</span> <span class="mf">3977.</span><span class="p">,</span> <span class="mf">3987.</span><span class="p">,</span> <span class="mf">4026.</span><span class="p">,</span>
                                                    <span class="mf">4041.</span><span class="p">,</span> <span class="mf">4069.</span><span class="p">,</span> <span class="mf">4079.</span><span class="p">,</span> <span class="mf">4109.</span><span class="p">,</span> <span class="mf">4145.</span><span class="p">,</span>
                                                    <span class="mf">4232.</span><span class="p">,</span> <span class="mf">4295.</span><span class="p">,</span> <span class="mf">4307.</span><span class="p">,</span> <span class="mf">4349.</span><span class="p">,</span> <span class="mf">4359.</span><span class="p">,</span>
                                                    <span class="mf">4405.</span><span class="p">,</span> <span class="mf">4425.</span><span class="p">,</span> <span class="mf">4452.</span><span class="p">,</span> <span class="mf">4498.</span><span class="p">,</span> <span class="mf">4544.</span><span class="p">,</span>
                                                    <span class="mf">4557.</span><span class="p">,</span> <span class="mf">4599.</span><span class="p">,</span> <span class="mf">4660.</span><span class="p">,</span> <span class="mf">4696.</span><span class="p">,</span> <span class="mf">4779.</span><span class="p">,</span>
                                                    <span class="mf">4812.</span><span class="p">,</span> <span class="mf">4826.</span><span class="p">,</span> <span class="mf">4874.</span><span class="p">,</span> <span class="mf">4892.</span><span class="p">,</span> <span class="mf">4918.</span><span class="p">,</span>
                                                    <span class="mf">4934.</span><span class="p">,</span> <span class="mf">5008.</span><span class="p">,</span> <span class="mf">5045.</span><span class="p">,</span> <span class="mf">5067.</span><span class="p">,</span> <span class="mf">5125.</span><span class="p">,</span>
                                                    <span class="mf">5153.</span><span class="p">,</span> <span class="mf">5178.</span><span class="p">,</span> <span class="mf">5292.</span><span class="p">,</span> <span class="mf">5422.</span><span class="p">,</span> <span class="mf">5467.</span><span class="p">,</span>
                                                    <span class="mf">5487.</span><span class="p">,</span> <span class="mf">5510.</span><span class="p">,</span> <span class="mf">5550.</span><span class="p">,</span> <span class="mf">5579.</span><span class="p">,</span> <span class="mf">5659.</span><span class="p">,</span>
                                                    <span class="mf">5691.</span><span class="p">,</span> <span class="mf">5702.</span><span class="p">,</span> <span class="mf">5720.</span><span class="p">,</span> <span class="mf">5792.</span><span class="p">,</span> <span class="mf">5811.</span><span class="p">,</span>
                                                    <span class="mf">5835.</span><span class="p">,</span> <span class="mf">5862.</span><span class="p">,</span> <span class="mf">5902.</span><span class="p">,</span> <span class="mf">6003.</span><span class="p">,</span> <span class="mf">6051.</span><span class="p">,</span>
                                                    <span class="mf">6072.</span><span class="p">,</span> <span class="mf">6097.</span><span class="p">,</span> <span class="mf">6114.</span><span class="p">,</span> <span class="mf">6169.</span><span class="p">,</span> <span class="mf">6180.</span><span class="p">,</span>
                                                    <span class="mf">6327.</span><span class="p">,</span> <span class="mf">6412.</span><span class="p">,</span> <span class="mf">6427.</span><span class="p">,</span> <span class="mf">6456.</span><span class="p">,</span> <span class="mf">6480.</span><span class="p">,</span>
                                                    <span class="mf">6532.</span><span class="p">,</span> <span class="mf">6551.</span><span class="p">,</span> <span class="mf">6571.</span><span class="p">,</span> <span class="mf">6590.</span><span class="p">,</span> <span class="mf">6714.</span><span class="p">,</span>
                                                    <span class="mf">6739.</span><span class="p">,</span> <span class="mf">6751.</span><span class="p">,</span> <span class="mf">6780.</span><span class="p">,</span> <span class="mf">6795.</span><span class="p">,</span> <span class="mf">6843.</span><span class="p">,</span>
                                                    <span class="mf">6881.</span><span class="p">,</span> <span class="mf">6911.</span><span class="p">,</span> <span class="mf">6935.</span><span class="p">,</span> <span class="mf">6976.</span><span class="p">,</span> <span class="mf">7077.</span><span class="p">,</span>
                                                    <span class="mf">7136.</span><span class="p">,</span> <span class="mf">7244.</span><span class="p">,</span> <span class="mf">7306.</span><span class="p">,</span> <span class="mf">7331.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">),</span> <span class="p">[</span><span class="mf">0.5441</span><span class="p">,</span> <span class="mf">0.2091</span><span class="p">,</span> <span class="mf">0.2221</span><span class="p">,</span> <span class="mf">0.1805</span><span class="p">,</span> <span class="mf">0.1675</span><span class="p">,</span> <span class="mf">0.1286</span><span class="p">,</span> <span class="mf">0.1678</span><span class="p">,</span>
                                                  <span class="mf">0.2474</span><span class="p">,</span> <span class="mf">0.2217</span><span class="p">,</span> <span class="mf">0.1748</span><span class="p">,</span> <span class="mf">0.1352</span><span class="p">,</span> <span class="mf">0.1505</span><span class="p">,</span> <span class="mf">0.2713</span><span class="p">,</span> <span class="mf">0.2019</span><span class="p">,</span>
                                                  <span class="mf">0.1691</span><span class="p">,</span> <span class="mf">0.2293</span><span class="p">,</span> <span class="mf">0.1463</span><span class="p">,</span> <span class="mf">0.1626</span><span class="p">,</span> <span class="mf">0.1517</span><span class="p">,</span> <span class="mf">0.1559</span><span class="p">,</span> <span class="mf">0.2268</span><span class="p">,</span>
                                                  <span class="mf">0.1379</span><span class="p">,</span> <span class="mf">0.2659</span><span class="p">,</span> <span class="mf">0.3401</span><span class="p">,</span> <span class="mf">0.2519</span><span class="p">,</span> <span class="mf">0.2043</span><span class="p">,</span> <span class="mf">0.5191</span><span class="p">,</span> <span class="mf">0.2481</span><span class="p">,</span>
                                                  <span class="mf">1.414</span><span class="p">,</span> <span class="mf">0.2805</span><span class="p">,</span> <span class="mf">0.2544</span><span class="p">,</span> <span class="mf">0.2485</span><span class="p">,</span> <span class="mf">0.3094</span><span class="p">,</span> <span class="mf">0.5576</span><span class="p">,</span> <span class="mf">0.2098</span><span class="p">,</span>
                                                  <span class="mf">0.1946</span><span class="p">,</span> <span class="mf">0.2633</span><span class="p">,</span> <span class="mf">0.2448</span><span class="p">,</span> <span class="mf">0.2853</span><span class="p">,</span> <span class="mf">0.2608</span><span class="p">,</span> <span class="mf">0.3624</span><span class="p">,</span> <span class="mf">1.176</span><span class="p">,</span>
                                                  <span class="mf">0.2884</span><span class="p">,</span> <span class="mf">0.2328</span><span class="p">,</span> <span class="mf">0.2706</span><span class="p">,</span> <span class="mf">0.2729</span><span class="p">,</span> <span class="mf">0.3366</span><span class="p">,</span> <span class="mf">0.2701</span><span class="p">,</span> <span class="mf">0.2199</span><span class="p">,</span>
                                                  <span class="mf">0.2181</span><span class="p">,</span> <span class="mf">0.249</span><span class="p">,</span> <span class="mf">0.1797</span><span class="p">,</span> <span class="mf">0.2144</span><span class="p">,</span> <span class="mf">1.026</span><span class="p">,</span> <span class="mf">0.2619</span><span class="p">,</span> <span class="mf">0.2573</span><span class="p">,</span>
                                                  <span class="mf">0.1299</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">,</span> <span class="mf">0.3127</span><span class="p">,</span> <span class="mf">0.3237</span><span class="p">,</span> <span class="mf">0.2996</span><span class="p">,</span> <span class="mf">0.2761</span><span class="p">,</span> <span class="mf">0.4102</span><span class="p">,</span>
                                                  <span class="mf">0.2453</span><span class="p">,</span> <span class="mf">0.2305</span><span class="p">,</span> <span class="mf">0.1656</span><span class="p">,</span> <span class="mf">0.2166</span><span class="p">,</span> <span class="mf">0.5857</span><span class="p">,</span> <span class="mf">0.2062</span><span class="p">,</span> <span class="mf">0.1683</span><span class="p">,</span>
                                                  <span class="mf">2.19</span><span class="p">,</span> <span class="mf">0.1923</span><span class="p">,</span> <span class="mf">0.2908</span><span class="p">,</span> <span class="mf">0.5917</span><span class="p">,</span> <span class="mf">0.2131</span><span class="p">,</span> <span class="mf">0.2049</span><span class="p">,</span> <span class="mf">3.549</span><span class="p">,</span>
                                                  <span class="mf">0.1993</span><span class="p">,</span> <span class="mf">0.1391</span><span class="p">,</span> <span class="mf">0.2622</span><span class="p">,</span> <span class="mf">0.1264</span><span class="p">,</span> <span class="mf">0.1857</span><span class="p">,</span> <span class="mf">0.4533</span><span class="p">,</span> <span class="mf">0.1258</span><span class="p">,</span>
                                                  <span class="mf">0.6692</span><span class="p">,</span> <span class="mf">0.1829</span><span class="p">,</span> <span class="mf">0.1385</span><span class="p">,</span> <span class="mf">0.1245</span><span class="p">,</span> <span class="mf">0.1993</span><span class="p">,</span> <span class="mf">0.1414</span><span class="p">,</span> <span class="mf">0.1902</span><span class="p">,</span>
                                                  <span class="mf">0.1918</span><span class="p">,</span> <span class="mf">0.232</span><span class="p">,</span> <span class="mf">0.2052</span><span class="p">,</span> <span class="mf">0.4289</span><span class="p">,</span> <span class="mf">0.232</span><span class="p">,</span> <span class="mf">1.234</span><span class="p">,</span> <span class="mf">0.1811</span><span class="p">,</span>
                                                  <span class="mf">0.1852</span><span class="p">,</span> <span class="mf">0.1662</span><span class="p">,</span> <span class="mf">1.051</span><span class="p">,</span> <span class="mf">0.1883</span><span class="p">,</span> <span class="mf">0.4518</span><span class="p">,</span> <span class="mf">0.1652</span><span class="p">,</span> <span class="mf">0.1239</span><span class="p">,</span>
                                                  <span class="mf">2.077</span><span class="p">,</span> <span class="mf">0.5524</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.3877</span><span class="p">,</span> <span class="mf">0.1768</span><span class="p">,</span> <span class="mf">0.237</span><span class="p">,</span> <span class="mf">0.4452</span><span class="p">,</span>
                                                  <span class="mf">1.014</span><span class="p">,</span> <span class="mf">0.1981</span><span class="p">,</span> <span class="mf">0.172</span><span class="p">,</span> <span class="mf">0.3563</span><span class="p">,</span> <span class="mf">1.661</span><span class="p">,</span> <span class="mf">0.126</span><span class="p">,</span> <span class="mf">0.1273</span><span class="p">,</span>
                                                  <span class="mf">0.1989</span><span class="p">,</span> <span class="mf">0.1852</span><span class="p">,</span> <span class="mf">0.1987</span><span class="p">,</span> <span class="mf">0.1308</span><span class="p">,</span> <span class="mf">0.2084</span><span class="p">,</span> <span class="mf">0.1359</span><span class="p">,</span> <span class="mf">0.1394</span><span class="p">,</span>
                                                  <span class="mf">0.1288</span><span class="p">,</span> <span class="mf">0.1811</span><span class="p">,</span> <span class="mf">0.1369</span><span class="p">,</span> <span class="mf">0.199</span><span class="p">,</span> <span class="mf">0.3981</span><span class="p">,</span> <span class="mf">3.422</span><span class="p">,</span> <span class="mf">0.1412</span><span class="p">,</span>
                                                  <span class="mf">0.1659</span><span class="p">,</span> <span class="mf">0.173</span><span class="p">,</span> <span class="mf">0.3311</span><span class="p">,</span> <span class="mf">0.2407</span><span class="p">,</span> <span class="mf">0.1316</span><span class="p">,</span> <span class="mf">0.126</span><span class="p">,</span> <span class="mf">0.1852</span><span class="p">,</span>
                                                  <span class="mf">0.162</span><span class="p">,</span> <span class="mf">0.1592</span><span class="p">,</span> <span class="mf">0.5657</span><span class="p">,</span> <span class="mf">0.2717</span><span class="p">,</span> <span class="mf">0.1239</span><span class="p">,</span> <span class="mf">5.676</span><span class="p">,</span> <span class="mf">0.7652</span><span class="p">,</span>
                                                  <span class="mf">0.2151</span><span class="p">,</span> <span class="mf">0.1312</span><span class="p">,</span> <span class="mf">0.3591</span><span class="p">,</span> <span class="mf">0.2596</span><span class="p">,</span> <span class="mf">0.4405</span><span class="p">,</span> <span class="mf">1.11</span><span class="p">,</span> <span class="mf">0.6379</span><span class="p">,</span>
                                                  <span class="mf">1.152</span><span class="p">,</span> <span class="mf">1.946</span><span class="p">,</span> <span class="mf">0.1808</span><span class="p">,</span> <span class="mf">0.1547</span><span class="p">,</span> <span class="mf">0.4909</span><span class="p">,</span> <span class="mf">0.1362</span><span class="p">,</span> <span class="mf">0.2297</span><span class="p">,</span>
                                                  <span class="mf">0.8586</span><span class="p">,</span> <span class="mf">2.14</span><span class="p">,</span> <span class="mf">2.996</span><span class="p">,</span> <span class="mf">1.906</span><span class="p">,</span> <span class="mf">0.2864</span><span class="p">,</span> <span class="mf">0.1269</span><span class="p">,</span> <span class="mf">0.9702</span><span class="p">,</span>
                                                  <span class="mf">0.2786</span><span class="p">,</span> <span class="mf">0.2784</span><span class="p">,</span> <span class="mf">0.1338</span><span class="p">,</span> <span class="mf">0.3964</span><span class="p">,</span> <span class="mf">1.579</span><span class="p">,</span> <span class="mf">0.1349</span><span class="p">,</span> <span class="mf">0.1351</span><span class="p">,</span>
                                                  <span class="mf">3.629</span><span class="p">,</span> <span class="mf">0.1722</span><span class="p">,</span> <span class="mf">1.563</span><span class="p">,</span> <span class="mf">0.136</span><span class="p">,</span> <span class="mf">1.335</span><span class="p">,</span> <span class="mf">0.5289</span><span class="p">,</span> <span class="mf">0.1692</span><span class="p">,</span>
                                                  <span class="mf">0.4309</span><span class="p">,</span> <span class="mf">0.9733</span><span class="p">,</span> <span class="mf">0.287</span><span class="p">,</span> <span class="mf">0.1856</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.4838</span><span class="p">,</span> <span class="mf">4.723</span><span class="p">,</span>
                                                  <span class="mf">0.2183</span><span class="p">,</span> <span class="mf">0.3123</span><span class="p">,</span> <span class="mf">2.593</span><span class="p">,</span> <span class="mf">0.133</span><span class="p">,</span> <span class="mf">0.3627</span><span class="p">])</span>  <span class="c1"># total widths</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_k"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_k">[docs]</a>    <span class="k">def</span> <span class="nf">test_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="mf">1000.</span><span class="p">),</span> <span class="mf">2.196807122623e-3</span> <span class="o">*</span> <span class="mf">93.</span> <span class="o">/</span> <span class="mf">94.</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1000.</span><span class="p">),</span> <span class="mf">1e-4</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_rho"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_rho">[docs]</a>    <span class="k">def</span> <span class="nf">test_rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">calculateChannelRadius</span><span class="p">)</span>  <span class="c1"># This deactivates L dependent rho&#39;s because we</span>
                                                 <span class="c1"># compute the constant channel radius</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">0.123</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">reactionSuite</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.6370771040638685</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="mf">1000.</span><span class="p">),</span> <span class="n">k</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_penetrationFactor"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_penetrationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_penetrationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.043781852422548007</span>  <span class="c1"># for E=1000. eV, and a computed as 0.6370771040638685 fm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="n">rho</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">9.</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span>
                               <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">225.</span> <span class="o">+</span> <span class="mf">45.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">+</span> <span class="mf">6.</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_shiftFactor"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_shiftFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_shiftFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.043781852422548007</span>  <span class="c1"># for E=1000. eV, and a computed as 0.6370771040638685 fm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span>
                               <span class="o">-</span><span class="p">(</span><span class="mf">18.</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">9.</span> <span class="o">+</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="mf">675.</span> <span class="o">+</span> <span class="mf">90.</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">6.</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="mf">225.</span> <span class="o">+</span> <span class="mf">45.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">+</span> <span class="mf">6.</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_phi"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_phi">[docs]</a>    <span class="k">def</span> <span class="nf">test_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.043781852422548007</span>  <span class="c1"># for E=1000. eV, and a computed as 0.6370771040638685 fm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="n">rho</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="n">rho</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span> <span class="n">rho</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">-</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span>
                               <span class="n">rho</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">((</span><span class="mf">15.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">15.</span> <span class="o">-</span> <span class="mf">6.</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">rho</span><span class="p">)))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_eiphi"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_eiphi">[docs]</a>    <span class="k">def</span> <span class="nf">test_eiphi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">E</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">answer</span> <span class="ow">in</span> <span class="p">[(</span><span class="mf">1009.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.99903310472611739</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.043964254358450666</span><span class="p">)),</span>
                             <span class="p">(</span><span class="mf">35.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.9999999999999819</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9027638215908413e-07</span><span class="p">))]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">)))),</span> <span class="n">answer</span><span class="p">,</span>
                                      <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_ERp_SWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_ERp_SWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_ERp_SWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ER</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">)]:</span>
            <span class="n">ERp</span> <span class="o">=</span> <span class="n">ER</span> <span class="o">+</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">)))</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">))))</span>
            <span class="n">spin_thingee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ERp_correct</span> <span class="o">=</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;shiftFactor&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ERp</span><span class="p">,</span> <span class="n">ERp_correct</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_ERp_PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_ERp_PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_ERp_PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ER</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">)]:</span>
            <span class="n">ERp</span> <span class="o">=</span> <span class="n">ER</span> <span class="o">+</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">)))</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">))))</span>
            <span class="n">spin_thingee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">))),</span>
                                   <span class="mf">2.0</span> <span class="o">*</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;shiftFactor&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">GN</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">))),</span>
                                   <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">])</span>
            <span class="n">ERp_correct</span> <span class="o">=</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;shiftFactor&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ERp</span><span class="p">,</span> <span class="n">ERp_correct</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_GN_of_E_SWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_GN_of_E_SWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_GN_of_E_SWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ER</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">)]:</span>
            <span class="n">GamN</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">*</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="o">/</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">)))</span>
            <span class="n">spin_thingee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">GamN_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="o">*</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">GamN</span><span class="p">,</span> <span class="n">GamN_correct</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_GN_of_E_PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_GN_of_E_PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_GN_of_E_PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">cc</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">cc</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ER</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">)]:</span>
            <span class="n">GamN</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">*</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="o">/</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ER</span><span class="p">)))</span>
            <span class="n">spin_thingee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">GamN_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="o">*</span> <span class="n">spin_thingee</span><span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">GamN</span><span class="p">,</span> <span class="n">GamN_correct</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_refineInterpolation"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_refineInterpolation">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;didn&#39;t write the test yet&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_refineInterpolation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">refineInterpolation</span><span class="p">(</span><span class="n">egrid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xsecs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_generateEnergyGrid"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_generateEnergyGrid">[docs]</a>    <span class="k">def</span> <span class="nf">test_generateEnergyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mf">1e-05</span><span class="p">,</span> <span class="mf">1.2578278491146621e-05</span><span class="p">,</span> <span class="mf">1.582130898008417e-05</span><span class="p">,</span> <span class="mf">1.9900483044597718e-05</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.00039259005767352531</span><span class="p">,</span> <span class="mf">0.00049381070782729094</span><span class="p">,</span> <span class="mf">0.00062112886049619012</span><span class="p">,</span>
                                        <span class="mf">0.0007812731786209638</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="p">[</span><span class="mf">7347.6841999999997</span><span class="p">,</span> <span class="mf">7348.4096</span><span class="p">,</span> <span class="mf">7349.1350000000002</span><span class="p">,</span> <span class="mf">7350.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span> <span class="mi">60219</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_setResonanceParametersByChannel"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_setResonanceParametersByChannel">[docs]</a>    <span class="k">def</span> <span class="nf">test_setResonanceParametersByChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">cDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cDict</span><span class="p">),</span> <span class="mi">194</span><span class="p">)</span>  <span class="c1"># This is number of SLBW &quot;levels&quot;.</span>
                                           <span class="c1"># With only 2 reactions, better be 1/2 the number of channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">),</span> <span class="mi">194</span><span class="p">)</span>  <span class="c1"># This is number of SLBW &quot;levels&quot;.</span>
                                                        <span class="c1"># Better equal the _energies array of level energies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">cDict</span><span class="p">]),</span> <span class="mi">434</span><span class="p">)</span>  <span class="c1"># this is number of channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.45000000000000001</span><span class="p">,</span>
                                           <span class="n">particleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span>
                                           <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">[(</span><span class="o">-</span><span class="mf">105.4</span><span class="p">,</span> <span class="mf">0.165</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="p">[</span><span class="mi">193</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">[(</span><span class="mf">7331.0</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">)):</span>
            <span class="c1"># Check all the channels have the right resonance energy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># Check all the widths for a level add up to the tabulated total</span>
            <span class="n">GT</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">floatsAlmostEqual</span><span class="p">(</span><span class="n">GT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">2e-3</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Each level in the SLBW parameterization should have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the</span>
<span class="sd">              identity matrix is sqrt( ndim )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">)</span>
        <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-04</span>  <span class="c1"># nominal value: 1e-03</span>
        <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-05</span>  <span class="c1"># nominal value: 1e-04</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">U</span><span class="p">:</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)])</span>
            <span class="n">testResult</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">one</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">testResult</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  U:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">U^+:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Frobenius norm:&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">testResult</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue0"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue0">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUValue0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On resonance nearest to 1 keV of evaluation with many resonances&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="mf">1009.0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">eiphi</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.99903310472611739</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.043964254358450666</span><span class="p">)</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="mf">0.813</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="mf">0.6011</span>
        <span class="n">GT</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">+</span> <span class="n">GG</span>  <span class="c1"># 1.414</span>
        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="n">cN</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">GN</span><span class="p">)</span>  <span class="c1"># Pick out GN from channels for 28th level.  Better be a match!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>  <span class="c1"># one for each GN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">28</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GG</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue1"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue1">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUValue1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On first resonance &gt; 0 of evaluation with many resonances&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="mf">35.9</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">eiphi</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.9999999999999819</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9027638215908413e-07</span><span class="p">)</span>  <span class="c1"># one for each GN</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="mf">0.209</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="mf">0.0001018</span>
        <span class="n">GT</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">+</span> <span class="n">GG</span>  <span class="c1"># 0.2091</span>
        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">cN</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">GN</span><span class="p">)</span>  <span class="c1"># Pick out GN from channels for 1st level.  Better be a match!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GG</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1S"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1S">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUValue_1S</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On first resonance &gt; 0, it is an S wave resonance of evaluation with one resonance&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>  <span class="c1"># eV</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">ER</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">ER</span><span class="p">))</span>
        <span class="n">eiphi</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">phi</span><span class="p">))</span>  <span class="c1"># one for each GN</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="mf">7.96e-2</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="mf">5.88e-4</span>
        <span class="n">GT</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">+</span> <span class="n">GG</span>  <span class="c1"># 8.0188e-2</span>
        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cN</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">GN</span><span class="p">)</span>  <span class="c1"># Pick out GN from channels for 0th level.  Better match!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GG</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1P"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1P">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUValue_1P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On first resonance &gt; 0, it is an P wave resonance of evaluation with one resonance&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span><span class="n">multipleSScheme</span><span class="o">=</span><span class="s1">&#39;NJOY&#39;</span><span class="p">)</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>  <span class="c1"># eV</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">ER</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">ER</span><span class="p">))</span>
        <span class="n">eiphi</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">phi</span><span class="p">))</span>  <span class="c1"># one for each GN</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="mf">7.96e-2</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="mf">5.88e-4</span>
        <span class="n">GT</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">+</span> <span class="n">GG</span>  <span class="c1"># 8.0188e-2</span>
        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cN</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">GN</span><span class="p">)</span>  <span class="c1"># Pick out GN from channels for 0th level.  Better match!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GG</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_SWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_SWave">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_SWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iN</span><span class="p">,</span> <span class="n">iG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># indices for the neutron and capture channels ( this is the order I packed them in )</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>  <span class="c1"># eV</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.63809</span>  <span class="c1"># in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">S Wave, g-factor (fudge)=&#39;</span><span class="p">,</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   SigNeuU (b)    &#39;</span> <span class="o">+</span>
            <span class="s1">&#39;SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  dSigPotActual/dSigPotCalc  &#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">():</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">nLs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">gs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">sigTotWithU</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iG</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iG</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">nLs</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">gs</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span>
                            <span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span>
                             <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span>
                             <span class="o">-</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">-</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sigPot</span><span class="p">))</span>

            <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">)</span>

            <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">)</span>

            <span class="c1"># Check agree with getCrossSection()</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_PWave">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iN</span><span class="p">,</span> <span class="n">iG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># indices for the neutron and capture channels ( this is the order I packed them in )</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>  <span class="c1"># eV</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.63809</span>  <span class="c1"># in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">P Wave, g-factor (fudge)=&#39;</span><span class="p">,</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   SigNeuU (b)    &#39;</span> <span class="o">+</span>
            <span class="s1">&#39;SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  dSigPotActual/dSigPotCalc &#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">():</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">nLs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">gs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span>
            <span class="n">sigTotWithU</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iG</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iG</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">nLs</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> <span class="n">gs</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">-</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sigPot</span><span class="p">))</span>

            <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">)</span>

            <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">)</span>

            <span class="c1"># Check agree with getCrossSection()</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">nLev</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.69</span>  <span class="c1"># in b^{-1/2}</span>
        <span class="n">allowedSs</span> <span class="o">=</span> <span class="n">getAllowedTotalSpins</span><span class="p">(</span><span class="mi">9</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All Waves (course grid), </span><span class="si">%i</span><span class="s1"> resonances&#39;</span> <span class="o">%</span> <span class="n">nLev</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   SigNeuU (b)    &#39;</span> <span class="o">+</span>
            <span class="s1">&#39;SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  dSigPotActual/dSigPotCalc &#39;</span><span class="p">)</span>

        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># int( len( egrid )/95)</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="mf">7300.</span> <span class="ow">and</span> <span class="n">E</span> <span class="o">&lt;=</span> <span class="mf">7400.</span><span class="p">):</span> <span class="k">continue</span>  <span class="c1"># Run test only in a problem area because it is expensive</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">iLev</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLev</span><span class="p">):</span>
                <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">iLev</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nLs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="n">gs</span><span class="p">[</span><span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span>
                <span class="n">iN</span><span class="p">,</span> <span class="n">iG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># indices for the neutron and capture channels ( this is the order I packed them in )</span>
                <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">sigGamWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iG</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iG</span><span class="p">][</span><span class="n">iN</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cN</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">gs</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span>
                 <span class="n">nLs</span><span class="p">])</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">-</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sigPot</span><span class="p">))</span>

            <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">)</span>

            <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">,</span>
                                                  <span class="mf">50.</span><span class="p">)</span>  <span class="c1"># fails badly for some high energy P wave resonances??</span>

            <span class="c1"># Check agree with getCrossSection()</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getAngularDistribution_SWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getAngularDistribution_SWave">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getAngularDistribution_SWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note, Blatt-Biedenharn&#39;s Z coefficient has a factor of (l1,l2,0,0;L,0) (a Clebsch-Gordan coefficient) in it.</span>
<span class="sd">        As a result, if l1 and l2 cannot couple to L, one gets zero.</span>

<span class="sd">        For a single S-wave resonance, both l&#39;s are 0 so can only couple to L=0,</span>
<span class="sd">        resulting in pure isotropic angular distributions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span> <span class="o">/</span> <span class="mi">95</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">([</span><span class="n">x</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getAngularDistribution_PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getAngularDistribution_PWave">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getAngularDistribution_PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note, Blatt-Biedenharn&#39;s Z coefficient has a factor of (l1,l2,0,0;L,0) (a Clebsch-Gordan coefficient) in it.</span>
<span class="sd">        As a result, if l1 and l2 cannot couple to L, one gets zero.</span>

<span class="sd">        For a single P-wave resonance, both l&#39;s are 1 so can couple to L=0 or 2, resulting in an angular</span>
<span class="sd">        distribution with L=0 and 2 terms.</span>

<span class="sd">        Because there is only one resonance, the U matrix has one neutron-neutron element in it.</span>
<span class="sd">        So, all L&#39;s end up with the same (1-U)^2 factor and the energy dependence of the angular distribution</span>
<span class="sd">        divides out, leaving basically a constant factor of Z^2 for L=0 and 2.</span>
<span class="sd">        For L=0, Z ~ 3.5 and for L=2, Z ~ 2.  So, expect B[0]/B[0] == 1 and B[2]/B[0] ~ (2/3.5)^2 ~ 0.33.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span> <span class="o">=</span> <span class="mf">5.5</span>  <span class="c1"># for this test data</span>
        <span class="n">S</span> <span class="o">=</span> <span class="mf">4.5</span>  <span class="c1"># for this test data</span>
        <span class="kn">from</span> <span class="nn">numericalFunctions</span> <span class="kn">import</span> <span class="n">angularMomentumCoupling</span> <span class="k">as</span> <span class="n">nf_amc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span>
                                                                                                     <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span>
                                                                                                     <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.33090909</span><span class="p">))</span>  <span class="c1"># nf_amc functions use the 2J trick</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1PRes</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">([</span><span class="n">x</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.33090909</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getAngularDistribution"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getAngularDistribution">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;SLBW getAngularDistribution now NotImplemented&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getAngularDistribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use version of channels where we strip out the channels with spins that have zero width.</span>
<span class="sd">        The unit test is way faster than the full BB version, so we need to weaponize that one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">NJOYStyleSpinTreatment</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="kn">from</span> <span class="nn">numericalFunctions</span> <span class="kn">import</span> <span class="n">angularMomentumCoupling</span> <span class="k">as</span> <span class="n">nf_amc</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># int( len( egrid )/95)</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.69</span>  <span class="c1"># in b^{-1/2}</span>
        <span class="n">ERtoTest</span> <span class="o">=</span> <span class="mf">7331.0</span>
        <span class="n">nLev</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>

        <span class="c1"># First list is edited out of all the terms that correspond to spin channels with zero width</span>
        <span class="k">if</span> <span class="n">NJOYStyleSpinTreatment</span><span class="p">:</span>
            <span class="n">JslList</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                       <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>  <span class="c1"># try skipping the &quot;redundant&quot; ones: ( 4, 5, 1 ), ( 5, 5, 1 )</span>
        <span class="c1"># Second list has all the angular terms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">JslList</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="n">angCoeffSqrList</span> <span class="o">=</span> <span class="p">[{</span><span class="n">Jsl</span><span class="p">:</span> <span class="nb">pow</span><span class="p">(</span>
            <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Jsl</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Jsl</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Jsl</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Jsl</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Jsl</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                 <span class="mi">2</span> <span class="o">*</span> <span class="n">L</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">Jsl</span> <span class="ow">in</span> <span class="n">JslList</span><span class="p">}</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># First list is edited out of all the terms that correspond to spin channels with zero width</span>
            <span class="k">if</span> <span class="n">NJOYStyleSpinTreatment</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">angCoeffSqrList</span><span class="p">,</span> <span class="p">[</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">7.000000000000003</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">9.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">9.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">11.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">11.0</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">12.999999999999993</span><span class="p">},</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">},</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.5833333333213947</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">6.929999999908832</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">3.8133333328735186</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">4.136363636490839</span><span class="p">}])</span>
            <span class="c1"># Second list has all the angular terms</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">angCoeffSqrList</span><span class="p">,</span> <span class="p">[</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">6.999999999953966</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">8.99999999942597</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">8.999999999408963</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">8.999999999408963</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">10.99999999996129</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">10.999999999982087</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">10.999999999961286</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">13.000000000775405</span><span class="p">},</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">},</span>
                    <span class="p">{(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.5833333333213947</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">6.929999999908832</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">0.9163636362571602</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">3.8133333328735186</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mf">0.0</span><span class="p">,</span>
                     <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">8.579999999854891</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mf">4.136363636490839</span><span class="p">}])</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">E</span> <span class="o">&gt;=</span> <span class="mf">7300.</span> <span class="ow">and</span> <span class="n">E</span> <span class="o">&lt;=</span> <span class="mf">7400.</span><span class="p">):</span> <span class="k">continue</span>  <span class="c1"># Run test only in a problem area because it is expensive</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">angCoeffSqrList</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
            <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">iLev</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nLev</span><span class="p">):</span>
                <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">iLev</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">iN</span><span class="p">,</span> <span class="n">iG</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># indices for the neutron and capture channels ( this is the order I packed them in )</span>
                <span class="k">for</span> <span class="n">L</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">answer</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cN</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">angCoeffSqrList</span><span class="p">[</span><span class="n">L</span><span class="p">]:</span> <span class="k">continue</span>
                        <span class="n">answer</span><span class="p">[</span><span class="n">L</span><span class="p">]</span> <span class="o">+=</span> <span class="n">angCoeffSqrList</span><span class="p">[</span><span class="n">L</span><span class="p">][(</span><span class="n">cN</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">cN</span><span class="o">.</span><span class="n">l</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iLev</span><span class="p">][</span><span class="n">iN</span><span class="p">][</span><span class="n">iN</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">B</span><span class="p">])),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">])),</span>
                    <span class="nb">repr</span><span class="p">((</span><span class="n">answer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
                <span class="c1"># if we are within 2 eV of the resonance, the Legendre moment is big enough to notice</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span> <span class="o">-</span> <span class="n">ERtoTest</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">([</span><span class="n">x</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">B</span><span class="p">],</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">],</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getCrossSectionFull"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getCrossSectionFull">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSectionFull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test thermal &amp; a few other points&quot;&quot;&quot;</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">1.18726303</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">7.24518429</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">6.05792126</span><span class="p">}),</span>
            <span class="p">(</span><span class="mf">1009.0</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">290.05432779892004</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">507.80854074065803</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                      <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">217.75421294173799</span><span class="p">})]</span>
        <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestSLBWClassAndBaseClasses.test_getCrossSection1SRes"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestSLBWClassAndBaseClasses.test_getCrossSection1SRes">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection1SRes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test thermal &amp; a few other points&quot;&quot;&quot;</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">11957.883139892736</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">11977.291733536884</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                               <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">19.408593644148297</span><span class="p">}),</span>
            <span class="p">(</span><span class="mf">1009.0</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">1.2911030236464319e-06</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">5.1160670269419093</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                      <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">5.1160657358388857</span><span class="p">})]</span>
        <span class="k">for</span> <span class="n">answer</span> <span class="ow">in</span> <span class="n">answers</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1SRes</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestMLBWClassAndBaseClasses"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses">[docs]</a><span class="k">class</span> <span class="nc">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span> <span class="o">=</span> <span class="n">MLBWcrossSection</span><span class="p">(</span><span class="n">MLBWExample</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span> <span class="o">=</span> <span class="n">MLBWcrossSection</span><span class="p">(</span><span class="n">MLBWExample1PRes</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">projectile</span><span class="p">),</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetSpin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;O18&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="p">,</span> <span class="mf">17.8445</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="mf">1e-05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="mf">3150000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">missingGfactor</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Js&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">{</span><span class="s1">&#39;gfact&#39;</span><span class="p">,</span> <span class="s1">&#39;channelSpins&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gfact&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                         <span class="p">{</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;channelSpin&#39;</span><span class="p">,</span> <span class="s1">&#39;captureWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionWidthB&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fissionWidth&#39;</span><span class="p">,</span> <span class="s1">&#39;shiftFactor&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;J&#39;</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">),</span>
                         <span class="p">[</span><span class="o">-</span><span class="mf">2485000.0</span><span class="p">,</span> <span class="mf">663000.0</span><span class="p">,</span> <span class="mf">1200000.0</span><span class="p">,</span> <span class="mf">1256000.0</span><span class="p">,</span> <span class="mf">1450000.0</span><span class="p">,</span> <span class="mf">1585000.0</span><span class="p">,</span> <span class="mf">1840000.0</span><span class="p">,</span> <span class="mf">2300000.0</span><span class="p">,</span>
                          <span class="mf">2375000.0</span><span class="p">,</span> <span class="mf">2445000.0</span><span class="p">,</span> <span class="mf">3050000.0</span><span class="p">,</span> <span class="mf">3290000.0</span><span class="p">,</span> <span class="mf">3500000.0</span><span class="p">,</span> <span class="mf">3590000.0</span><span class="p">,</span> <span class="mf">4090000.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">),</span>
                         <span class="p">[</span><span class="mf">1429780.0</span><span class="p">,</span> <span class="mf">55000.0</span><span class="p">,</span> <span class="mf">50000.0</span><span class="p">,</span> <span class="mf">3600.0</span><span class="p">,</span> <span class="mf">350000.0</span><span class="p">,</span> <span class="mf">300000.0</span><span class="p">,</span> <span class="mf">8200.0</span><span class="p">,</span> <span class="mf">280000.0</span><span class="p">,</span> <span class="mf">130000.0</span><span class="p">,</span> <span class="mf">20300.0</span><span class="p">,</span>
                          <span class="mf">20300.0</span><span class="p">,</span> <span class="mf">250000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">,</span> <span class="mf">6500.0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_setResonanceParametersByChannel"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_setResonanceParametersByChannel">[docs]</a>    <span class="k">def</span> <span class="nf">test_setResonanceParametersByChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">cDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="o">.</span><span class="n">items</span><span class="p">()))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cDict</span><span class="p">),</span> <span class="mi">13</span><span class="p">)</span>  <span class="c1"># This is number of distinct MLBW channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">),</span>
                         <span class="mi">15</span><span class="p">)</span>  <span class="c1"># This is number of MLBW resonances.  Better equal the _energies array of level energies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">cDict</span><span class="p">[</span><span class="n">cs</span><span class="p">])</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">cDict</span><span class="p">]),</span>
                         <span class="mi">31</span><span class="p">)</span>  <span class="c1"># this is double the number of resonances (1/2 for elastic, 1/2 for capture)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                         <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span>
                                           <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;O18&#39;</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span>
                                           <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.23</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cDict</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">54999.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">3599.77</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mf">8199.77</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">):</span>
            <span class="c1"># Sum all the widths with matching resonance energy.  Done by brute force.</span>
            <span class="n">GT</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cDict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iR</span><span class="p">,</span> <span class="n">G</span> <span class="ow">in</span> <span class="n">cDict</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">iR</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span> <span class="n">GT</span> <span class="o">+=</span> <span class="n">G</span>
            <span class="c1"># Check all the widths for a level add up to the tabulated total</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">GT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">GT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getScatteringMatrixUValue_1PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUValue_1PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On first resonance &gt; 0, it is an P wave resonance of evaluation with one resonance.</span>
<span class="sd">        For one res, SLBW == MLBW.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>  <span class="c1"># eV</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ER</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">ER</span><span class="p">))</span>
        <span class="n">eiphi</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">phi</span><span class="p">))</span>  <span class="c1"># one for each GN</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="mf">7.96e-2</span>
        <span class="n">GN</span> <span class="o">=</span> <span class="mf">5.88e-4</span>
        <span class="n">GT</span> <span class="o">=</span> <span class="n">GN</span> <span class="o">+</span> <span class="n">GG</span>  <span class="c1"># 8.0188e-2</span>
        <span class="n">cN</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">cN</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">GN</span><span class="p">)</span>  <span class="c1"># Pick out GN from channels for 0th level.  Better match!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GN</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GN</span> <span class="o">*</span> <span class="n">GG</span><span class="p">)</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">eiphi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">GG</span> <span class="o">/</span> <span class="n">GT</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity_1PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity_1PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity_1PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The MLBW parameterization might have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the identity</span>
<span class="sd">               matrix is sqrt( ndim )</span>

<span class="sd">        Note:   For one res, SLBW == MLBW.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">EE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">():</span>
                <span class="n">UU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">EE</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UU</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">UU</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-03</span>  <span class="c1"># nominal value: 1e-03</span>
        <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-04</span>  <span class="c1"># nominal value: 1e-04</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">one</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">percent</span><span class="o">=</span><span class="n">rtol</span><span class="o">*</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Full">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity_Full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The MLBW parameterization might have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the identity</span>
<span class="sd">              matrix is sqrt( ndim )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">EE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">10</span><span class="p">]:</span>
                <span class="n">UU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">EE</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                       <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UU</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">UU</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-03</span>  <span class="c1"># nominal value: 1e-03</span>
        <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-04</span>  <span class="c1"># nominal value: 1e-04</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">one</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">percent</span><span class="o">=</span><span class="n">rtol</span><span class="o">*</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_1PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_1PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_1PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For one res, SLBW == MLBW.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">fourpi</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">nChan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">_energies</span><span class="p">)</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.63809</span>  <span class="c1"># in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">1 P Wave (course grid), </span><span class="si">%i</span><span class="s1"> channels, </span><span class="si">%i</span><span class="s1"> resonances&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nChan</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   SigNeuU (b)    &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  sigPot&#39;</span><span class="p">)</span>  <span class="c1"># dSigPotActual/dSigPotCalc &#39;</span>

        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># int( len( egrid )/95)</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="n">eStep</span><span class="p">]</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">egrid</span><span class="p">)[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span>
        <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
        <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]):</span>
            <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">gs</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span>
                <span class="n">nLs</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">s</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">l</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                        <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(((</span><span class="n">ic1</span> <span class="o">==</span> <span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span>
                                                              <span class="p">((</span><span class="n">ic1</span> <span class="o">==</span> <span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="k">elif</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;capture&#39;</span><span class="p">:</span>
                        <span class="n">sigGamWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> \
                                       <span class="nb">pow</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fourpi</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">[</span><span class="n">iE</span><span class="p">]))</span> <span class="o">/</span>
                                                       <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span><span class="p">])</span>
            <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="n">fourpi</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span>
                    <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span>
                    <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigPot</span><span class="p">))</span>  <span class="c1"># , -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

            <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">)</span>

            <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
            <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="mf">50.</span><span class="p">)</span>  <span class="c1"># fails badly for some high</span>
                                                                        <span class="c1"># energy P wave resonances??</span>

            <span class="c1"># Check agree with getCrossSection()</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full">[docs]</a>    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">nChan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">nChannels</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">nResonances</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.41</span>  <span class="c1"># in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All Waves (course grid), </span><span class="si">%i</span><span class="s1"> channels, </span><span class="si">%i</span><span class="s1"> resonances&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nChan</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
            <span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotSum (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   &#39;</span> <span class="o">+</span>
            <span class="s1">&#39;SigNeuU (b)    SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  sigPot&#39;</span><span class="p">)</span>

        <span class="c1"># We can&#39;t eat the whole energy grid, so we&#39;ll do it in parts</span>
        <span class="n">fullEgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">energyCohortLength</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">nEnergyCohorts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span> <span class="o">//</span> <span class="n">energyCohortLength</span>
        <span class="n">lastEnergyCohortSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span> <span class="o">%</span> <span class="n">energyCohortLength</span>
        <span class="n">energyCohorts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">iec</span> <span class="o">*</span> <span class="n">energyCohortLength</span><span class="p">,</span> <span class="p">(</span><span class="n">iec</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">energyCohortLength</span><span class="p">)</span> <span class="k">for</span> <span class="n">iec</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nEnergyCohorts</span><span class="p">)]</span>
        <span class="n">energyCohorts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lastEnergyCohortSize</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">iStart</span><span class="p">,</span> <span class="n">iStop</span> <span class="ow">in</span> <span class="n">energyCohorts</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">fullEgrid</span><span class="p">[</span><span class="n">iStart</span><span class="p">:</span><span class="n">iStop</span><span class="p">]</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">egrid</span><span class="p">)[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">gs</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span>
                    <span class="n">nLs</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                    <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">s</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">l</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                            <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(((</span><span class="n">ic1</span> <span class="o">==</span> <span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">])</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span>
                                                                  <span class="p">((</span><span class="n">ic1</span> <span class="o">==</span> <span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]))</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                        <span class="k">elif</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;capture&#39;</span><span class="p">:</span>
                            <span class="n">sigGamWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">]</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span>
                                <span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">[</span><span class="n">iE</span><span class="p">])))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span>
                              <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span><span class="p">])</span>
                <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span>
                        <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span>
                        <span class="n">sigPot</span><span class="p">))</span>  <span class="c1"># , -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

                <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
                <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span>
                                                                 <span class="mf">10.</span><span class="p">)</span>  <span class="c1"># expected to fail</span>

                <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
                <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">)</span>

                <span class="c1"># Check agree with getCrossSection()</span>
                <span class="c1"># Note, since ENDF&#39;s capture cross section is really a SLBW cross section, we expect poor agreement</span>
                <span class="c1"># between our U matrix based one and ENDF&#39;s.  Similarly, since the total cross section is a sum of</span>
                <span class="c1"># capture and elastic, we should really use the ENDF (SLBW) capture cross section to make the comparison</span>
                <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">15.</span><span class="p">)</span>
                    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span>  <span class="c1"># expected to fail</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">10.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getAngularDistribution_PWave"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getAngularDistribution_PWave">[docs]</a>    <span class="k">def</span> <span class="nf">test_getAngularDistribution_PWave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note, Blatt-Biedenharn&#39;s Z coefficient has a factor of (l1,l2,0,0;L,0) (a Clebsch-Gordan coefficient) in it.</span>
<span class="sd">        As a result, if l1 and l2 cannot couple to L, one gets zero.</span>

<span class="sd">        In our simple P-wave example, the U matrix has l=0 and 1 parts to it because you need the l=0 terms to get the</span>
<span class="sd">        potential scattering right, even if there is only one resonance.  Therefore, we expect L = 0, 1, and 2 terms</span>
<span class="sd">        since those are all the L&#39;s we can get by coupling any pair of l=0 and 1 together.  Because of this, the</span>
<span class="sd">        angular distribution that you get from a single MLBW resonance is different that that of a single SLBW</span>
<span class="sd">        resonance (at least the way you need to do things for ENDF).</span>

<span class="sd">        We tested the hell out of the L=0 term.</span>

<span class="sd">        We can test the L=1,2 terms on resonance by observing that the potential scattering in the l&gt;0 collision</span>
<span class="sd">        matrices is much smaller than that in the l=0 elements.  This allows us to ignore all but the purely resonance</span>
<span class="sd">        elements when directly on resonance (Ein=ER).   In our P-wave example, that means that our MLBW on resonance</span>
<span class="sd">        angular distribution should match the SLBW result (_but only on resonance_).  We reuse the test below, but only</span>
<span class="sd">        approximately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span> <span class="o">=</span> <span class="mf">5.5</span>  <span class="c1"># for this test data</span>
        <span class="n">S</span> <span class="o">=</span> <span class="mf">4.5</span>  <span class="c1"># for this test data</span>
        <span class="kn">from</span> <span class="nn">numericalFunctions</span> <span class="kn">import</span> <span class="n">angularMomentumCoupling</span> <span class="k">as</span> <span class="n">nf_amc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span>
                               <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">J</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                               <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.33090909</span><span class="p">))</span>  <span class="c1"># nf_amc functions use the 2J trick</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
                <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">one</span> <span class="o">-</span> <span class="n">U</span><span class="p">)</span>
                <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">B</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR1Res</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">ER</span><span class="p">)[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.066181818</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getElasticAngularDistribution_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getElasticAngularDistribution_Full">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;need answer to compare to&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getElasticAngularDistribution_Full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">))))</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getElasticAngularDistribution_Zr90"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getElasticAngularDistribution_Zr90">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;need answer to compare to&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getElasticAngularDistribution_Zr90</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">theRRR</span> <span class="o">=</span> <span class="n">MLBWcrossSection</span><span class="p">(</span><span class="n">MLBWExampleZr90</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">theRRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">theRRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">E</span><span class="p">))))</span></div>

<div class="viewcode-block" id="TestMLBWClassAndBaseClasses.test_getCrossSection"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestMLBWClassAndBaseClasses.test_getCrossSection">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test thermal point&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">)</span>
        <span class="c1"># print &#39;MLBW&#39;,result</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">0.00015987</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">3.11326583</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">3.11310596</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="TestAverageQuantities"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities">[docs]</a><span class="k">class</span> <span class="nc">TestAverageQuantities</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestAverageQuantities.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME: tests fail unless enableAngDists=True</span>
        <span class="c1"># FIXME: need non-MLBW tests too</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span> <span class="o">=</span> <span class="n">MLBWcrossSection</span><span class="p">(</span><span class="n">MLBWExample</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">URR</span> <span class="o">=</span> <span class="n">URRcrossSection</span><span class="p">(</span><span class="n">MLBWExampleZr90</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getScatteringLength"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getScatteringLength">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringLength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Atlas give R&#39;=4.80+/-0.11 fm for 18O, however the file gives a constant scattering radius AP of 4.1 fm.</span>
<span class="sd">        So, taking an R^\\infty of ~ 0.08 fm we should be OK</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringLength</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span> <span class="mf">4.02345944771</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getAverageQuantities"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getAverageQuantities">[docs]</a>    <span class="k">def</span> <span class="nf">test_getAverageQuantities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This tests the calculation of average widths and mean level spacings.  The test data is &quot;MLBWExample&quot;</span>
<span class="sd">        with the averages being performed over the entire RRR.  Therefore, there is only one energy group/grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAverageQuantities</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;reaction&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39; s &#39;</span><span class="p">,</span> <span class="s1">&#39; J &#39;</span><span class="p">,</span>
                  <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;calcSpacings&#39;</span><span class="p">,</span> <span class="s1">&#39;expectSpacings&#39;</span><span class="p">,</span>  <span class="s1">&#39;diffSpacings&#39;</span><span class="p">,</span> <span class="s1">&#39;calcWidths&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;expectWidths&#39;</span><span class="p">,</span> <span class="s1">&#39;diffWidths&#39;</span><span class="p">]]))</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">aq</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">expectedResults</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">EGam</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">lowerBound</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">]</span>
            <span class="n">EGam</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EGam</span><span class="p">)</span>

            <span class="c1"># Compute average width</span>
            <span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;widths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">EGam</span><span class="p">])</span>

            <span class="c1"># Compute mean level spacing</span>
            <span class="n">Ds</span><span class="o">=</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">EGam</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">EGam</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EGam</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;spacings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Ds</span><span class="p">)</span>

            <span class="n">calcWidth</span> <span class="o">=</span> <span class="n">aq</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;widths&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">calcSpacing</span> <span class="o">=</span> <span class="n">aq</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;spacings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">calcSpacing</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">calcWidth</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">calcSpacing</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;spacings&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;n/a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                          <span class="nb">str</span><span class="p">(</span><span class="n">calcWidth</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;widths&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;n/a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                          <span class="s1">&#39;bad data</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">calcWidth</span> <span class="o">=</span> <span class="n">calcWidth</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
            <span class="n">calcSpacing</span> <span class="o">=</span> <span class="n">calcSpacing</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">calcSpacing</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;spacings&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">calcSpacing</span> <span class="o">-</span> <span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;spacings&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">calcWidth</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;widths&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">calcWidth</span> <span class="o">-</span> <span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;widths&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Compare results</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">calcSpacing</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;spacings&#39;</span><span class="p">]),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">50.</span><span class="p">)</span>  <span class="c1"># gotta fix</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">calcWidth</span><span class="p">,</span>   <span class="nb">float</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="s1">&#39;widths&#39;</span><span class="p">]))</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getRRRTransmissionCoefficients"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getRRRTransmissionCoefficients">[docs]</a>    <span class="k">def</span> <span class="nf">test_getRRRTransmissionCoefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span>

        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">,</span> <span class="s1">&#39;1stOrder&#39;</span><span class="p">,</span> <span class="s1">&#39;2ndOrder&#39;</span><span class="p">,</span> <span class="s1">&#39;sumRule&#39;</span><span class="p">,</span> <span class="s1">&#39;opticalModel&#39;</span><span class="p">,</span> <span class="s1">&#39;SPRT&#39;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">Tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getTransmissionCoefficients</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="n">computeUncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tc</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">reaction&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="s1">&#39; L&#39;</span><span class="p">,</span> <span class="s1">&#39; s &#39;</span><span class="p">,</span> <span class="s1">&#39; J &#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                      <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]))</span>

            <span class="c1"># Compare the transmission coefficient options that should always agree</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                      <span class="n">results</span><span class="p">[</span><span class="s1">&#39;1stOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>   <span class="c1"># should be ==</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;sumRule&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                      <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>  <span class="c1">#should be close</span>

            <span class="c1"># As Gamma/D gets bigger, the weak coupling approximation gets worse and worse.</span>
            <span class="c1"># These tests check the agreement</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;1stOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

            <span class="c1"># As Gamma/D gets bigger, the SPRT method diverges from the sumRule and opticalModel versions</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.15</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># should always be close</span>
            <span class="k">elif</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">percent</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>  <span class="c1"># should always be close</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                                          <span class="n">percent</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>  <span class="c1"># should always be close</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getURRTransmissionCoefficients"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getURRTransmissionCoefficients">[docs]</a>    <span class="k">def</span> <span class="nf">test_getURRTransmissionCoefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DEBUG</span><span class="o">=</span><span class="kc">False</span>

        <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">,</span> <span class="s1">&#39;1stOrder&#39;</span><span class="p">,</span> <span class="s1">&#39;2ndOrder&#39;</span><span class="p">,</span> <span class="s1">&#39;sumRule&#39;</span><span class="p">,</span> <span class="s1">&#39;opticalModel&#39;</span><span class="p">,</span> <span class="s1">&#39;SPRT&#39;</span><span class="p">]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="n">Tc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">getTransmissionCoefficients</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tc</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">reaction&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="s1">&#39; L&#39;</span><span class="p">,</span><span class="s1">&#39; s &#39;</span><span class="p">,</span><span class="s1">&#39; J &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;weakCoupling&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                      <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;Tc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">Ex</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.4e6</span><span class="p">,</span> <span class="mf">0.8e6</span><span class="p">,</span> <span class="mf">1.2e6</span><span class="p">,</span> <span class="mf">1.6e6</span><span class="p">]:</span>

                <span class="c1"># Compare the transmission coefficient options that should always agree</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;1stOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>  <span class="c1"># should be identical</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;sumRule&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># should be close</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;SPRT&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                          <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># should be close</span>

                <span class="c1"># As Gamma/D gets bigger, the weak coupling approximation gets worse and worse.</span>
                <span class="c1"># These tests check the agreement</span>
                <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;1stOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                              <span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                              <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                              <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;weakCoupling&quot;</span><span class="p">][</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;2ndOrder&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span>
                                              <span class="n">results</span><span class="p">[</span><span class="s1">&#39;opticalModel&#39;</span><span class="p">][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">Ex</span><span class="p">),</span> <span class="n">percent</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">absTol</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getPoleStrength"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getPoleStrength">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPoleStrength</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">aq</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAverageQuantities</span><span class="p">(</span><span class="n">computeUncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getPoleStrength</span><span class="p">(</span><span class="n">computeUncertainty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sc</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;sc&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Compute average width</span>
            <span class="n">redGammas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getReducedWidths</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">aq</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;spacings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">expectedResult</span> <span class="o">=</span> <span class="n">PQU</span><span class="o">.</span><span class="n">PQU</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">g</span><span class="o">*</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">redGammas</span><span class="p">]),</span> <span class="s1">&#39;eV&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">aq</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;spacings&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># only one</span>
                                                                                                       <span class="c1"># energy bin in</span>
                                                                                                       <span class="c1"># the test data,</span>
                                                                                                       <span class="c1"># so this is safe</span>

            <span class="c1"># Compare results</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;sc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">expectedResult</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                      <span class="nb">str</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;sc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">expectedResult</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;sc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertPQUEquivalent</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="s1">&#39;sc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">expectedResult</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getReducedWidths"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getReducedWidths">[docs]</a>    <span class="k">def</span> <span class="nf">test_getReducedWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">:</span>
            <span class="n">redWidths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getReducedWidths</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

            <span class="c1"># If not positive energy resonances, keep going</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">redWidths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># For capture, the penetrability is 1, so the reduced with is sqrt(Gamma/2)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;capture&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span><span class="n">redWidths</span><span class="p">,</span>
                                             <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

            <span class="c1"># For elastic, the penetrability is l &amp; energy dependent.  The penetrability tests in</span>
            <span class="c1"># TestSLBWClassAndBaseClasses and TestMLBWClassAndBaseClasses ensure those are computed correctly.</span>
            <span class="c1"># The capture test just above show that the reduced widths are being computed correctly.</span>
            <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># For debugging</span>
            <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                      <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">iR</span><span class="p">]</span> <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span>
                      <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span> <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span>
                      <span class="n">redWidths</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestAverageQuantities.test_getPorterThomasFitToWidths"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestAverageQuantities.test_getPorterThomasFitToWidths">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPorterThomasFitToWidths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Not much of a test...</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getPorterThomasFitToWidths</span><span class="p">())</span></div></div>



<div class="viewcode-block" id="TestRMClassAndBaseClasses"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses">[docs]</a><span class="k">class</span> <span class="nc">TestRMClassAndBaseClasses</span><span class="p">(</span> <span class="n">TestWithIsClose</span> <span class="p">):</span>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span> <span class="o">=</span> <span class="n">RMatrixLimitedcrossSection</span><span class="p">(</span> <span class="n">RMExample</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span> <span class="o">=</span> <span class="n">RMatrixLimitedcrossSection</span><span class="p">(</span> <span class="n">RMExampleSmall</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">enableAngDists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_memberData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">projectile</span><span class="p">),</span> <span class="s1">&#39;n&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetSpin</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;Si28&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="p">,</span> <span class="mf">27.73700000000002</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="mf">1e-05</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="mf">1750000.0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">),</span> <span class="p">[</span><span class="o">-</span><span class="mf">3622100.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">873730.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">365290.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">63159.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">48801.0</span><span class="p">,</span> <span class="mf">31740.0</span><span class="p">,</span> <span class="mf">55677.0</span><span class="p">,</span> <span class="mf">67733.0</span><span class="p">,</span> <span class="mf">70800.0</span><span class="p">,</span> <span class="mf">86797.0</span><span class="p">,</span> <span class="mf">181620.0</span><span class="p">,</span> <span class="mf">298700.0</span><span class="p">,</span> <span class="mf">301310.0</span><span class="p">,</span> <span class="mf">354590.0</span><span class="p">,</span> <span class="mf">399680.0</span><span class="p">,</span> <span class="mf">532660.0</span><span class="p">,</span> <span class="mf">565580.0</span><span class="p">,</span> <span class="mf">587170.0</span><span class="p">,</span> <span class="mf">590290.0</span><span class="p">,</span> <span class="mf">602470.0</span><span class="p">,</span> <span class="mf">714040.0</span><span class="p">,</span> <span class="mf">771710.0</span><span class="p">,</span> <span class="mf">812490.0</span><span class="p">,</span> <span class="mf">845230.0</span><span class="p">,</span> <span class="mf">872310.0</span><span class="p">,</span> <span class="mf">910040.0</span><span class="p">,</span> <span class="mf">962230.0</span><span class="p">,</span> <span class="mf">1017800.0</span><span class="p">,</span> <span class="mf">1042900.0</span><span class="p">,</span> <span class="mf">1085200.0</span><span class="p">,</span> <span class="mf">1148100.0</span><span class="p">,</span> <span class="mf">1162700.0</span><span class="p">,</span> <span class="mf">1199500.0</span><span class="p">,</span> <span class="mf">1201200.0</span><span class="p">,</span> <span class="mf">1256400.0</span><span class="p">,</span> <span class="mf">1264400.0</span><span class="p">,</span> <span class="mf">1379900.0</span><span class="p">,</span> <span class="mf">1408300.0</span><span class="p">,</span> <span class="mf">1479900.0</span><span class="p">,</span> <span class="mf">1482400.0</span><span class="p">,</span> <span class="mf">1512300.0</span><span class="p">,</span> <span class="mf">1528700.0</span><span class="p">,</span> <span class="mf">1580600.0</span><span class="p">,</span> <span class="mf">1592800.0</span><span class="p">,</span> <span class="mf">1597200.0</span><span class="p">,</span> <span class="mf">1639600.0</span><span class="p">,</span> <span class="mf">1651100.0</span><span class="p">,</span> <span class="mf">1658600.0</span><span class="p">,</span> <span class="mf">1665000.0</span><span class="p">,</span> <span class="mf">1785000.0</span><span class="p">,</span> <span class="mf">1805700.0</span><span class="p">,</span> <span class="mf">1850700.0</span><span class="p">,</span> <span class="mf">1852400.0</span><span class="p">,</span> <span class="mf">1923700.0</span><span class="p">,</span> <span class="mf">1968900.0</span><span class="p">,</span> <span class="mf">2248700.0</span><span class="p">,</span> <span class="mf">3007300.0</span><span class="p">,</span> <span class="mf">3067800.0</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="p">[</span><span class="mf">3936345.36</span><span class="p">,</span> <span class="mf">1.12681</span><span class="p">,</span> <span class="mf">1.030406</span><span class="p">,</span> <span class="mf">1.046894</span><span class="p">,</span> <span class="mf">1.0092496</span><span class="p">,</span> <span class="mf">1.015667</span><span class="p">,</span> <span class="mf">654.8903</span><span class="p">,</span> <span class="mf">5.1589</span><span class="p">,</span> <span class="mf">1.029617</span><span class="p">,</span> <span class="mf">3.22618</span><span class="p">,</span> <span class="mf">34899.6</span><span class="p">,</span> <span class="mf">10.886</span><span class="p">,</span> <span class="mf">5.9548</span><span class="p">,</span> <span class="mf">15.46</span><span class="p">,</span> <span class="mf">1.47361</span><span class="p">,</span> <span class="mf">535.31</span><span class="p">,</span> <span class="mf">10955.9</span><span class="p">,</span> <span class="mf">207.96</span><span class="p">,</span> <span class="mf">527.26</span><span class="p">,</span> <span class="mf">53.891</span><span class="p">,</span> <span class="mf">3.7165</span><span class="p">,</span> <span class="mf">54.139</span><span class="p">,</span> <span class="mf">30109.7</span><span class="p">,</span> <span class="mf">399.91</span><span class="p">,</span> <span class="mf">33.44</span><span class="p">,</span> <span class="mf">3674.43</span><span class="p">,</span> <span class="mf">76630.0</span><span class="p">,</span> <span class="mf">77.192</span><span class="p">,</span> <span class="mf">934.7</span><span class="p">,</span> <span class="mf">76.394</span><span class="p">,</span> <span class="mf">4.1469</span><span class="p">,</span> <span class="mf">3017.4</span><span class="p">,</span> <span class="mf">14921.6</span><span class="p">,</span> <span class="mf">4604.8</span><span class="p">,</span> <span class="mf">17386.6</span><span class="p">,</span> <span class="mf">844.63999999999999</span><span class="p">,</span> <span class="mf">67.699</span><span class="p">,</span> <span class="mf">5201.0</span><span class="p">,</span> <span class="mf">3504.15</span><span class="p">,</span> <span class="mf">9.68694</span><span class="p">,</span> <span class="mf">92.493</span><span class="p">,</span> <span class="mf">2924.9</span><span class="p">,</span> <span class="mf">1497.9</span><span class="p">,</span> <span class="mf">11207.8</span><span class="p">,</span> <span class="mf">4019.6</span><span class="p">,</span> <span class="mf">15294.0</span><span class="p">,</span> <span class="mf">21556.0</span><span class="p">,</span> <span class="mf">1564.1</span><span class="p">,</span> <span class="mf">218.3</span><span class="p">,</span> <span class="mf">195.34</span><span class="p">,</span> <span class="mf">1301.6</span><span class="p">,</span> <span class="mf">35516.0</span><span class="p">,</span> <span class="mf">70709.5</span><span class="p">,</span> <span class="mf">1018.1</span><span class="p">,</span> <span class="mf">5735.1</span><span class="p">,</span> <span class="mf">444763.6</span><span class="p">,</span> <span class="mf">293.56</span><span class="p">,</span> <span class="mf">425.89</span><span class="p">]</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">w</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">calculateChannelRadius</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_obsoleteMemberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_obsoleteMemberData">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_obsoleteMemberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">missingGfactor</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">),</span> <span class="mi">3</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Js&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;gfact&#39;</span><span class="p">,</span> <span class="s1">&#39;channelSpins&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;gfact&#39;</span><span class="p">],</span> <span class="mf">1.0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;channelSpins&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;neutronWidth&#39;</span><span class="p">,</span><span class="s1">&#39;channelSpin&#39;</span><span class="p">,</span><span class="s1">&#39;captureWidth&#39;</span><span class="p">,</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionWidthA&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionWidthB&#39;</span><span class="p">,</span> <span class="s1">&#39;shiftFactor&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">Ls</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Js&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;J&#39;</span><span class="p">],</span> <span class="mf">0.5</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">isEnergyDependent</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">),</span> <span class="s2">&quot;4.1364&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">),</span> <span class="s2">&quot;4.9437&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="p">),</span> <span class="s2">&quot;4.1364&quot;</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getL0Matrix"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getL0Matrix">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getL0Matrix</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">E</span> <span class="o">=</span> <span class="mf">31740.0</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getChannelConstantsBc</span><span class="p">()</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">complex</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span> <span class="n">E</span><span class="p">,</span> <span class="n">c</span> <span class="p">)</span> <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span> <span class="n">E</span><span class="p">,</span> <span class="n">c</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">L0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getL0Matrix</span><span class="p">([</span><span class="n">E</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span> <span class="p">):</span>
            <span class="c1"># Because of the way ENDF handles the shift factor and the boundary value, this only works for s-wave channels</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">L0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ic</span><span class="p">,</span><span class="n">ic</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span> <span class="p">)</span>
            <span class="c1"># Because of the way ENDF handles the shift factor and the boundary value, this also passes, but it shouldn&#39;t</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">L0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ic</span><span class="p">,</span><span class="n">ic</span><span class="p">],</span> <span class="nb">complex</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_setResonanceParametersByChannel"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_setResonanceParametersByChannel">[docs]</a>    <span class="k">def</span> <span class="nf">test_setResonanceParametersByChannel</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="n">useReichMooreApproximation</span> <span class="o">=</span> <span class="kc">True</span>  <span class="p">)</span>
        <span class="n">cDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cDict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span> <span class="p">),</span> <span class="mi">10</span> <span class="p">)</span> <span class="c1"># This is number of channels, whether eliminated or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span> <span class="p">),</span> <span class="mi">5</span> <span class="p">)</span> <span class="c1"># This is number of distinct un-eliminated RM channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eliminatedChannels</span> <span class="p">),</span> <span class="mi">5</span> <span class="p">)</span> <span class="c1"># This is number of distinct eliminated RM channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span> <span class="p">),</span> <span class="mi">58</span> <span class="p">)</span> <span class="c1"># This is number of RM resonances.  Better equal the _energies array of level energies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">cs</span><span class="p">])</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span> <span class="p">]</span> <span class="p">),</span> <span class="mi">116</span> <span class="p">)</span> <span class="c1"># this the number of resonances (elastic only in our example)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Si28&#39;</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">145.36</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.0253</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mf">1.5803</span><span class="p">,</span> <span class="mi">33</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">34</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">55</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">56</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">57</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mi">31</span><span class="p">:</span> <span class="mf">3.8</span><span class="p">}</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)[</span><span class="mi">9</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="mi">35</span><span class="p">:</span> <span class="mf">843.64</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">0.015667</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mf">0.029617</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="mf">9.886</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="mf">14.46</span><span class="p">,</span> <span class="mi">46</span><span class="p">:</span> <span class="mf">21555.0</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span> <span class="mf">15293.0</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span> <span class="mf">91.493</span><span class="p">,</span> <span class="mi">51</span><span class="p">:</span> <span class="mf">35515.0</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span> <span class="mf">53.139</span><span class="p">,</span> <span class="mi">54</span><span class="p">:</span> <span class="mf">5734.1</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span> <span class="mf">32.14</span><span class="p">,</span> <span class="mi">27</span><span class="p">:</span> <span class="mf">76.192</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mf">933.7</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span> <span class="mf">3.1469</span><span class="p">,</span> <span class="mi">53</span><span class="p">:</span> <span class="mf">1017.1</span><span class="p">}</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">):</span>
            <span class="c1"># Sum all the widths with matching resonance energy.  Done by brute force.</span>
            <span class="n">GT</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iR</span><span class="p">,</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">allChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">iR</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span> <span class="n">GT</span> <span class="o">+=</span> <span class="n">G</span>
            <span class="c1"># Check all the widths for a level add up to the tabulated total</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">GT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">GT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_widths</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.1</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getRMatrix_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getRMatrix_Full">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getRMatrix_Full</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the value on resonances, full example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Basic property tests</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">]]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span> <span class="p">)</span>
        <span class="c1"># Full R test</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">nResonances</span> <span class="p">):</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span> <span class="n">iR</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span>
                    <span class="n">Pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span> <span class="n">ER</span> <span class="p">)],</span> <span class="n">c</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">GG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">R</span><span class="p">[</span><span class="n">iR</span><span class="p">,</span><span class="n">ic</span><span class="p">,</span><span class="n">ic</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">GN</span><span class="o">/</span><span class="n">GG</span><span class="o">/</span><span class="n">Pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_background_RMatrix"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_background_RMatrix">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_background_RMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gamWidth</span>      <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># gamma widths in Atlas for 28Si are around 1 eV</span>
        <span class="n">k_over_sqrt_E</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.196807122623e-3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="o">+</span><span class="mf">1.0</span><span class="p">))</span> <span class="c1">#in units of b^-0.5</span>
        <span class="n">S0</span>            <span class="o">=</span> <span class="mf">0.5e-4</span> <span class="c1"># S0 x 10^-4 (Atlas)</span>
        <span class="n">Rprime</span>        <span class="o">=</span> <span class="mf">4.8</span> <span class="c1"># R&#39;=a(1-Rinf)=4.8 fm</span>
        <span class="n">a</span>             <span class="o">=</span> <span class="mf">4.1264</span> <span class="c1"># a=4.1264 fm</span>
        <span class="n">Rinf</span>          <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># should equal 1.0-Rprime/a (no units), but since S0 is constant, it should be 0.0 and a should == R&#39;</span>
        <span class="n">pole_strength</span> <span class="o">=</span> <span class="n">S0</span><span class="o">/</span><span class="p">(</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">k_over_sqrt_E</span><span class="o">*</span><span class="n">a</span> <span class="p">)</span>
        <span class="n">egrid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[</span><span class="mi">2</span><span class="p">::</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">R</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getBackgroundRMatrix</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="n">gamWidth</span><span class="o">=</span><span class="n">gamWidth</span><span class="p">,</span> <span class="n">pole_strength</span><span class="o">=</span><span class="n">pole_strength</span><span class="p">,</span> <span class="n">Rinf</span><span class="o">=</span><span class="n">Rinf</span> <span class="p">)</span>

        <span class="c1"># The distant level approx should give a background R matrix much smaller than the real one</span>
        <span class="n">imidE</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">imidE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">10</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">Rb</span><span class="p">[</span><span class="n">imidE</span><span class="p">]))</span>

        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">nChannels</span><span class="p">)</span>
            <span class="n">firstChannel</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">firstChannel</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">firstChannel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="p">)</span>
            <span class="n">rFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;RTest.dat&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="n">rFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;  &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">Rb</span><span class="p">[</span><span class="n">iE</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Rb</span><span class="p">[</span><span class="n">iE</span><span class="p">]))</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
                <span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getRMatrix_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getRMatrix_Small">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getRMatrix_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the value on resonances, small example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Print a table for plotting the R matrix</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">RR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span><span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">RR</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">RR</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">RR</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">RR</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

        <span class="c1"># Basic properties of the R matrix test</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">]]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">R</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Test specific values</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">iR</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">nResonances</span> <span class="p">)[:</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span> <span class="n">iR</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span> <span class="p">):</span>
                <span class="k">if</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">GN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span>
                    <span class="n">Pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span> <span class="n">ER</span> <span class="p">)],</span> <span class="n">c</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">Sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span> <span class="n">ER</span> <span class="p">)],</span> <span class="n">c</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">Bc</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">.</span><span class="n">l</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iR</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                    <span class="n">GG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">iR</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="n">R00answer</span> <span class="o">=</span> <span class="n">GN</span><span class="o">/</span><span class="n">GG</span><span class="o">/</span><span class="n">Pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># to 10 % or better</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">R</span><span class="p">[</span> <span class="n">iR</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">ic</span> <span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">R00answer</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getXMatrix_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getXMatrix_Small">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getXMatrix_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="c1"># Print a table for plotting the X matrix</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">egrid</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">31733.7</span><span class="p">,</span> <span class="mf">31740.0</span> <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">2</span><span class="p">]</span> <span class="p">)[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getXMatrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">L0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getL0Matrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span><span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

        <span class="c1"># Test specific values</span>
        <span class="k">for</span> <span class="n">iE</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">X</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="mi">9</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">X</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">),</span> <span class="mi">9</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Full">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity_Full</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RM parameterization might have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the identity matrix is sqrt( ndim )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">10</span><span class="p">]</span>
            <span class="n">UU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span><span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                       <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                       <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">rtol</span><span class="o">=</span> <span class="mf">1e-03</span> <span class="c1"># nominal value: 1e-03</span>
        <span class="n">atol</span><span class="o">=</span> <span class="mf">1e-04</span> <span class="c1"># nominal value: 1e-04</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">]])</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">[</span> <span class="nb">complex</span><span class="p">(</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="mi">5</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">one</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Small">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RM parameterization might have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the identity matrix is sqrt( ndim )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">UU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span><span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                       <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                       <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">31733.7</span><span class="p">,</span> <span class="mf">31740.0</span> <span class="p">])[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">[</span> <span class="nb">complex</span><span class="p">(</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">E</span> <span class="o">==</span> <span class="mf">31740.0</span><span class="p">:</span> <span class="c1"># on resonance, expect to be good to only 10%</span>
                <span class="n">numDecimalPlaces</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">rtol</span><span class="o">=</span> <span class="mf">1e-01</span> <span class="c1"># nominal value: 1e-03</span>
                <span class="n">atol</span><span class="o">=</span> <span class="mf">1e-02</span> <span class="c1"># nominal value: 1e-04</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">numDecimalPlaces</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">rtol</span><span class="o">=</span> <span class="mf">1e-03</span> <span class="c1"># nominal value: 1e-03</span>
                <span class="n">atol</span><span class="o">=</span> <span class="mf">1e-04</span> <span class="c1"># nominal value: 1e-04</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">),</span> <span class="n">numDecimalPlaces</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="n">one</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Full">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Full</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">nonEliminatedChannels</span> <span class="o">=</span> <span class="p">[</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">eliminated</span> <span class="p">]</span>

        <span class="n">nChan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">nonEliminatedChannels</span> <span class="p">)</span>
        <span class="n">nElim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">channels</span> <span class="p">)</span> <span class="o">-</span> <span class="n">nChan</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">_energies</span> <span class="p">)</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.41</span> <span class="c1">#in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All Waves (course grid), </span><span class="si">%i</span><span class="s1"> kept channels, </span><span class="si">%i</span><span class="s1"> eliminated channels, </span><span class="si">%i</span><span class="s1"> resonances&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">nChan</span><span class="p">,</span> <span class="n">nElim</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotSum (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   &#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;SigNeuU (b)    SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  sigPot&#39;</span><span class="p">)</span>

        <span class="c1"># We can&#39;t eat the whole energy grid, so we&#39;ll do it in parts</span>
        <span class="n">fullEgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">energyCohortLength</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">nEnergyCohorts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">//</span><span class="n">energyCohortLength</span>
        <span class="n">lastEnergyCohortSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">%</span><span class="n">energyCohortLength</span>
        <span class="n">energyCohorts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">iec</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">,</span> <span class="p">(</span><span class="n">iec</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">)</span> <span class="k">for</span> <span class="n">iec</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nEnergyCohorts</span><span class="p">)]</span>
        <span class="n">energyCohorts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">lastEnergyCohortSize</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">iStart</span><span class="p">,</span><span class="n">iStop</span> <span class="ow">in</span> <span class="n">energyCohorts</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">fullEgrid</span><span class="p">[</span><span class="n">iStart</span><span class="p">:</span><span class="n">iStop</span><span class="p">]</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="kc">True</span> <span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>
            <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">egrid</span><span class="p">)[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span><span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nonEliminatedChannels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="n">gs</span><span class="p">[</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span>
                    <span class="n">nLs</span><span class="p">[</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                    <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                    <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span><span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nonEliminatedChannels</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">s</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">l</span><span class="p">:</span> <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                            <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">ic1</span><span class="o">==</span><span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic2</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">ic1</span><span class="o">==</span><span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span><span class="n">ic1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">sigTotWithU</span> <span class="o">-</span> <span class="n">sigNeuWithU</span>
                <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="p">(</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span> <span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span> <span class="p">]</span> <span class="p">)</span>
                <span class="n">sigNeuInt</span>   <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span>
                        <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span>
                        <span class="n">sigPot</span><span class="p">))</span>  <span class="c1"># , -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

                <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
                <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="mf">10.</span> <span class="p">)</span>

                <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
                <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span> <span class="p">)</span> <span class="c1"># fails badly for some high energy P wave resonances??</span>

                <span class="c1"># Check agree with getCrossSection()</span>
                <span class="c1"># Note, since ENDF&#39;s capture cross section is really a SLBW cross section, we expect poor agreement between our U matrix based one and ENDF&#39;s</span>
                <span class="c1"># Similarly, since the total cross section is a sum of capture and elastic, we should really use the ENDF (SLBW) capture cross section to make the comparison</span>
                <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">+</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span>  <span class="c1"># expected to fail</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Small">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Major changes to class means tests always fail, they need to be refactored as the Reich-Moore and R-matrix limited classes have merged in Fudge&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">nChan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span> <span class="p">)</span>
        <span class="n">nElim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span> <span class="p">)</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span> <span class="p">)</span>
        <span class="n">AP</span> <span class="o">=</span> <span class="mf">0.41364</span> <span class="c1">#in b^{-1/2}</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">All Waves (course grid), </span><span class="si">%i</span><span class="s1"> kept channels, </span><span class="si">%i</span><span class="s1"> eliminated channels, </span><span class="si">%i</span><span class="s1"> resonances&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nChan</span><span class="p">,</span> <span class="n">nElim</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;     E (eV)       SigTotU (b)    SigTotSum (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   &#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;SigNeuU (b)    SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  sigPot&#39;</span><span class="p">)</span>

        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#int( len( egrid )/95)</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="n">eStep</span><span class="p">]</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="kc">True</span> <span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">rhohat</span> <span class="o">=</span> <span class="n">AP</span> <span class="o">*</span> <span class="n">k</span>
        <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)[</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span>
        <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span> <span class="n">E</span><span class="o">&gt;=</span><span class="mf">31700.</span> <span class="ow">and</span> <span class="n">E</span><span class="o">&lt;=</span><span class="mf">31750.0</span> <span class="p">):</span> <span class="k">continue</span>
            <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span><span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">gs</span><span class="p">[</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span>
                <span class="n">nLs</span><span class="p">[</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span><span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">s</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">s</span> <span class="ow">or</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="o">!=</span> <span class="n">c2</span><span class="o">.</span><span class="n">l</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span>
                        <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">ic1</span><span class="o">==</span><span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic2</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">ic1</span><span class="o">==</span><span class="n">ic2</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">][</span><span class="n">ic2</span><span class="p">,</span><span class="n">ic1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">sigTotWithU</span> <span class="o">-</span> <span class="n">sigNeuWithU</span>
            <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="p">(</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span> <span class="n">l</span><span class="p">,</span> <span class="n">rhohat</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span> <span class="p">]</span> <span class="p">)</span>
            <span class="n">sigNeuInt</span>   <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span>
                    <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span>
                    <span class="n">sigPot</span><span class="p">))</span>  <span class="c1"># , -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

            <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="mf">10.</span> <span class="p">)</span>

            <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
            <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span> <span class="p">)</span>  <span class="c1"># fails badly for some high energy P wave resonances??</span>

            <span class="c1"># Check agree with getCrossSection()</span>
            <span class="c1"># Note, since ENDF&#39;s capture cross section is really a SLBW cross section, we expect poor agreement between our U matrix based one and ENDF&#39;s</span>
            <span class="c1"># Similarly, since the total cross section is a sum of capture and elastic, we should really use the ENDF (SLBW) capture cross section to make the comparison</span>
            <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">+</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span>
                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span>  <span class="c1"># expected to fail</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getElasticAngularDistribution_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getElasticAngularDistribution_Small">[docs]</a>    <span class="k">def</span> <span class="nf">test_getElasticAngularDistribution_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        FIXME: This test not written yet.</span>
<span class="sd">        The values to check against below for the angular distribution are wrong (they&#39;re copied from the MLBW test)</span>

<span class="sd">        Do we even need this test?  once the R matrix is correct, the angular distribution generation is just</span>
<span class="sd">        inherited from the base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">B</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ER</span><span class="p">])</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.96523656e-14</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="c1">#0.33090909, 2 )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getElasticAngularDistribution_Full"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getElasticAngularDistribution_Full">[docs]</a>    <span class="k">def</span> <span class="nf">test_getElasticAngularDistribution_Full</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        FIXME: This test not written yet.</span>
<span class="sd">        The values to check against below for the angular distribution are wrong (they&#39;re copied from the MLBW test)</span>

<span class="sd">        Do we even need this test?  once the R matrix is correct, the angular distribution generation is just</span>
<span class="sd">        inherited from the base class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span><span class="o">=</span><span class="mi">10</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">[::</span><span class="n">eStep</span><span class="p">]:</span>
                <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">B</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="mf">0.169</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ER</span><span class="p">])</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.55602284e-14</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span> <span class="c1">#0.33090909, 2 )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMClassAndBaseClasses.test_getCrossSection"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMClassAndBaseClasses.test_getCrossSection">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test thermal point&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span> <span class="mf">0.0235339347844</span> <span class="p">)</span>
        <span class="c1">#print &#39;RM&#39;,result</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span><span class="mf">0.17536290484357434</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span><span class="mf">2.1313431546619341</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span><span class="mf">1.9559802498183596</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="p">)</span></div></div>



<div class="viewcode-block" id="TestRMLClassAndBaseClasses"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses">[docs]</a><span class="k">class</span> <span class="nc">TestRMLClassAndBaseClasses</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span> <span class="o">=</span> <span class="n">RMatrixLimitedcrossSection</span><span class="p">(</span><span class="n">RMLExample</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span> <span class="o">=</span> <span class="n">RMatrixLimitedcrossSection</span><span class="p">(</span><span class="n">RMLExampleSmall</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">DOFETESTS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span> <span class="o">=</span> <span class="n">RMatrixLimitedcrossSection</span><span class="p">(</span><span class="n">RMLExampleFe</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">,</span>
                         <span class="p">(</span><span class="o">-</span><span class="mf">336933.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">180.65</span><span class="p">,</span> <span class="mf">397.8154</span><span class="p">,</span> <span class="mf">4250.762</span><span class="p">,</span> <span class="mf">16356.12</span><span class="p">,</span> <span class="mf">22396.4</span><span class="p">,</span> <span class="mf">54932.0</span><span class="p">,</span> <span class="mf">68236.16</span><span class="p">,</span> <span class="mf">133988.4</span><span class="p">,</span>
                          <span class="mf">1205687.0</span><span class="p">,</span> <span class="mf">1434336.0</span><span class="p">,</span> <span class="mf">1441365.0</span><span class="p">,</span> <span class="mf">7563145.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_thresholds</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_widths</span><span class="p">,</span>
                         <span class="p">(</span><span class="mf">38202.334010000006</span><span class="p">,</span> <span class="mf">13.813142300000001</span><span class="p">,</span> <span class="mf">1.0375000000000001</span><span class="p">,</span> <span class="mf">1.3300000000000001</span><span class="p">,</span>
                          <span class="mf">6.5323189999999993</span><span class="p">,</span> <span class="mf">2.6911670000000001</span><span class="p">,</span> <span class="mf">46.809660000000001</span><span class="p">,</span> <span class="mf">218.29737</span><span class="p">,</span> <span class="mf">662.81119999999999</span><span class="p">,</span>
                          <span class="mf">643.18999999999994</span><span class="p">,</span> <span class="mf">5423.7999999999993</span><span class="p">,</span> <span class="mf">1609.5999999999999</span><span class="p">,</span> <span class="mf">622905.38398000004</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="s1">&#39;RMatrix&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">targetSpin</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;Cl35&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">projectile</span><span class="p">),</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="p">,</span> <span class="mf">34.66845</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="mf">1200000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_RR_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_RR_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_RR_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">approximation</span><span class="p">,</span> <span class="s1">&#39;Reich_Moore&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">boundaryCondition</span><span class="p">,</span> <span class="s1">&#39;EliminateShiftFunction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">relativisticKinematics</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">reducedWidthAmplitudes</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.assertEqual(self.RRRSmall.RR.calculatePenetrability, True)  # FIXME: why not this one too?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">calculateShift</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">calculateChannelRadius</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_RR_spinGroup_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_RR_spinGroup_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_RR_spinGroup_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spin</span><span class="p">),</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parity</span><span class="p">),</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;Cl36 + photon width&#39;</span><span class="p">,</span> <span class="s1">&#39;n + Cl35 width&#39;</span><span class="p">,</span> <span class="s1">&#39;H1 + S35 width&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">spinGroups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resonanceParameters</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="s1">&#39;eV&#39;</span><span class="p">,</span> <span class="s1">&#39;eV&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_RR_openChannel_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_RR_openChannel_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_RR_openChannel_memberData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;n + Cl35&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionLink</span><span class="p">),</span>
                         <span class="s2">&quot;/reactionSuite/reactions/reaction[@label=&#39;n + Cl35&#39;]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">computeShiftFactor</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">),</span> <span class="mf">4.82222</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hardSphereRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">),</span> <span class="mf">4.88875</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;Xi&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;Xi&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;Xi&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mf">632965.817883407</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">),</span>
            <span class="mf">1.00866491574</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">),</span>
            <span class="mf">34.9688491980864</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">RR</span><span class="o">.</span><span class="n">resonanceReactions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;Xi&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_isElastic"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_isElastic">[docs]</a>    <span class="k">def</span> <span class="nf">test_isElastic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">isElastic</span><span class="p">(</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">isElastic</span><span class="p">(</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getChannelConstantsBc"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getChannelConstantsBc">[docs]</a>    <span class="k">def</span> <span class="nf">test_getChannelConstantsBc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getChannelConstantsBc</span><span class="p">(),</span>
                         <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getChannelScatteringRadiiTrue"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getChannelScatteringRadiiTrue">[docs]</a>    <span class="k">def</span> <span class="nf">test_getChannelScatteringRadiiTrue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getChannelScatteringRadiiTrue</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="mi">16</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.48222175644091303</span><span class="p">],</span>
            <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getChannelScatteringRadiiEffective"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getChannelScatteringRadiiEffective">[docs]</a>    <span class="k">def</span> <span class="nf">test_getChannelScatteringRadiiEffective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getChannelScatteringRadiiEffective</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">),</span>
            <span class="mi">4</span><span class="o">*</span><span class="p">[</span><span class="mf">0.36679799999999996</span><span class="p">]</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="p">[</span><span class="mf">0.48887499999999995</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_setResonanceParametersByChannel"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_setResonanceParametersByChannel">[docs]</a>    <span class="k">def</span> <span class="nf">test_setResonanceParametersByChannel</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDiff</span><span class="o">=</span><span class="kc">None</span>
        <span class="c1"># The evaluation in RRRSmall is correct (channel-wise), so we&#39;ll try out all the things</span>
        <span class="c1"># Note however that the gamma channel has the wrong spin for the residual (as given in original ENDF file), so the gfactors below are nonsensical.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">allChannels</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">),</span> <span class="p">{</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.375</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;gamma + Cl36&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;Cl36&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;photon&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">8827250.63441</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">GAMMACHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">22</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.875</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.875</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)}</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.875</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;S35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">632965.817883</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">CPCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span>
            <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="mf">0.164019</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">ChannelDesignator</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="mf">0.625</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="s1">&#39;Cl35&#39;</span><span class="p">,</span> <span class="n">Xi</span><span class="o">=-</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span>
                               <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">13.277</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="mf">621905.0</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># This coding used to generate a table of resonances</span>
            <span class="c1"># suitable for a LaTeX document</span>
            <span class="c1">#</span>
            <span class="k">for</span> <span class="n">ir</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">cres</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">allChannels</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">cres</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">res</span><span class="o">=</span><span class="n">cres</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">ir</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">row</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ir</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span> <span class="p">]</span>
                        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">particleA</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="n">ic</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">particleA</span> <span class="o">==</span> <span class="s1">&#39;H1&#39;</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span><span class="n">ic</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">=</span><span class="n">ic</span>
                            <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span> <span class="nb">str</span><span class="p">,</span> <span class="n">row</span> <span class="p">)</span> <span class="p">)</span> <span class="p">),</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="se">\\</span><span class="s1">hline&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getCrossSection_thermal"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getCrossSection_thermal">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection_thermal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test thermal point&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="mf">0.0235339347844</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">45.04182664</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">66.22034846</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">20.68451381</span><span class="p">,</span>
                  <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span> <span class="mf">0.49679</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getCrossSection_on_resonance"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getCrossSection_on_resonance">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection_on_resonance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="mf">68236.16</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">0.027265712318584909</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">15.374001449458987</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                  <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">15.346725225821752</span><span class="p">,</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span> <span class="mf">1.0511318650923915e-05</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getCrossSection_below_upperBound"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getCrossSection_below_upperBound">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection_below_upperBound</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="mf">1199999.0</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mf">0.00023637877870793497</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="mf">3.5295657156959384</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                  <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mf">3.5293200408304597</span><span class="p">,</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span> <span class="mf">9.2960867706728532e-06</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_k_competitive"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_k_competitive">[docs]</a>    <span class="k">def</span> <span class="nf">test_k_competitive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">gCl36</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="n">nCl35</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="n">pSi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># mass of gamma is zero, so this equation for k really doesn&#39;t make sense</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span> <span class="n">pA</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span>  <span class="c1"># checks what happens for array arguments used in broadcasting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">nCl35</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">nCl35</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="mf">4.0</span><span class="p">))</span>  <span class="c1"># should reduce to regular k(E) function for neutron+residual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="mf">4.0</span><span class="p">),</span>
                               <span class="mi">5</span><span class="p">)</span>  <span class="c1"># should be close, since mass_p very close to mass_n</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_rho"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_rho">[docs]</a>    <span class="k">def</span> <span class="nf">test_rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">scatteringRadiiTrue</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span> <span class="n">c</span><span class="p">),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">]),</span> <span class="n">pA</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">scatteringRadiiTrue</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="p">)</span>

        <span class="c1"># Code below is for getting a table of etas for the test case</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">egrid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
            <span class="n">rhos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">E</span><span class="p">,</span><span class="n">rho</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span><span class="n">rhos</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_rhohat"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_rhohat">[docs]</a>    <span class="k">def</span> <span class="nf">test_rhohat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rhohat</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k_competitive</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">scatteringRadiiEffective</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_eta"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_eta">[docs]</a>    <span class="k">def</span> <span class="nf">test_eta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">gCl36</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="n">nCl35</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="n">pSi</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">nCl35</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">nCl35</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># neutron has no charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">gCl36</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                         <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># gamma has no charge, but no mass, still should get 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0e4</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">12.644818547132786</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                               <span class="mf">1264.4818547132786</span><span class="p">)</span>  <span class="c1"># I checked the number by hand, so it should be OK</span>

        <span class="c1"># Code below is for getting a table of etas for the test case</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
            <span class="n">etas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRR</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Ex</span><span class="o">=</span><span class="n">egrid</span><span class="p">,</span> <span class="n">pA</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pB</span><span class="o">=</span><span class="n">pSi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">E</span><span class="p">,</span> <span class="n">eta</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">etas</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_omega"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_omega">[docs]</a>    <span class="k">def</span> <span class="nf">test_omega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;-336933.4       4.64807322355   0.559844234898</span>
<span class="s2">                -180.65         3.17917512551   0.818513260471</span>
<span class="s2">                397.8154        3.17772298742   0.818887300086</span>
<span class="s2">                4250.762        3.16810132868   0.821374295713</span>
<span class="s2">                16356.12        3.13843081431   0.829139513199</span>
<span class="s2">                22396.4         3.12393433962   0.832987097258</span>
<span class="s2">                54932.0         3.04916293104   0.853413561834</span>
<span class="s2">                68236.16        3.02009796749   0.861626684168</span>
<span class="s2">                133988.4        2.88773859413   0.901119305908</span>
<span class="s2">                1205687.0       1.86505967179   1.39523525008</span>
<span class="s2">                1434336.0       1.75889799566   1.4794473608</span>
<span class="s2">                1441365.0       1.75591539878   1.48196034923</span>
<span class="s2">                7563145.0       0.883361945718  2.94578797536&quot;&quot;&quot;</span>
        <span class="n">E</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
            <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.35888357</span><span class="p">,</span> <span class="mf">1.26604766</span><span class="p">,</span> <span class="mf">1.26591687</span><span class="p">,</span> <span class="mf">1.2650475</span><span class="p">,</span> <span class="mf">1.2623361</span><span class="p">,</span> <span class="mf">1.26099436</span><span class="p">,</span> <span class="mf">1.25389057</span><span class="p">,</span> <span class="mf">1.25104352</span><span class="p">,</span> <span class="mf">1.2374289</span><span class="p">,</span>
                <span class="mf">1.07862856</span><span class="p">,</span> <span class="mf">1.05383212</span><span class="p">,</span> <span class="mf">1.05310261</span><span class="p">,</span> <span class="mf">0.72354639</span><span class="p">],</span>
            <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.52334065</span><span class="p">,</span> <span class="mf">2.27530609</span><span class="p">,</span> <span class="mf">2.27496936</span><span class="p">,</span> <span class="mf">2.27273204</span><span class="p">,</span> <span class="mf">2.26576466</span><span class="p">,</span> <span class="mf">2.26232263</span><span class="p">,</span> <span class="mf">2.24416284</span><span class="p">,</span> <span class="mf">2.23691496</span><span class="p">,</span>
                <span class="mf">2.20249416</span><span class="p">,</span> <span class="mf">1.82912803</span><span class="p">,</span> <span class="mf">1.77517636</span><span class="p">,</span> <span class="mf">1.77360531</span><span class="p">,</span> <span class="mf">1.13946071</span><span class="p">],</span>
            <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.52098202</span><span class="p">,</span> <span class="mf">3.08969274</span><span class="p">,</span> <span class="mf">3.08912795</span><span class="p">,</span> <span class="mf">3.0853768</span><span class="p">,</span> <span class="mf">3.0737105</span><span class="p">,</span> <span class="mf">3.06795573</span><span class="p">,</span> <span class="mf">3.03768805</span><span class="p">,</span> <span class="mf">3.02565158</span><span class="p">,</span>
                <span class="mf">2.96882766</span><span class="p">,</span> <span class="mf">2.3853411</span><span class="p">,</span> <span class="mf">2.30546092</span><span class="p">,</span> <span class="mf">2.30314969</span><span class="p">,</span> <span class="mf">1.42582168</span><span class="p">],</span>
            <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.38117882</span><span class="p">,</span> <span class="mf">3.76125109</span><span class="p">,</span> <span class="mf">3.76046377</span><span class="p">,</span> <span class="mf">3.75523618</span><span class="p">,</span> <span class="mf">3.73899517</span><span class="p">,</span> <span class="mf">3.73099327</span><span class="p">,</span> <span class="mf">3.68900893</span><span class="p">,</span> <span class="mf">3.67236062</span><span class="p">,</span>
                <span class="mf">3.59412368</span><span class="p">,</span> <span class="mf">2.8216383</span><span class="p">,</span> <span class="mf">2.71973696</span><span class="p">,</span> <span class="mf">2.71680072</span><span class="p">,</span> <span class="mf">1.64317353</span><span class="p">]}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">vals</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">srow</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
            <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srow</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">eta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srow</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rho</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srow</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span><span class="n">answers</span><span class="p">[</span><span class="n">L</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">omega</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">L</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getCoulombWavefunctions"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getCoulombWavefunctions">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCoulombWavefunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Baby test: eta = 0.0, F_l=rho*j_l(rho), so F_0=sin(rho), similarly, G_0 = cos(rho)</span>

<span class="sd">        Tougher test: Abramowitz &amp; Stegun have tables of F0 &amp; G0 in table 14.1.  If we can match all these, recursion</span>
<span class="sd">        ensures we can do any order</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Baby test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">getCoulombWavefunctions</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">eta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span> <span class="n">L</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                          <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)]),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)]))</span> <span class="p">)</span>

        <span class="c1"># Tougher test</span>
        <span class="n">rho</span>     <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span>  <span class="mf">5.0</span><span class="p">,</span>  <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">])</span>
        <span class="n">eta</span>     <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span>  <span class="mf">0.5</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span>  <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># These are the full precision values returned by COULFG:</span>
        <span class="c1">#</span>
        <span class="c1">#        answerF = numpy.array([ 5.16601500e-01,   2.27526211e-01,   2.04130067e-05,   3.71673341e-11,   2.96513633e-23,  \</span>
        <span class="c1">#                               -4.90455238e-01,   6.84937412e-01,   2.76730117e-02,   1.72075334e-06,   1.65159712e-16,  \</span>
        <span class="c1">#                                9.39186276e-01,   4.77560816e-01,   9.17944919e-01,   1.62627112e-03,   8.07087199e-12,  \</span>
        <span class="c1">#                               -8.13196123e-01,  -3.29225536e-01,  -2.29347373e-01,   1.03427445e+00,   5.45296368e-06])</span>
        <span class="c1">#</span>
        <span class="c1"># These are the numbers from Abramowitz and Stegun:</span>
        <span class="n">answerF</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">5.1660e-01</span><span class="p">,</span>   <span class="mf">2.2753e-01</span><span class="p">,</span>   <span class="mf">2.0413e-05</span><span class="p">,</span>   <span class="mf">3.6966e-11</span><span class="p">,</span>   <span class="mf">2.9556e-23</span><span class="p">,</span>
                               <span class="o">-</span><span class="mf">4.9046e-01</span><span class="p">,</span>   <span class="mf">6.8494e-01</span><span class="p">,</span>   <span class="mf">2.7673e-02</span><span class="p">,</span>   <span class="mf">1.7207e-06</span><span class="p">,</span>   <span class="mf">1.6477e-16</span><span class="p">,</span>
                                <span class="mf">9.3919e-01</span><span class="p">,</span>   <span class="mf">4.7756e-01</span><span class="p">,</span>   <span class="mf">9.1794e-01</span><span class="p">,</span>   <span class="mf">1.6263e-03</span><span class="p">,</span>   <span class="mf">8.0470e-12</span><span class="p">,</span>
                               <span class="o">-</span><span class="mf">8.1320e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">3.2923e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.2935e-01</span><span class="p">,</span>   <span class="mf">1.0343e+00</span><span class="p">,</span>   <span class="mf">5.4529e-06</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># These are the full precision values returned by COULFG:</span>
        <span class="c1">#</span>
        <span class="c1">#       answerG = numpy.array([  1.19748697e+00,   2.04309716e+00,   8.08552775e+03,   3.07242545e+09,   2.69426701e+21,</span>
        <span class="c1">#                               -9.34927038e-01,  -8.98414359e-01,   1.81934952e+01,   1.67636794e+05,   1.14367929e+15,</span>
        <span class="c1">#                               -4.14351069e-01,   9.42874243e-01,   1.60852456e+00,   3.07873217e+02,   3.57573124e+10,</span>
        <span class="c1">#                                6.03865910e-01,  -9.72428399e-01,   1.16571667e+00,   1.79968757e+00,   9.17224865e+04])</span>
        <span class="c1">#</span>
        <span class="c1"># These are the numbers from Abramowitz and Stegun:</span>
        <span class="n">answerG</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.1975e+00</span><span class="p">,</span>   <span class="mf">2.0431e+00</span><span class="p">,</span>   <span class="mf">8.0855e+03</span><span class="p">,</span>   <span class="mf">3.0882e+09</span><span class="p">,</span>   <span class="mf">2.7024e+21</span><span class="p">,</span>
                               <span class="o">-</span><span class="mf">9.3493e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">8.9841e-01</span><span class="p">,</span>   <span class="mf">1.8193e+01</span><span class="p">,</span>   <span class="mf">1.6764e+05</span><span class="p">,</span>   <span class="mf">1.1464e+15</span><span class="p">,</span>
                               <span class="o">-</span><span class="mf">4.1435e-01</span><span class="p">,</span>   <span class="mf">9.4287e-01</span><span class="p">,</span>   <span class="mf">1.6085e+00</span><span class="p">,</span>   <span class="mf">3.0787e+02</span><span class="p">,</span>   <span class="mf">3.5867e+10</span><span class="p">,</span>
                                <span class="mf">6.0387e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">9.7243e-01</span><span class="p">,</span>   <span class="mf">1.1657e+00</span><span class="p">,</span>   <span class="mf">1.7997e+00</span><span class="p">,</span>   <span class="mf">9.1723e+04</span><span class="p">])</span>
        <span class="n">F</span><span class="p">,</span><span class="n">G</span>     <span class="o">=</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">getCoulombWavefunctions</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>     <span class="n">F</span><span class="p">,</span>     <span class="n">answerF</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">),</span> <span class="s1">&#39;F0(rho,eta), </span><span class="si">%s</span><span class="s1"> should be </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">F</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">answerF</span><span class="p">))</span>  <span class="c1"># agreement terrible as exponent gets small</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">G</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">answerG</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">),</span> <span class="s1">&#39;G0(rho,eta), </span><span class="si">%s</span><span class="s1"> should be </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">answerG</span><span class="p">))</span>  <span class="c1"># agreement terrible as exponent gets big</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_coulombPenetrationFactor"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_coulombPenetrationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_coulombPenetrationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For eta=0, can compare to regular penetration factor function</span>
<span class="sd">        I guess we could make tougher tests...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">eta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>
                <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPenetrationFactor</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_coulombShiftFactor"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_coulombShiftFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_coulombShiftFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For eta=0, can compare to regular shift factor function</span>
<span class="sd">        I guess we could make tougher tests...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">eta</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>
                <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombShiftFactor</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_coulombPhi"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_coulombPhi">[docs]</a>    <span class="k">def</span> <span class="nf">test_coulombPhi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For eta=0, can compare to regular phase function</span>
<span class="sd">        I guess we could make tougher tests...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>

            <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> eta=0.01&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> eta=0.1&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> eta=0.5&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> eta=1.0&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coul&#39;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_coulombNormalizationFactor"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_coulombNormalizationFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_coulombNormalizationFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For L=0, Abramawitz &amp; Stegun have tabulated values of C_{L=0}(eta).  See table 14.2, p. 554</span>
<span class="sd">        I checked the values at eta = 0.1, 1.0 and 2.0 and they match.  Also,</span>

<span class="sd">            ..math::</span>
<span class="sd">                C_L(0)=2^L \\Gamma(L+1)/\\Gamma(2L+2) = 1/(2L+1)</span>

<span class="sd">        and (A&amp;S, eq. 14.1.10)</span>

<span class="sd">            ..math::</span>
<span class="sd">                C_L(\\eta) = \frac{ \\sqrt{L^2+\\eta^2} }{ L(2L+1) } C_{L-1}(\\eta)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">])</span>
        <span class="n">L0_answers</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">8.47658520e-01</span><span class="p">,</span> <span class="mf">1.08422513e-01</span><span class="p">,</span> <span class="mf">6.61992e-3</span><span class="p">,</span> <span class="mf">1.80022337e-13</span><span class="p">,</span> <span class="mf">0.00000000e+00</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">CL_answers</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">L0_answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="n">eta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">eta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">CL_answers</span><span class="p">(</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span><span class="n">L</span><span class="p">:</span> <span class="p">[</span><span class="n">CL_answers</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eta</span><span class="p">))]</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAllWithinXPercent</span><span class="p">(</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombNormalizationFactor</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">eta</span><span class="p">),</span> <span class="n">answers</span><span class="p">[</span><span class="n">L</span><span class="p">],</span> <span class="mf">0.0001</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getEiPhis"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getEiPhis">[docs]</a>    <span class="k">def</span> <span class="nf">test_getEiPhis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">listAssertEqual</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;assertCountEqual&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">listAssertEqual</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">listAssertEqual</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;assertItemsEqual&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">Es</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0e5</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>
        <span class="n">phiMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getEiPhis</span><span class="p">(</span><span class="n">Ein</span><span class="o">=</span><span class="n">Es</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">phiFromPhiMatrix</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">phiMatrix</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
            <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rhohat</span><span class="p">(</span><span class="n">Es</span><span class="o">-</span><span class="n">c</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">NEUTRONCHANNEL</span><span class="p">:</span>
                <span class="n">phiAnswer</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Es</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">phiFromPhiMatrix</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="n">iE</span><span class="p">],</span> <span class="n">phiAnswer</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">GAMMACHANNEL</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">FISSIONCHANNEL</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">CPCHANNEL</span><span class="p">:</span>
                <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                <span class="n">eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Es</span><span class="o">-</span><span class="n">c</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">)</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPhi</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">)</span>
                <span class="n">wc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">omega</span><span class="p">(</span><span class="n">eta</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">listAssertEqual</span><span class="p">(</span><span class="n">wc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wc</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>
                <span class="n">phiAnswer</span> <span class="o">=</span> <span class="n">wc</span><span class="o">-</span><span class="n">phi</span>
                <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Es</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">phiFromPhiMatrix</span><span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="n">iE</span><span class="p">],</span> <span class="n">phiAnswer</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getL0Matrix"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getL0Matrix">[docs]</a>    <span class="k">def</span> <span class="nf">test_getL0Matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">E</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">16356.12</span><span class="p">,</span> <span class="mf">133988.4</span><span class="p">,</span> <span class="mf">4.0e4</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
            <span class="n">L0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getL0Matrix</span><span class="p">(</span><span class="n">Ein</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                <span class="n">L0cc</span> <span class="o">=</span> <span class="n">L0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()[</span><span class="n">ic</span><span class="p">]</span>
                <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">NEUTRONCHANNEL</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">L0cc</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">GAMMACHANNEL</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">L0cc</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">FISSIONCHANNEL</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">L0cc</span><span class="p">,</span> <span class="nb">complex</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">c</span><span class="o">.</span><span class="n">channelClass</span> <span class="o">==</span> <span class="n">CPCHANNEL</span><span class="p">:</span>
                    <span class="c1"># We can&#39;t test the equations with Coulomb turned on as I don&#39;t have numerical</span>
                    <span class="c1"># results to compare to.  However, I can compare to the results if Coulomb is turned off --</span>
                    <span class="c1"># I&#39;d better get the neutron numbers.  To turn off the Coulomb force, set eta to zero</span>
                    <span class="n">fake_eta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">])</span>
                    <span class="n">F</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">getCoulombWavefunctions</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">]),</span> <span class="n">fake_eta</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">)</span>
                    <span class="n">F1</span><span class="p">,</span> <span class="n">G1</span> <span class="o">=</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">getCoulombWavefunctions</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">]),</span> <span class="n">fake_eta</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">S1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">fake_eta</span><span class="p">)</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">])</span>
                    <span class="n">R1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">fake_eta</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">A2</span> <span class="o">=</span> <span class="n">F</span> <span class="o">*</span> <span class="n">F</span> <span class="o">+</span> <span class="n">G</span> <span class="o">*</span> <span class="n">G</span>
                    <span class="n">shift</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">S1</span> <span class="o">-</span> <span class="n">R1</span> <span class="o">*</span> <span class="p">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">G1</span> <span class="o">+</span> <span class="n">F</span> <span class="o">*</span> <span class="n">F1</span><span class="p">)</span> <span class="o">/</span> <span class="n">A2</span><span class="p">)</span>
                    <span class="n">penet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">])</span> <span class="o">/</span> <span class="n">A2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">complex</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="n">penet</span><span class="p">),</span> <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">shiftFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="p">),</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="p">)))</span>

                    <span class="c1"># This is  a tougher test, it checks whether the L0&#39;s imaginary part matches the penetrability</span>
                    <span class="c1"># factor computed in the coulombPenetrationFactor function</span>
                    <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                    <span class="n">real_eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E</span><span class="p">])</span> <span class="o">-</span> <span class="n">c</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">L0cc</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPenetrationFactor</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">rho</span><span class="p">]),</span> <span class="n">real_eta</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getRMatrix"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getRMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">test_getRMatrix</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        iER == 4 details:</span>
<span class="sd">            ER = 16356.12 eV</span>
<span class="sd">            GAMg = 0.3865 eV</span>
<span class="sd">            redGAM list = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 36.504003097726347,</span>
<span class="sd">                           94.126905092341858]</span>
<span class="sd">            last two channels (which have non-zero reduced widths) are:</span>
<span class="sd">                ChannelDesignator(1, 3.0, &#39;n + Cl35&#39;, 0, 2, gfact=0.875, particleA=n, particleB=Cl35, Xi=-0.0,</span>
<span class="sd">                                  isElastic=True, channelClass=1, useRelativistic=False, eliminated=False) and</span>
<span class="sd">                ChannelDesignator(1, 3.0, &#39;H1 + S35&#39;, 0, 2, gfact=0.875, particleA=H1, particleB=S35, Xi=-632965.817883,</span>
<span class="sd">                                  isElastic=False, channelClass=2, useRelativistic=False, eliminated=False)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">energy_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
        <span class="n">ERs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">energy_indices</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_indices</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span><span class="n">ERs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">iER</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">energy_indices</span><span class="p">):</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="n">ERs</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ER</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="n">cg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">iER</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">cg</span><span class="p">]:</span>
                    <span class="n">gGamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">[</span><span class="n">cg</span><span class="p">][</span><span class="n">iER</span><span class="p">]</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">iER</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c1</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">c1Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c1</span><span class="p">][</span><span class="n">iER</span><span class="p">]</span>
                <span class="n">rho1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">iER</span><span class="p">]])</span> <span class="o">-</span> <span class="n">c1</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
                <span class="n">pa1</span><span class="p">,</span> <span class="n">pb1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c1</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                <span class="n">eta1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">iER</span><span class="p">]])</span> <span class="o">-</span> <span class="n">c1</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pa1</span><span class="p">,</span> <span class="n">pb1</span><span class="p">)</span>
                <span class="n">c1Pen</span> <span class="o">=</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPenetrationFactor</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho1</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="n">eta1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">iER</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c2</span><span class="p">]:</span>
                        <span class="k">continue</span>
                    <span class="n">c2Gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">c2</span><span class="p">][</span><span class="n">iER</span><span class="p">]</span>
                    <span class="n">rho2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">iER</span><span class="p">]])</span> <span class="o">-</span> <span class="n">c2</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
                    <span class="n">pa2</span><span class="p">,</span> <span class="n">pb2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c2</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                    <span class="n">eta2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">[</span><span class="n">iER</span><span class="p">]])</span> <span class="o">-</span> <span class="n">c2</span><span class="o">.</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pa2</span><span class="p">,</span> <span class="n">pb2</span><span class="p">)</span>
                    <span class="n">c2Pen</span> <span class="o">=</span> <span class="n">getCoulombWavefunctions</span><span class="o">.</span><span class="n">coulombPenetrationFactor</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">eta2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">correctAnswer</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c1Gamma</span> <span class="o">*</span> <span class="n">c2Gamma</span> <span class="o">/</span> <span class="n">c1Pen</span> <span class="o">/</span> <span class="n">c2Pen</span><span class="p">)</span> <span class="o">/</span> <span class="n">gGamma</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">],</span> <span class="n">correctAnswer</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getXMatrix_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getXMatrix_Small">[docs]</a>    <span class="k">def</span> <span class="nf">test_getXMatrix_Small</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Print a table for plotting the X matrix</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">31733.7</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getXMatrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getRMatrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
        <span class="n">L0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getL0Matrix</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;these channels:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span> <span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>

        <span class="c1"># Test specific values, last two rows/columns correspond to an isolated resonance so reuse LRF=3 unit test</span>
        <span class="k">for</span> <span class="n">iE</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
                                   <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">7</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                   <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">*</span> <span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">L0</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">7</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_rho_eta_values"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_rho_eta_values">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;not a test at all, purely for debugging&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_rho_eta_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># set up the channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>

        <span class="c1"># get the energies for evaluating the cross section and of the resonances</span>
        <span class="n">ERs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">)</span>
        <span class="n">Es</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">())</span>

        <span class="c1"># find the p+S channel so we can get the threshold energy and particles</span>
        <span class="k">for</span> <span class="n">ic</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span>
                <span class="n">Xi</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">Xi</span>
                <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="c1"># get rhos and etas</span>
        <span class="n">resEta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">ERs</span><span class="o">-</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">)</span>
        <span class="n">resRho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">ERs</span><span class="o">-</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">xsEta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">Es</span><span class="o">-</span><span class="n">Xi</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">)</span>
        <span class="n">xsRho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">Es</span><span class="o">-</span><span class="n">Xi</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"># E (eV)        eta             rho&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Es</span><span class="p">,</span> <span class="n">xsEta</span><span class="p">,</span> <span class="n">xsRho</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">)]))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ERs</span><span class="p">,</span> <span class="n">resEta</span><span class="p">,</span> <span class="n">resRho</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">y</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">x</span><span class="p">)]))</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getScatteringMatrixUUnitarity_Small">[docs]</a>    <span class="k">def</span> <span class="nf">test_getScatteringMatrixUUnitarity_Small</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The RML parameterization might have a unitary U matrix.  Here we have two tests:</span>

<span class="sd">            * just plain multiplication: U^+ * U == one</span>

<span class="sd">            * check the Frobenius norm, which is ||A|| = sqrt(| sum_{i,j} |A[i,j]|^2 |), so the norm of the identity</span>
<span class="sd">              matrix is sqrt( ndim )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()[::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">UU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iEE</span><span class="p">,</span> <span class="n">EE</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">EE</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
                      <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span>
                      <span class="n">UU</span><span class="p">[</span><span class="n">iEE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">UU</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">16356.12</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="nb">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">E</span> <span class="o">==</span> <span class="n">egrid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># on resonance, expect to be good to only 10%</span>
                <span class="n">numDecimalPlaces</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">rtol</span> <span class="o">=</span> <span class="mf">5e-02</span>  <span class="c1"># nominal value: 1e-03</span>
                <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-02</span>  <span class="c1"># nominal value: 1e-04</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">numDecimalPlaces</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-03</span>  <span class="c1"># nominal value: 1e-03</span>
                <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-04</span>  <span class="c1"># nominal value: 1e-04</span>
            <span class="n">theNorm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">])</span>
            <span class="n">expectedNorm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span>
                <span class="n">theNorm</span><span class="p">,</span>
                <span class="n">expectedNorm</span><span class="p">,</span>
                <span class="n">rtol</span> <span class="o">*</span> <span class="mf">100.</span><span class="p">,</span> <span class="n">atol</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Small"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Small">[docs]</a>    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Small</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="kc">False</span>

        <span class="c1"># Set up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">()</span>
        <span class="n">nChan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">)</span>
        <span class="n">nElim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eliminatedChannels</span><span class="p">)</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">_energies</span><span class="p">)</span>

        <span class="c1"># Column labels!</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#</span><span class="se">\n</span><span class="s1"># All Waves (full grid), </span><span class="si">%i</span><span class="s1"> kept channels, </span><span class="si">%i</span><span class="s1"> eliminated channels, </span><span class="si">%i</span><span class="s1"> resonances&#39;</span>
                  <span class="o">%</span><span class="p">(</span><span class="n">nChan</span><span class="p">,</span> <span class="n">nElim</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;#      E (eV)       SigTotU (b)    SigTotSum (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   &#39;</span>
                <span class="s1">&#39;SigNeuU (b)    SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  SigPot       rho            &#39;</span>
                <span class="s1">&#39;eta         SigNPU (b)   SigNPOK (b)   SigNPInt (b)&#39;</span><span class="p">)</span>

        <span class="c1"># We can&#39;t eat the whole energy grid, so we&#39;ll do it in parts</span>
        <span class="n">fullEgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">energyCohortLength</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">nEnergyCohorts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">//</span><span class="n">energyCohortLength</span>
        <span class="n">lastEnergyCohortSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">%</span><span class="n">energyCohortLength</span>
        <span class="n">energyCohorts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">iec</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">,</span> <span class="p">(</span><span class="n">iec</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">)</span> <span class="k">for</span> <span class="n">iec</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nEnergyCohorts</span><span class="p">)]</span>
        <span class="n">energyCohorts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">lastEnergyCohortSize</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">iStart</span><span class="p">,</span> <span class="n">iStop</span> <span class="ow">in</span> <span class="n">energyCohorts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span> <span class="c1">#[4:7]:</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">fullEgrid</span><span class="p">[</span><span class="n">iStart</span><span class="p">:</span><span class="n">iStop</span><span class="p">]</span>
            <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getScatteringMatrixT</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

            <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                     <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span><span class="p">)</span>
            <span class="n">Bn</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">]</span>
            <span class="n">Bp</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">]</span>  <span class="c1"># FIXME, dictionary only contains elastic right now</span>
            <span class="n">phis</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rhohat</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNPWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;n + Cl35&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">nLs</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                    <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                    <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;n + Cl35&#39;</span><span class="p">:</span>
                            <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">])</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;H1 + S35&#39;</span><span class="p">:</span>
                            <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E</span><span class="o">-</span><span class="n">c2</span><span class="o">.</span><span class="n">Xi</span><span class="p">]),</span><span class="n">c2</span><span class="p">)</span>
                            <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">particlePairs</span><span class="p">[</span><span class="n">c2</span><span class="p">]</span><span class="o">.</span><span class="n">reactionInfo</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
                            <span class="n">eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">eta</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E</span><span class="o">-</span><span class="n">c2</span><span class="o">.</span><span class="n">Xi</span><span class="p">]),</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">)</span>
                            <span class="n">sigNPWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span> <span class="n">ic1</span><span class="p">,</span> <span class="n">ic2</span><span class="p">])</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">sigTotWithU</span> <span class="o">-</span> <span class="n">sigNeuWithU</span> <span class="o">-</span> <span class="n">sigNPWithU</span>
                <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span>
                              <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">[</span><span class="n">ic1</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span><span class="o">/</span><span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span><span class="p">])</span>
                <span class="n">sigNeuInt</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Bn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                <span class="n">sigNPInt</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Bp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span>
                        <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigNeuWithU</span> <span class="o">/</span> <span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span>
                        <span class="n">sigNPWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNPInt</span><span class="p">))</span>  <span class="c1"># , -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

                <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
                <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigNPWithU</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

                <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
                <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span><span class="p">)</span>  <span class="c1"># fails badly for some high energy P wave resonances??</span>

                <span class="c1"># Check agree with getCrossSection()</span>
                <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">iE</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span> <span class="p">(</span><span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">+</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigNPWithU</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">((</span><span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">+</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigNPWithU</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">)</span>
                    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span>  <span class="c1"># expected to fail</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span><span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">1.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Fe"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_scatteringMatrixUInCrossSectionCalculation_Fe">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="n">DOFETESTS</span><span class="p">,</span><span class="s1">&#39;in dev&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_scatteringMatrixUInCrossSectionCalculation_Fe</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">doTests</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="kc">True</span>

        <span class="c1"># Column labels!</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;#      E (eV)       SigTotU (b)    SigTotSum (b)    SigTotOK (b)   SigGamU (b)    SigGamOK (b)   &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;SigNeuU (b)    SigNeuOK (b)   SigNeuInt (b) SigNeuInt/SigNeuU  SigPot       SigNPU (b)   &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;SigNPOK (b)   SigNPInt (b)&#39;</span><span class="p">)</span>

        <span class="c1"># We can&#39;t eat the whole energy grid, so we&#39;ll do it in parts</span>
        <span class="n">fullEgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">energyCohortLength</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">nEnergyCohorts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">//</span><span class="n">energyCohortLength</span>
        <span class="n">lastEnergyCohortSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">%</span><span class="n">energyCohortLength</span>
        <span class="n">energyCohorts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">iec</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">,</span> <span class="p">(</span><span class="n">iec</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">)</span> <span class="k">for</span> <span class="n">iec</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nEnergyCohorts</span><span class="p">)]</span>
        <span class="n">energyCohorts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">lastEnergyCohortSize</span><span class="p">))</span>

        <span class="n">iStartCohort</span><span class="o">=</span><span class="mi">4124</span>
        <span class="n">iCohort</span><span class="o">=</span><span class="n">iStartCohort</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">iStopCohort</span><span class="o">=</span><span class="n">iStartCohort</span><span class="o">+</span><span class="mi">2</span>

        <span class="k">for</span> <span class="n">iStart</span><span class="p">,</span><span class="n">iStop</span> <span class="ow">in</span> <span class="n">energyCohorts</span><span class="p">[</span><span class="n">iStartCohort</span><span class="p">:</span><span class="n">iStopCohort</span><span class="p">]:</span>

            <span class="c1"># Full egrid of this cohort of energies</span>
            <span class="n">iCohort</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">cohortEgrid</span> <span class="o">=</span> <span class="n">fullEgrid</span><span class="p">[</span><span class="n">iStart</span><span class="p">:</span><span class="n">iStop</span><span class="p">]</span>
            <span class="n">cohortEgrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cohortEgrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cohortEgrid</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Deal with potential thresholds</span>
            <span class="n">thresholdIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">Xi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">_thresholds</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Xi</span> <span class="ow">in</span> <span class="n">cohortEgrid</span><span class="p">:</span>
                    <span class="n">thresholdIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cohortEgrid</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">Xi</span><span class="p">))</span>
            <span class="n">thresholdIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">subgrids</span> <span class="o">=</span> <span class="p">[</span><span class="n">cohortEgrid</span><span class="p">[</span><span class="n">thresholdIndices</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">thresholdIndices</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thresholdIndices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))]</span>

            <span class="k">for</span> <span class="n">egrid</span> <span class="ow">in</span> <span class="n">subgrids</span><span class="p">:</span>
                <span class="c1"># Set up channels on this energy grid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="n">Ein</span><span class="o">=</span><span class="n">egrid</span> <span class="p">)</span>
                <span class="n">nChan</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">channels</span> <span class="p">)</span>
                <span class="n">nElim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">eliminatedChannels</span> <span class="p">)</span>
                <span class="n">nRes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">_energies</span> <span class="p">)</span>

                <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">getScatteringMatrixU</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
                <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">getScatteringMatrixT</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">useTabulatedScatteringRadius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">k</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span>
                <span class="n">nLs</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>

                <span class="n">sigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span> <span class="n">egrid</span> <span class="p">)</span>
                <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
                <span class="n">Bn</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s1">&#39;n + Fe56&#39;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>              <span class="n">Bnn</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="s1">&#39;n + Fe56_e1&#39;</span><span class="p">]</span>  <span class="c1"># FIXME raises KeyError since dictionary only contains &#39;elastic&#39;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  <span class="n">Bnn</span> <span class="o">=</span> <span class="p">[</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span> <span class="p">]</span>
                <span class="n">phis</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">rhohat</span><span class="p">(</span><span class="n">egrid</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">channels</span> <span class="p">]</span>

                <span class="k">for</span> <span class="n">iE</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                    <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNNWithU</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
                    <span class="k">for</span> <span class="n">ic1</span><span class="p">,</span><span class="n">c1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">reaction</span> <span class="o">!=</span> <span class="s1">&#39;n + Fe56&#39;</span><span class="p">:</span> <span class="k">continue</span>
                        <span class="n">nLs</span><span class="p">[</span> <span class="n">c1</span><span class="o">.</span><span class="n">l</span> <span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                        <span class="n">sigTotWithU</span> <span class="o">+=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                        <span class="k">for</span> <span class="n">ic2</span><span class="p">,</span><span class="n">c2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RRRFe</span><span class="o">.</span><span class="n">channels</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">J</span> <span class="o">!=</span> <span class="n">c1</span><span class="o">.</span><span class="n">J</span><span class="p">:</span> <span class="k">continue</span>
                            <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;n + Fe56&#39;</span><span class="p">:</span>
                                <span class="n">sigNeuWithU</span> <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">T</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic2</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span> <span class="p">)</span>
                            <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="s1">&#39;n + Fe56_e1&#39;</span><span class="p">:</span>
                                <span class="n">sigNNWithU</span>  <span class="o">+=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">c1</span><span class="o">.</span><span class="n">gfact</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">T</span><span class="p">[</span><span class="n">iE</span><span class="p">,</span><span class="n">ic1</span><span class="p">,</span><span class="n">ic2</span><span class="p">]</span> <span class="p">)</span> <span class="o">/</span> <span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span> <span class="p">)</span>
                    <span class="n">sigGamWithU</span> <span class="o">=</span> <span class="n">sigTotWithU</span> <span class="o">-</span> <span class="n">sigNeuWithU</span> <span class="o">-</span> <span class="n">sigNNWithU</span>
                    <span class="n">sigPot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="p">(</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phis</span><span class="p">[</span><span class="n">ic1</span><span class="p">][</span><span class="n">iE</span><span class="p">])</span><span class="o">/</span><span class="n">k</span><span class="p">[</span><span class="n">iE</span><span class="p">],</span> <span class="mf">2.0</span> <span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nLs</span> <span class="p">]</span> <span class="p">)</span>
                    <span class="n">sigNeuInt</span>  <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Bn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
                    <span class="n">sigNNInt</span>   <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">Bnn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>

                    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%15.14g</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">13</span><span class="o">*</span><span class="s1">&#39;</span><span class="si">%10g</span><span class="s1">     &#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span> <span class="n">E</span><span class="p">,</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNeuInt</span><span class="p">,</span>  <span class="n">sigNeuWithU</span><span class="o">/</span><span class="n">sigNeuInt</span><span class="p">,</span> <span class="n">sigPot</span><span class="p">,</span> <span class="n">sigNNWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;n + Fe56_e1&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="n">sigNNInt</span> <span class="p">)</span> <span class="c1">#, -(sigNeuWithU-sigs[&#39;elastic&#39;][iE])/sigPot )</span>

                    <span class="c1"># Check they sum up correctly (really just another test of unitarity)</span>
                    <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigTotWithU</span><span class="p">,</span> <span class="n">sigGamWithU</span> <span class="o">+</span> <span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigNNWithU</span><span class="p">,</span> <span class="mf">1.</span> <span class="p">)</span>

                    <span class="c1"># Check elastic channel agrees with L=0 term of angular distribution</span>
                    <span class="k">if</span> <span class="n">doTests</span> <span class="ow">and</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigNeuInt</span> <span class="p">)</span> <span class="c1"># fails badly for some high energy P wave resonances??</span>

                    <span class="c1"># Check agree with getCrossSection()</span>
                    <span class="k">if</span> <span class="n">doTests</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span><span class="o">+</span><span class="n">sigNeuWithU</span> <span class="o">+</span> <span class="n">sigNNWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">1.</span> <span class="p">)</span>
                        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigGamWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># expected to fail</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="n">sigNeuWithU</span><span class="p">,</span> <span class="n">sigs</span><span class="p">[</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">iE</span><span class="p">],</span> <span class="mf">1.</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestRMLClassAndBaseClasses.test_getAngularDistribution"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestRMLClassAndBaseClasses.test_getAngularDistribution">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;in dev&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getAngularDistribution</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Note, Blatt-Biedenharn&#39;s Z coefficient has a factor of (l1,l2,0,0;L,0) (a Clebsch-Gordan coefficient) in it.</span>
<span class="sd">        As a result, if l1 and l2 cannot couple to L, one gets zero.</span>

<span class="sd">        FIXME: update this: spingroup 5 has l=1, j=1, s=2, single P-wave resonance</span>

<span class="sd">        In our simple P-wave example, the U matrix has l=0 and 1 parts to it because you need the l=0 terms to get the</span>
<span class="sd">        potential scattering right, even if there is only one resonance.  Therefore, we expect L = 0, 1, and 2 terms since</span>
<span class="sd">        those are all the L&#39;s we can get by coupling any pair of l=0 and 1 together.  Because of this, the angular distribution</span>
<span class="sd">        that you get from a single MLBW resonance is different that that of a single SLBW resonance (at least the way</span>
<span class="sd">        you need to do things for ENDF).</span>

<span class="sd">        We tested the hell out of the L=0 term.</span>

<span class="sd">        We can test the L=1,2 terms on resonance by observing that the potential scattering in the l&gt;0 collision matrices is much</span>
<span class="sd">        smaller than that in the l=0 elements.  This allows us to ignore all but the purely resonance elements when directly on</span>
<span class="sd">        resonance (Ein=ER).   In our P-wave example, that means that our MLBW on resonance angular distribution should match the</span>
<span class="sd">        SLBW result (_but only on resonance_).  We reuse the test below, but only approximately.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">doTest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">setResonanceParametersByChannel</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">egrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="n">eStep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">J</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># for this test data</span>
        <span class="n">S</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="c1"># for this test data</span>

        <span class="kn">from</span> <span class="nn">numericalFunctions</span> <span class="kn">import</span> <span class="n">angularMomentumCoupling</span> <span class="k">as</span> <span class="n">nf_amc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S</span><span class="p">),</span> <span class="mi">4</span> <span class="p">)</span> <span class="o">/</span> <span class="n">nf_amc</span><span class="o">.</span><span class="n">z_coefficient</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">J</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">S</span><span class="p">),</span> <span class="mi">0</span> <span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span> <span class="p">)</span> <span class="c1"># nf_amc functions use the 2J trick</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="c1"># We can&#39;t eat the whole energy grid, so we&#39;ll do it in parts</span>
            <span class="n">fullEgrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
            <span class="n">energyCohortLength</span> <span class="o">=</span> <span class="mi">50</span>
            <span class="n">nEnergyCohorts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">//</span><span class="n">energyCohortLength</span>
            <span class="n">lastEnergyCohortSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullEgrid</span><span class="p">)</span><span class="o">%</span><span class="n">energyCohortLength</span>
            <span class="n">energyCohorts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">iec</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">,</span> <span class="p">(</span><span class="n">iec</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">energyCohortLength</span><span class="p">)</span> <span class="k">for</span> <span class="n">iec</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nEnergyCohorts</span><span class="p">)]</span>
            <span class="n">energyCohorts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">energyCohorts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">lastEnergyCohortSize</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">iStart</span><span class="p">,</span><span class="n">iStop</span> <span class="ow">in</span> <span class="n">energyCohorts</span><span class="p">:</span>
                <span class="n">egrid</span> <span class="o">=</span> <span class="n">fullEgrid</span><span class="p">[</span><span class="n">iStart</span><span class="p">:</span><span class="n">iStop</span><span class="p">]</span>
                <span class="n">egrid</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">egrid</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">Bn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">reactionp</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
                <span class="n">Bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">reactionp</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">Bn</span><span class="p">[</span><span class="n">L</span><span class="p">][</span><span class="n">iE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Bn</span><span class="p">))]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">iE</span><span class="p">,</span> <span class="n">E</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">egrid</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">[</span><span class="n">Bp</span><span class="p">[</span><span class="n">L</span><span class="p">][</span><span class="n">iE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Bp</span><span class="p">))]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">doTest</span><span class="p">:</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="mf">133988.4</span>
            <span class="n">Bn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">ER</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">reactionp</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
            <span class="n">Bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RRRSmall</span><span class="o">.</span><span class="n">getAngularDistribution</span><span class="p">(</span> <span class="n">ER</span><span class="p">,</span> <span class="n">renormalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reaction</span><span class="o">=</span><span class="s1">&#39;n + Cl35&#39;</span><span class="p">,</span> <span class="n">reactionp</span><span class="o">=</span><span class="s1">&#39;H1 + S35&#39;</span><span class="p">,</span> <span class="n">enableExtraCoulombPhase</span><span class="o">=</span><span class="n">enableExtraCoulombPhase</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">Bn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Bn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
            <span class="c1">#self.assertAlmostEqual( Bn[1]/Bn[0], 0.0, 3 )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span> <span class="n">Bp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Bp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span></div></div>
            <span class="c1">#self.assertAlmostEqual( Bp[1]/Bp[0], 0.0, 3 )</span>



<div class="viewcode-block" id="TestURRClassAndBaseClasses"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses">[docs]</a><span class="k">class</span> <span class="nc">TestURRClassAndBaseClasses</span><span class="p">(</span> <span class="n">TestWithIsClose</span> <span class="p">):</span>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.setUp"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span> <span class="o">=</span> <span class="n">URRcrossSection</span><span class="p">(</span> <span class="n">MLBWExampleZr90</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">unresolved</span><span class="o">.</span><span class="n">evaluated</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_memberData"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_memberData">[docs]</a>    <span class="k">def</span> <span class="nf">test_memberData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">,</span> <span class="mf">2e5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">upperBound</span><span class="p">,</span> <span class="mi">1780460</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">projectile</span><span class="p">),</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;Zr90&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">targetToNeutronMassRatio</span><span class="p">,</span> <span class="mf">89.13240000000002</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">targetSpin</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">L</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">Ls</span> <span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">useForSelfShieldingOnly</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="s1">&#39;tabulatedWidths&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">scatteringRadius</span><span class="o">.</span><span class="n">getValueAs</span><span class="p">(</span><span class="s1">&#39;fm&#39;</span><span class="p">)),</span> <span class="s1">&#39;7.16&#39;</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">LSection</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">URR</span><span class="o">.</span><span class="n">Ls</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">JSection</span> <span class="ow">in</span> <span class="n">LSection</span><span class="o">.</span><span class="n">Js</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">JSection</span><span class="o">.</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">degreesOfFreedom</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">JSection</span><span class="o">.</span><span class="n">widths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">degreesOfFreedom</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">JSection</span><span class="o">.</span><span class="n">widths</span><span class="p">),</span> <span class="mi">2</span> <span class="p">)</span>
                <span class="c1">#self.assertEqual(&#39;&#39;.join(JSection.energyDependentWidths.toXMLList()),</span>
                <span class="c1">#                 &#39;&lt;table rows=&quot;17&quot; columns=&quot;4&quot;&gt;  &lt;columnHeaders&gt;    &lt;column index=&quot;0&quot; name=&quot;energy&quot; unit=&quot;eV&quot;/&gt;    &lt;column index=&quot;1&quot; name=&quot;levelSpacing&quot; unit=&quot;eV&quot;/&gt;    &lt;column index=&quot;2&quot; name=&quot;neutronWidth&quot; unit=&quot;eV&quot;/&gt;    &lt;column index=&quot;3&quot; name=&quot;captureWidth&quot; unit=&quot;eV&quot;/&gt;&lt;/columnHeaders&gt;  &lt;data&gt;   &lt;!-- energy | levelSpacing | neutronWidth | captureWidth  --&gt;            2e5        8655.91      0.5280105      0.1416092            3e5       7811.708      0.4765142      0.1476385            4e5       7054.611      0.4303313      0.1538193            5e5       6375.102      0.3888812      0.1601527            6e5       5764.775      0.3516513      0.1666401            7e5       5216.188      0.3181875      0.1732827            8e5       4722.749      0.2880877      0.1800816            9e5       4278.602      0.2609947      0.1870381            1e6       3878.548      0.2365914      0.1941535          1.1e6       3517.969      0.2145961      0.2014288          1.2e6       3192.751      0.1947578      0.2088653          1.3e6       2899.241      0.1768537      0.2164641          1.4e6        2634.18       0.160685      0.2242264          1.5e6        2394.66      0.1460743      0.2321535          1.6e6       2178.092      0.1328636      0.2402462          1.7e6       1982.151      0.1209112       0.248506        1780460       1838.063      0.1121218      0.2552738&lt;/data&gt;&lt;/table&gt;&#39;)</span>
                <span class="k">break</span>
            <span class="k">break</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getFluctuationIntegrals"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getFluctuationIntegrals">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFluctuationIntegrals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Setup</span>
        <span class="n">egrid</span><span class="p">,</span><span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getWidthsAndSpacings</span><span class="p">()</span>

        <span class="n">expectedResults</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">1.10423</span><span class="p">,</span>  <span class="mf">1.19709086</span><span class="p">,</span>  <span class="mf">1.29434685</span><span class="p">,</span>  <span class="mf">1.39570657</span><span class="p">,</span>  <span class="mf">1.50079576</span><span class="p">,</span>
            <span class="mf">1.60915959</span><span class="p">,</span>  <span class="mf">1.72025964</span><span class="p">,</span>  <span class="mf">1.83348158</span><span class="p">,</span>  <span class="mf">1.94813968</span><span class="p">,</span>  <span class="mf">2.06348237</span><span class="p">,</span>
            <span class="mf">2.1787089</span> <span class="p">,</span>  <span class="mf">2.29297545</span><span class="p">,</span>  <span class="mf">2.40541568</span><span class="p">,</span>  <span class="mf">2.51515507</span><span class="p">,</span>  <span class="mf">2.62133055</span><span class="p">,</span>
            <span class="mf">2.72311404</span><span class="p">,</span>  <span class="mf">2.80128048</span><span class="p">]</span>

        <span class="n">LJ</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[</span><span class="n">LJ</span><span class="p">]:</span>
            <span class="n">widths</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[</span><span class="n">LJ</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="k">for</span> <span class="n">energy</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span> <span class="p">)</span>

        <span class="n">computedResults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getFluctuationIntegrals</span><span class="p">(</span>
            <span class="n">egrid</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="n">widths</span><span class="p">,</span> <span class="n">DOF</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">DOFs</span><span class="p">[</span><span class="n">LJ</span><span class="p">]</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

        <span class="c1"># Now compare them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">computedResults</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">expectedResults</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">computedResults</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getCrossSection"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getCrossSection">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCrossSection</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Test 1 MeV point&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getCrossSection</span><span class="p">(</span><span class="mf">1e+6</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span><span class="mf">6.6530426032410315</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span><span class="mf">6.648122758610173</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span><span class="p">:</span><span class="mf">0.004919844630858361</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">answer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="n">answer</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-14</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_rho"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_rho">[docs]</a>    <span class="k">def</span> <span class="nf">test_rho</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="o">=</span><span class="mf">0.</span><span class="p">),</span> <span class="mf">0.0</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWithinXPercent</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="o">=</span><span class="mf">10.</span><span class="p">),</span> <span class="mf">0.0043349938344906013</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part1"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part1">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWidthsAndSpacings_part1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Setup</span>
        <span class="n">egrid</span><span class="p">,</span><span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getWidthsAndSpacings</span><span class="p">()</span>

        <span class="c1"># Test level spacing stuff</span>
        <span class="n">levelSpacingAnswer</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">8655.91</span> <span class="p">,</span>  <span class="mf">7811.708</span><span class="p">,</span>  <span class="mf">7054.611</span><span class="p">,</span>  <span class="mf">6375.101</span><span class="p">,</span>  <span class="mf">5764.775</span><span class="p">,</span>  <span class="mf">5216.188</span><span class="p">,</span>
            <span class="mf">4722.749</span><span class="p">,</span>  <span class="mf">4278.602</span><span class="p">,</span>  <span class="mf">3878.548</span><span class="p">,</span>  <span class="mf">3517.969</span><span class="p">,</span>  <span class="mf">3192.751</span><span class="p">,</span>  <span class="mf">2899.241</span><span class="p">,</span>
            <span class="mf">2634.179</span><span class="p">,</span>  <span class="mf">2394.66</span> <span class="p">,</span>  <span class="mf">2178.092</span><span class="p">,</span>  <span class="mf">1982.151</span><span class="p">,</span>  <span class="mf">1838.063</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">D</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">levelSpacingAnswer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">levelSpacings</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">D</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">levelSpacings</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">),</span> <span class="n">D</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">levelDensities</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">D</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c1"># Test DOFs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">DOFs</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)],{</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part2"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part2">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWidthsAndSpacings_part2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Setup</span>
        <span class="n">egrid</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getWidthsAndSpacings</span><span class="p">()</span>

        <span class="c1"># Test width stuff</span>
        <span class="n">answerGrid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">200000.</span><span class="p">,</span> <span class="mf">300000.</span><span class="p">,</span> <span class="mf">400000.</span><span class="p">,</span> <span class="mf">500000.</span><span class="p">,</span> <span class="mf">600000.</span><span class="p">,</span> <span class="mf">700000.</span><span class="p">,</span>
            <span class="mf">800000.</span><span class="p">,</span> <span class="mf">900000.</span><span class="p">,</span> <span class="mf">1000000.</span><span class="p">,</span> <span class="mf">1100000.</span><span class="p">,</span> <span class="mf">1200000.</span><span class="p">,</span> <span class="mf">1300000.</span><span class="p">,</span>
            <span class="mf">1400000.</span><span class="p">,</span>  <span class="mf">1500000.</span><span class="p">,</span>  <span class="mf">1600000.</span><span class="p">,</span>  <span class="mf">1700000.</span><span class="p">,</span>  <span class="mf">1780460.</span><span class="p">]</span>
        <span class="n">elasticWidthAnswer</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">0.751608</span> <span class="p">,</span>  <span class="mf">0.6783044</span><span class="p">,</span>  <span class="mf">0.6125643</span><span class="p">,</span>  <span class="mf">0.5535613</span><span class="p">,</span>  <span class="mf">0.5005656</span><span class="p">,</span>
            <span class="mf">0.4529308</span><span class="p">,</span>  <span class="mf">0.4100846</span><span class="p">,</span>  <span class="mf">0.3715186</span><span class="p">,</span>  <span class="mf">0.3367811</span><span class="p">,</span>  <span class="mf">0.3054714</span><span class="p">,</span>
            <span class="mf">0.2772322</span><span class="p">,</span>  <span class="mf">0.2517462</span><span class="p">,</span>  <span class="mf">0.2287304</span><span class="p">,</span>  <span class="mf">0.2079326</span><span class="p">,</span>  <span class="mf">0.1891276</span><span class="p">,</span>
            <span class="mf">0.1721136</span><span class="p">,</span>  <span class="mf">0.1596022</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">Gam</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elasticWidthAnswer</span><span class="p">):</span>
            <span class="n">E</span><span class="o">=</span><span class="n">answerGrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">f</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">penetrationFactor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">rho</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="c1"># See ENDF Eq. (D.99)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)][</span><span class="s1">&#39;elastic&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gam</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)][</span><span class="s1">&#39;elastic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">Gam</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part3"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getWidthsAndSpacings_part3">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWidthsAndSpacings_part3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Setup</span>
        <span class="n">egrid</span><span class="p">,</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getWidthsAndSpacings</span><span class="p">()</span>

        <span class="c1"># Test width stuff</span>
        <span class="n">captureWidthAnswer</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">0.2450929</span><span class="p">,</span>  <span class="mf">0.2555282</span><span class="p">,</span>  <span class="mf">0.2662257</span><span class="p">,</span>  <span class="mf">0.2771873</span><span class="p">,</span>  <span class="mf">0.2884156</span><span class="p">,</span>  <span class="mf">0.2999123</span><span class="p">,</span>
            <span class="mf">0.3116797</span><span class="p">,</span>  <span class="mf">0.3237198</span><span class="p">,</span>  <span class="mf">0.3360349</span><span class="p">,</span>  <span class="mf">0.3486268</span><span class="p">,</span>  <span class="mf">0.3614976</span><span class="p">,</span>  <span class="mf">0.3746494</span><span class="p">,</span>
            <span class="mf">0.3880842</span><span class="p">,</span>  <span class="mf">0.401804</span><span class="p">,</span>   <span class="mf">0.4158108</span><span class="p">,</span>  <span class="mf">0.4301065</span><span class="p">,</span>  <span class="mf">0.44182</span>  <span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">Gam</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">captureWidthAnswer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)][</span><span class="s1">&#39;capture&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">Gam</span> <span class="p">)</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">averageWidths</span><span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)][</span><span class="s1">&#39;capture&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">egrid</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">Gam</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_generateEnergyGrid"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_generateEnergyGrid">[docs]</a>    <span class="k">def</span> <span class="nf">test_generateEnergyGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">answerGrid</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">200000.</span><span class="p">,</span> <span class="mf">300000.</span><span class="p">,</span> <span class="mf">400000.</span><span class="p">,</span> <span class="mf">500000.</span><span class="p">,</span> <span class="mf">600000.</span><span class="p">,</span> <span class="mf">700000.</span><span class="p">,</span>
            <span class="mf">800000.</span><span class="p">,</span> <span class="mf">900000.</span><span class="p">,</span> <span class="mf">1000000.</span><span class="p">,</span> <span class="mf">1100000.</span><span class="p">,</span> <span class="mf">1200000.</span><span class="p">,</span> <span class="mf">1300000.</span><span class="p">,</span>
            <span class="mf">1400000.</span><span class="p">,</span>  <span class="mf">1500000.</span><span class="p">,</span>  <span class="mf">1600000.</span><span class="p">,</span>  <span class="mf">1700000.</span><span class="p">,</span>  <span class="mf">1780460.</span><span class="p">]</span>
        <span class="n">computedGrid</span><span class="p">,</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">(</span><span class="n">interpolateWidths</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">answerGrid</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="n">computedGrid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">answerGrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">computedGrid</span><span class="p">,</span><span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">answerGrid</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="n">computedGrid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">answerGrid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestURRClassAndBaseClasses.test_getTransmissionCoefficientsFromSumRule"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.TestURRClassAndBaseClasses.test_getTransmissionCoefficientsFromSumRule">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;FIXME: needs work&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getTransmissionCoefficientsFromSumRule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">egrid</span><span class="p">,</span><span class="n">flag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">generateEnergyGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getWidthsAndSpacings</span><span class="p">()</span>
        <span class="n">Tcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Zr90URR</span><span class="o">.</span><span class="n">getTransmissionCoefficientsFromSumRule</span><span class="p">()</span>
        <span class="n">c</span><span class="o">=</span><span class="n">ChannelDesignator</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;elastic&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gfact</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">particleA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">particleB</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">isElastic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">channelClass</span><span class="o">=</span><span class="n">NEUTRONCHANNEL</span><span class="p">,</span> <span class="n">useRelativistic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eliminated</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">Tcs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">floatsAlmostEqual</span><span class="p">(</span> <span class="n">Tcs</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">3.0e+05</span><span class="p">),</span> <span class="mf">0.35007858733963815</span> <span class="p">)</span> <span class="p">)</span></div></div>

    <span class="c1"># def test_URRPDFTable(self):</span>
    <span class="c1">#     u = URRPDFTable()</span>
    <span class="c1">#     u.eBins = numpy.linspace(start=0.,stop=4.,num=2+1)</span>
    <span class="c1">#     u.xsBins = numpy.linspace(start=1.,stop=1.5,num=3+1)</span>
    <span class="c1">#     u[&#39;capture&#39;] = numpy.zeros(shape=(2, 3))</span>
    <span class="c1">#     u[&#39;capture&#39;][0, 0] = 1.</span>
    <span class="c1">#     u[&#39;capture&#39;][1, 2] = 2.</span>
    <span class="c1">#     u.save(&#39;__junk__.txt&#39;)</span>
    <span class="c1">#     v = URRPDFTable()</span>
    <span class="c1">#     v.load(&#39;__junk__.txt&#39;)</span>
    <span class="c1">#     os.remove(&#39;__junk__.txt&#39;)</span>
    <span class="c1">#     self.assertEqual(str(u),str(v))</span>


<div class="viewcode-block" id="Test_getRI_SI"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.Test_getRI_SI">[docs]</a><span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;didn&#39;t write the tests yet&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Test_getRI_SI</span><span class="p">(</span><span class="n">TestWithIsClose</span><span class="p">):</span>

<div class="viewcode-block" id="Test_getRI_SI.test_getRI_SI"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.Test_getRI_SI.test_getRI_SI">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;didn&#39;t write the test yet&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getRI_SI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1">#getRI_SI(E=0, Eres=0, captureWidth=0, widths=0, penetrabilities=0)</span></div></div>



<span class="c1"># ----------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   Arrange some of the tests in test suites</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="angular"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.angular">[docs]</a><span class="k">def</span> <span class="nf">angular</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tests of angular distribution reconstruction&quot;&quot;&quot;</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="c1"># SLBW tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getAngularDistribution_SWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getAngularDistribution_PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getAngularDistribution&quot;</span><span class="p">))</span>
    <span class="c1"># MLBW tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getAngularDistribution_PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getElasticAngularDistribution_Full&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getElasticAngularDistribution_Zr90&quot;</span><span class="p">))</span>
    <span class="c1"># Reich-Moore tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getElasticAngularDistribution_Small&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getElasticAngularDistribution_Full&quot;</span><span class="p">))</span>
    <span class="c1"># R-matrix limited tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMLClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getElasticAngularDistribution&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">suite</span></div>


<div class="viewcode-block" id="U"><a class="viewcode-back" href="../../../../../fudge/fudge.processing.resonances.test.html#fudge.processing.resonances.test.test_reconstructResonances.U">[docs]</a><span class="k">def</span> <span class="nf">U</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Tests of U matrix coding&quot;&quot;&quot;</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="c1"># SLBW tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUUnitarity&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUValue0&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUValue1&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUValue_1S&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUValue_1P&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_SWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestSLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_Full&quot;</span><span class="p">))</span>
    <span class="c1"># MLBW tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUValue_1PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUUnitarity_1PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUUnitarity_Full&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_1PWave&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestMLBWClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_Full&quot;</span><span class="p">))</span>
    <span class="c1"># Reich-Moore tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUUnitarity_Full&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixUUnitarity_Small&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_Full&quot;</span><span class="p">))</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_scatteringMatrixUInCrossSectionCalculation_Small&quot;</span><span class="p">))</span>
    <span class="c1"># R-matrix limited tests</span>
    <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">TestRMLClassAndBaseClasses</span><span class="p">(</span><span class="s2">&quot;test_getScatteringMatrixU&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">suite</span></div>


<span class="c1"># ----------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#   main!!!</span>
<span class="c1">#</span>
<span class="c1"># ----------------------------------------------------------------------------------</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Fudge and GNDS 4.2.3 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fudge.processing.resonances.test.test_reconstructResonances</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>