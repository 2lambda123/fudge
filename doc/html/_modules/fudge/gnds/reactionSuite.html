
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>fudge.gnds.reactionSuite &#8212; Fudge and GNDS 4.2.3 beta documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.2.3 beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/gnd-20121206-favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Fudge and GNDS 4.2.3 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fudge.gnds.reactionSuite</h1><div class="highlight"><pre>
<span></span><span class="c1"># &lt;&lt;BEGIN-copyright&gt;&gt;</span>
<span class="c1"># &lt;&lt;END-copyright&gt;&gt;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">reactionSuite.py contains the &#39;reactionSuite&#39; class that in turn holds all reactions for a given target/projectile.</span>
<span class="sd">reactionSuite is the top-level class for the GNDS structure.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">PoPs</span> <span class="k">import</span> <span class="n">IDs</span> <span class="k">as</span> <span class="n">IDsPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs</span> <span class="k">import</span> <span class="n">database</span> <span class="k">as</span> <span class="n">PoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.groups</span> <span class="k">import</span> <span class="n">misc</span> <span class="k">as</span> <span class="n">chemicalElementMiscPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.groups</span> <span class="k">import</span> <span class="n">chemicalElement</span> <span class="k">as</span> <span class="n">chemicalElementPoPsModule</span>
<span class="kn">from</span> <span class="nn">PoPs.decays</span> <span class="k">import</span> <span class="n">misc</span> <span class="k">as</span> <span class="n">decaysMiscPoPsModule</span>

<span class="kn">from</span> <span class="nn">xData</span> <span class="k">import</span> <span class="n">ancestry</span> <span class="k">as</span> <span class="n">ancestryModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="k">import</span> <span class="n">axes</span> <span class="k">as</span> <span class="n">axesModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="k">import</span> <span class="n">values</span> <span class="k">as</span> <span class="n">valuesModule</span>
<span class="kn">from</span> <span class="nn">xData</span> <span class="k">import</span> <span class="n">standards</span> <span class="k">as</span> <span class="n">standardsModule</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">suites</span> <span class="k">as</span> <span class="n">suitesModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">sums</span> <span class="k">as</span> <span class="n">sumsModule</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">styles</span> <span class="k">as</span> <span class="n">stylesModule</span>

<span class="kn">from</span> <span class="nn">.reactionData</span> <span class="k">import</span> <span class="n">crossSection</span> <span class="k">as</span> <span class="n">crossSectionModule</span>
<span class="kn">from</span> <span class="nn">.reactionData.doubleDifferentialCrossSection.chargedParticleElastic</span> <span class="k">import</span> <span class="n">CoulombPlusNuclearElastic</span> <span class="k">as</span> <span class="n">CoulombPlusNuclearElasticModule</span>

<span class="kn">from</span> <span class="nn">.version</span> <span class="k">import</span> <span class="n">GNDS_VERSION</span>

<span class="kn">import</span> <span class="nn">fudge</span>

<span class="n">__metaclass__</span> <span class="o">=</span> <span class="nb">type</span>

<div class="viewcode-block" id="nullDevice"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.nullDevice">[docs]</a><span class="k">class</span> <span class="nc">nullDevice</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;For internal use. Used in methods to set logFile when one is not entered.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="nullDevice.write"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.nullDevice.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span> <span class="k">pass</span></div></div>

<div class="viewcode-block" id="reactionSuite"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite">[docs]</a><span class="k">class</span> <span class="nc">reactionSuite</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span> <span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the main class for a gnds projectile/target object. It contains</span>
<span class="sd">        * documentation</span>
<span class="sd">        * a list of all particles encountered in the file</span>
<span class="sd">        * resonance data</span>
<span class="sd">        * a list of reactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">moniker</span> <span class="o">=</span> <span class="s1">&#39;reactionSuite&#39;</span>
    <span class="n">ancestryMembers</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;styles&#39;</span><span class="p">,</span> <span class="s1">&#39;reactions&#39;</span><span class="p">,</span> <span class="s1">&#39;orphanProducts&#39;</span><span class="p">,</span> <span class="s1">&#39;sums&#39;</span><span class="p">,</span> <span class="s1">&#39;productions&#39;</span><span class="p">,</span> <span class="s1">&#39;fissionComponents&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">GNDS_version</span> <span class="o">=</span> <span class="n">GNDS_VERSION</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">documentation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">standardsModule</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">labToken</span><span class="p">,</span> <span class="n">MAT</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">PoPs</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new reactionSuite object, containing all reaction data for a projectile/target combination.</span>

<span class="sd">        :param projectile: projectile ID (string)</span>
<span class="sd">        :param target: target ID (string)</span>
<span class="sd">        :param evaluation: the evaluation for this protare (string)</span>
<span class="sd">        :param GNDS_version: GNDS format version (string)</span>
<span class="sd">        :param style: Indicates style of data in this reactionSuite (evaluated, linearized, processed, etc.).  Instance of styles.style</span>
<span class="sd">        :param documentation: Top-level documentation for the entire reactionSuite (instance of documentation.documentation)</span>
<span class="sd">        :param projectileFrame: frame of the projectile. Allowed values are &#39;lab&#39; or &#39;centerOfMass&#39;</span>
<span class="sd">        :param MAT: integer ENDF MAT number (only needed for writing back to ENDF-6)</span>
<span class="sd">        :param PoPs: a PoPs database that is copied to self&#39;s PoPs database</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">GNDS_version</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span> <span class="n">GNDS_VERSION</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span> <span class="s2">&quot;Unsupported GNDS structure &#39;</span><span class="si">%s</span><span class="s2">&#39;!&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">GNDS_version</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">projectile</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;projectile ID not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">=</span> <span class="n">projectile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">projectileFrame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAT</span> <span class="o">=</span> <span class="n">MAT</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;target ID not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">evaluation</span><span class="p">,</span> <span class="nb">str</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;evaluation not a string&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__evaluation</span> <span class="o">=</span> <span class="n">evaluation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">GNDS_version</span> <span class="o">=</span> <span class="n">GNDS_version</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">PoPs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="o">=</span> <span class="n">PoPs</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="o">=</span> <span class="n">PoPsModule</span><span class="o">.</span><span class="n">database</span><span class="p">(</span> <span class="s1">&#39;protare_internal&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">styles</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">externalFiles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">reactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">orphanProducts</span><span class="p">(</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span> <span class="o">=</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">sums</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">productions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">fissionComponents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span> <span class="o">=</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">applicationData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">documentation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">documentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">addDocumentation</span><span class="p">(</span> <span class="n">documentation</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_externalLinks</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># keep track of links to external files</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">orphanProduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">orphanProduct</span>
        <span class="k">for</span> <span class="n">_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSections</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">_sum</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span> <span class="p">:</span> <span class="k">yield</span> <span class="n">reaction</span>

<div class="viewcode-block" id="reactionSuite.getProductionReactions"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getProductionReactions">[docs]</a>    <span class="k">def</span> <span class="nf">getProductionReactions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See method toString.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">compound_nucleus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the compound nucleus id corresponding to this reaction.</span>

<span class="sd">        Note, we don&#39;t check to see if the compound nucleus is a valid concept, so</span>
<span class="sd">        this will fail on electro-atomic, photo-atomic and natural element target data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ZAproj</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">ZAtarg</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">Zcompound</span><span class="p">,</span> <span class="n">Acompound</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span> <span class="n">ZAproj</span> <span class="o">+</span> <span class="n">ZAtarg</span><span class="p">,</span> <span class="mi">1000</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">idFromZAndA</span><span class="p">(</span><span class="n">Zcompound</span><span class="p">,</span> <span class="n">Acompound</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">evaluation</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns self&#39;s evaluation.&quot;&quot;&quot;</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__evaluation</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">styles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">externalFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__externalFiles</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orphanProducts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sums</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">productions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">incompleteReactions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fissionComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">applicationData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__applicationData</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">PoPs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__PoPs</span> <span class="p">)</span>

<div class="viewcode-block" id="reactionSuite.addDocumentation"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.addDocumentation">[docs]</a>    <span class="k">def</span> <span class="nf">addDocumentation</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">documentation</span> <span class="p">)</span> <span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">documentation</span><span class="p">[</span><span class="n">documentation</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">documentation</span></div>

<div class="viewcode-block" id="reactionSuite.addResonances"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.addResonances">[docs]</a>    <span class="k">def</span> <span class="nf">addResonances</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">resonances</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add resonance parameter data (gnds.resonances.resonances instance) to the reactionSuite. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="o">=</span> <span class="n">resonances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">setAncestor</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.photonBranchingData"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.photonBranchingData">[docs]</a>    <span class="k">def</span> <span class="nf">photonBranchingData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">branchingData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">chemicalElement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">chemicalElements</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">isotope</span> <span class="ow">in</span> <span class="n">chemicalElement</span> <span class="p">:</span>
                <span class="n">branchingData</span><span class="p">[</span><span class="n">isotope</span><span class="o">.</span><span class="n">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="n">decaysMiscPoPsModule</span><span class="o">.</span><span class="n">photonBranchingData</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">,</span> <span class="n">isotope</span><span class="o">.</span><span class="n">symbol</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">branchingData</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.convertUnits"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.convertUnits">[docs]</a>    <span class="k">def</span> <span class="nf">convertUnits</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">unitMap</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        unitMap is a dictionary with old/new unit pairs where the old unit is the key (e.g., { &#39;eV&#39; : &#39;MeV&#39;, &#39;b&#39; : &#39;mb&#39; }).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="n">unitMap</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.check"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check all data in the reactionSuite, returning a gnds.warning.context object with list of warnings.</span>

<span class="sd">        Currently supported options:</span>
<span class="sd">            &#39;branchingRatioSumTolerance&#39; 1e-6        # branching ratios must sum to 1 (within this tolerance)</span>
<span class="sd">            &#39;dQ&#39;                         &#39;1e-3 MeV&#39;  # tolerance for comparing tabulated / calculated Q values</span>
<span class="sd">            &#39;dThreshold&#39;                 &#39;1e-3 MeV&#39;</span>
<span class="sd">            &#39;crossSectionEnergyMax&#39;      &#39;20 MeV&#39;    # warn if cross section ends before this energy</span>
<span class="sd">            &#39;crossSectionOnly&#39;:          False</span>
<span class="sd">            &#39;crossSectionMaxDiff&#39;:       1e-3        # for comparing crossSectionSum to summands</span>
<span class="sd">            &#39;multiplicityMaxDiff&#39;:       1e-3        # for comparing multiplicitySum to summands</span>
<span class="sd">            &#39;transportables&#39;             (&#39;n&#39;,)      # distribution required for these products</span>
<span class="sd">            &#39;normTolerance&#39;:             1e-5        # for checking distribution normalization</span>
<span class="sd">            &#39;checkEnergyBalance&#39;         True</span>
<span class="sd">            &#39;reconstructResonances&#39;      True</span>
<span class="sd">            &#39;dEnergyBalanceRelative&#39;     1e-3</span>
<span class="sd">            &#39;dEnergyBalanceAbsolute&#39;     &#39;1 eV&#39;</span>
<span class="sd">            &#39;fissionEnergyBalanceLimit&#39;  0.15        # at least 85% of available energy should go to fission products</span>
<span class="sd">            &#39;failOnException&#39;            False       # if True, crash instead of converting exceptions to warnings</span>
<span class="sd">            &#39;cleanUpTempFiles&#39;           True        # remove derived data that was produced during checking</span>

<span class="sd">        Currently unused options:</span>
<span class="sd">            &#39;checkForEnDepData&#39;         False</span>
<span class="sd">            &#39;allowZeroE&#39;                False</span>
<span class="sd">            &#39;xCloseEps&#39;                 None</span>
<span class="sd">            &#39;maxAbsFloatValue&#39;          None</span>
<span class="sd">            &#39;checkEMin&#39;                 True</span>
<span class="sd">            &#39;checkMissing&#39;              True</span>
<span class="sd">            &#39;maxGammaMultiplicity&#39;      100.</span>
<span class="sd">          &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">fudge.gnds</span> <span class="k">import</span> <span class="n">warning</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;branchingRatioSumTolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                <span class="s1">&#39;dQ&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-3 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dThreshold&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-3 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionEnergyMin&#39;</span><span class="p">:</span> <span class="s1">&#39;1e-5 eV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionEnergyMax&#39;</span><span class="p">:</span> <span class="s1">&#39;20 MeV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionOnly&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;crossSectionMaxDiff&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;multiplicityMaxDiff&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;transportables&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,),</span>
                <span class="s1">&#39;normTolerance&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
                <span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;reconstructResonances&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;dEnergyBalanceRelative&#39;</span><span class="p">:</span> <span class="mf">1e-3</span><span class="p">,</span>
                <span class="s1">&#39;dEnergyBalanceAbsolute&#39;</span><span class="p">:</span> <span class="s1">&#39;1 eV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fissionEnergyBalanceLimit&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
                <span class="s1">&#39;failOnException&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;cleanUpTempFiles&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="c1"># currently unused options:</span>
                <span class="s1">&#39;checkForEnDepData&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;allowZeroE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;xCloseEps&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;maxAbsFloatValue&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;checkEMin&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;checkMissing&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;maxGammaMultiplicity&#39;</span><span class="p">:</span> <span class="mf">100.</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;check() received unknown keyword argument &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">PoPsModule</span><span class="o">.</span><span class="n">unorthodoxModule</span><span class="o">.</span><span class="n">particle</span> <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">UnorthodoxParticleNotImplemented</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>

        <span class="n">evaluatedStyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getEvaluatedStyle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">evaluatedStyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">NotImplemented</span><span class="p">(</span> <span class="s2">&quot;Checking currently only supported for &#39;evaluated&#39; style&quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>

        <span class="c1"># assemble some useful info, to be handed down to children&#39;s check() functions:</span>
        <span class="n">incidentEnergyUnit</span> <span class="o">=</span> <span class="s1">&#39;eV&#39;</span>
        <span class="n">massUnit</span> <span class="o">=</span> <span class="s1">&#39;eV/c**2&#39;</span>
        <span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span>
        <span class="n">projectileZ</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">projectileZA</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZAInfo</span><span class="p">(</span> <span class="n">projectile</span> <span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="n">target</span><span class="o">.</span><span class="n">pid</span> <span class="p">]</span>
        <span class="n">targetZ</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">targetZA</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZAInfo</span><span class="p">(</span> <span class="n">target</span> <span class="p">)</span>
        <span class="n">compoundZA</span> <span class="o">=</span> <span class="n">targetZA</span> <span class="o">+</span> <span class="n">projectileZA</span>
        <span class="n">CoulombChannel</span> <span class="o">=</span> <span class="p">(</span> <span class="n">targetZ</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">projectileZ</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">elementalTarget</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;getMass&#39;</span> <span class="p">):</span>
            <span class="n">projectileMass_amu</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="n">targetMass_amu</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="n">kinematicFactor</span> <span class="o">=</span> <span class="p">(</span> <span class="n">targetMass_amu</span> <span class="o">+</span> <span class="n">projectileMass_amu</span> <span class="p">)</span> <span class="o">/</span> <span class="n">targetMass_amu</span>    <span class="c1"># (M+m)/M</span>

            <span class="n">projectileMass</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span>
            <span class="n">targetMass</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">massUnit</span> <span class="p">)</span>
            <span class="n">availableEnergy_eV</span> <span class="o">=</span> <span class="n">projectileMass</span> <span class="o">+</span> <span class="n">targetMass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For elemental targets, calculating these factors doesn&#39;t make sense since there is no defined target mass</span>
            <span class="n">kinematicFactor</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="n">elementalTarget</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">availableEnergy_eV</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">chemicalElement</span><span class="p">):</span> <span class="n">elementalTarget</span><span class="o">=</span><span class="kc">True</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;kinematicFactor&#39;</span><span class="p">:</span> <span class="n">kinematicFactor</span><span class="p">,</span> <span class="s1">&#39;compoundZA&#39;</span><span class="p">:</span> <span class="n">compoundZA</span><span class="p">,</span>
                <span class="s1">&#39;availableEnergy_eV&#39;</span><span class="p">:</span> <span class="n">availableEnergy_eV</span><span class="p">,</span> <span class="s1">&#39;CoulombChannel&#39;</span><span class="p">:</span> <span class="n">CoulombChannel</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="n">evaluatedStyle</span><span class="p">,</span>
                <span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="p">}</span>
        <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">options</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">elementalTarget</span><span class="p">:</span>
            <span class="c1"># For elemental targets, calculating energy balance isn&#39;t possible</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resonanceWarnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="n">info</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">resonanceWarnings</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;resonances&#39;</span><span class="p">,</span> <span class="n">resonanceWarnings</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;reconstructResonances&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span> <span class="p">):</span>
                <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getTempStyleNameOfClass</span><span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">crossSectionReconstructed</span> <span class="p">)</span>
                <span class="c1"># convert resonance parameters to pointwise data, interpolable to .1 percent:</span>
                <span class="n">reconstructedStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">crossSectionReconstructed</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">],</span> <span class="n">derivedFrom</span><span class="o">=</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconstructResonances</span><span class="p">(</span> <span class="n">reconstructedStyle</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">ExceptionRaised</span><span class="p">(</span> <span class="s2">&quot;when reconstructing resonances: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;failOnException&#39;</span><span class="p">]:</span> <span class="k">raise</span>

        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;checkEnergyBalance&#39;</span><span class="p">]:</span>
            <span class="c1"># setup options for calculating average product energy and momentum</span>
            <span class="n">averageProductDataStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">averageProductData</span><span class="p">(</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">getTempStyleNameOfClass</span><span class="p">(</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">averageProductData</span> <span class="p">),</span>
                    <span class="n">derivedFrom</span><span class="o">=</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">averageProductDataStyle</span> <span class="p">)</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;averageProductDataStyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">averageProductDataStyle</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;averageProductDataArgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>   <span class="c1"># additional required arguments</span>
                        <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">:</span><span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="s1">&#39;energyAccuracy&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">:</span><span class="mf">1e-6</span><span class="p">,</span>
                        <span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">:</span> <span class="n">incidentEnergyUnit</span><span class="p">,</span> <span class="s1">&#39;massUnit&#39;</span><span class="p">:</span> <span class="n">massUnit</span><span class="p">,</span>
                        <span class="s1">&#39;momentumDepositionUnit&#39;</span><span class="p">:</span> <span class="n">incidentEnergyUnit</span> <span class="o">+</span> <span class="s1">&#39;/c&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;projectileMass&#39;</span><span class="p">:</span> <span class="n">projectileMass</span><span class="p">,</span> <span class="s1">&#39;targetMass&#39;</span><span class="p">:</span> <span class="n">targetMass</span><span class="p">,</span>
                        <span class="s1">&#39;reactionSuite&#39;</span><span class="p">:</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;photonBranchingData&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">photonBranchingData</span><span class="p">()</span> <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
            <span class="c1"># test Wick&#39;s limit: 0-degree elastic xsc &gt;= ( total xsc * k/4pi )^2</span>
            <span class="n">elastic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s1">&#39;elastic&#39;</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">total</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">testSkipped</span><span class="p">(</span><span class="s2">&quot;Wick&#39;s limit&quot;</span><span class="p">,</span> <span class="s2">&quot;can&#39;t find reaction &#39;total&#39;&quot;</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span> <span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]]</span>
                        <span class="n">total_xsc</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">crossSection</span><span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span><span class="n">lowerEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="n">upperEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
                        <span class="n">total_xsc</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span><span class="n">lowerEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span><span class="n">upperEps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
                    <span class="n">elastic_distribution</span> <span class="o">=</span> <span class="n">elastic</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">getProductWithName</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="n">evaluatedStyle</span><span class="o">.</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">angularSubform</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">elastic_distribution</span><span class="p">,</span> <span class="n">fudge</span><span class="o">.</span><span class="n">gnds</span><span class="o">.</span><span class="n">productData</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">):</span>
                        <span class="n">linearized</span> <span class="o">=</span> <span class="n">elastic_distribution</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">()</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">axes</span><span class="o">=</span><span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">()</span> <span class="p">)</span>
                        <span class="k">for</span> <span class="n">energy_in</span> <span class="ow">in</span> <span class="n">linearized</span><span class="o">.</span><span class="n">getEnergyArray</span><span class="p">(</span><span class="s1">&#39;eV&#39;</span><span class="p">):</span>
                            <span class="n">forward_scattering</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">energy_in</span><span class="p">,</span> <span class="n">linearized</span><span class="o">.</span><span class="n">interpolateAtValue</span><span class="p">(</span> <span class="n">energy_in</span> <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">elastic_distribution</span><span class="p">,</span> <span class="n">fudge</span><span class="o">.</span><span class="n">gnds</span><span class="o">.</span><span class="n">productData</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">regions2d</span><span class="p">):</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">regions1d</span><span class="p">(</span> <span class="n">axes</span><span class="o">=</span><span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="o">.</span><span class="n">defaultAxes</span><span class="p">()</span> <span class="p">)</span>
                        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">elastic_distribution</span><span class="p">:</span>
                            <span class="n">ptw</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span><span class="o">=</span><span class="p">[]</span> <span class="p">)</span>
                            <span class="n">linearized</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">energy_in</span> <span class="ow">in</span> <span class="n">linearized</span><span class="o">.</span><span class="n">getEnergyArray</span><span class="p">(</span><span class="s1">&#39;eV&#39;</span><span class="p">):</span>
                                <span class="n">ptw</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span> <span class="n">energy_in</span><span class="p">,</span> <span class="n">linearized</span><span class="o">.</span><span class="n">interpolateAtValue</span><span class="p">(</span> <span class="n">energy_in</span> <span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">)</span>
                            <span class="n">forward_scattering</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ptw</span> <span class="p">)</span>
                        <span class="n">forward_scattering</span> <span class="o">=</span> <span class="n">forward_scattering</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-5</span><span class="p">,</span> 
                                <span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="p">)</span>

                    <span class="n">mutualDomain</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="o">*</span><span class="p">[</span><span class="n">dat</span><span class="o">.</span><span class="n">domain</span><span class="p">()</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="p">(</span><span class="n">elastic_xsc</span><span class="p">,</span> <span class="n">total_xsc</span><span class="p">,</span> <span class="n">forward_scattering</span><span class="p">)])</span>
                    <span class="n">mutualDomain</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">mutualDomain</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">min</span><span class="p">(</span><span class="n">mutualDomain</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">egrid</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">forward_scattering</span><span class="o">.</span><span class="n">domainGrid</span> <span class="k">if</span> <span class="n">mutualDomain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="n">mutualDomain</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

                    <span class="c1"># get probability at mu=1.0:</span>
                    <span class="n">forward_scattering</span> <span class="o">=</span> <span class="p">[</span><span class="n">forward_scattering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>
                    <span class="n">elastic_xsc</span> <span class="o">=</span> <span class="p">[</span><span class="n">elastic_xsc</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>
                    <span class="n">total_xsc</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_xsc</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">egrid</span><span class="p">]</span>

                    <span class="n">wlcons</span> <span class="o">=</span> <span class="mf">3.05607e-8</span> <span class="o">*</span> <span class="n">kinematicFactor</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># ( sqrt(2 * neutronMass) / (4 * pi * hbar) * (M+m)/M )^2 in 1/(eV*b)</span>
                    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">egrid</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">forward_scattering</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">elastic_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">wlcons</span> <span class="o">*</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_scattering</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">elastic_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">wlcons</span> <span class="o">*</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="o">*</span> <span class="n">total_xsc</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">WicksLimitError</span><span class="p">(</span> <span class="mi">1</span><span class="o">-</span><span class="n">ratio</span><span class="p">,</span> <span class="n">egrid</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">ExceptionRaised</span><span class="p">(</span> <span class="s2">&quot;when checking Wick&#39;s limit: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;failOnException&#39;</span><span class="p">]:</span> <span class="k">raise</span>

        <span class="n">particleWarnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="o">**</span><span class="n">info</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">particleWarnings</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;PoPs&#39;</span><span class="p">,</span> <span class="n">particleWarnings</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="n">reactionWarnings</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">check</span><span class="p">(</span> <span class="n">info</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">reactionWarnings</span><span class="p">:</span> <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> label </span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">reaction</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">label</span><span class="p">),</span> <span class="n">reactionWarnings</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">warning</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">&#39;ReactionSuite: </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="n">warnings</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>

        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s1">&#39;cleanUpTempFiles&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">removeStyle</span><span class="p">(</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;reconstructedStyleName&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="reactionSuite.findEntity"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.findEntity">[docs]</a>    <span class="k">def</span> <span class="nf">findEntity</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overrides ancestry.findEntity. reactionSuite contains several different lists,</span>
<span class="sd">        so may need to descend into those to find desired entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">entityName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;reaction&#39;</span><span class="p">,</span><span class="s1">&#39;summedReaction&#39;</span><span class="p">,</span><span class="s1">&#39;fissionComponent&#39;</span><span class="p">,</span><span class="s1">&#39;production&#39;</span><span class="p">,</span><span class="s1">&#39;reactionSum&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="o">+</span><span class="s1">&#39;s&#39;</span> <span class="p">):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">entity</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="kc">None</span> <span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">entity</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">ancestryModule</span><span class="o">.</span><span class="n">ancestry</span><span class="o">.</span><span class="n">findEntity</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">entityName</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.hasParticle"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.hasParticle">[docs]</a>    <span class="k">def</span> <span class="nf">hasParticle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.heatCrossSections"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.heatCrossSections">[docs]</a>    <span class="k">def</span> <span class="nf">heatCrossSections</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">doNotThin</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">EMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span> 
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">orphanProduct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
            <span class="n">orphanProduct</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span> 
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">production</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span>
            <span class="n">production</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span> 
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">_sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSections</span> <span class="p">:</span>
            <span class="n">_sum</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span>
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">fissionComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span>
            <span class="n">fissionComponent</span><span class="o">.</span><span class="n">heatCrossSection</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">EMin</span><span class="p">,</span> <span class="n">lowerlimit</span> <span class="o">=</span> <span class="n">lowerlimit</span><span class="p">,</span> <span class="n">upperlimit</span> <span class="o">=</span> <span class="n">upperlimit</span><span class="p">,</span> 
                    <span class="n">interpolationAccuracy</span> <span class="o">=</span> <span class="n">interpolationAccuracy</span><span class="p">,</span> <span class="n">heatAllPoints</span> <span class="o">=</span> <span class="n">heatAllPoints</span><span class="p">,</span> <span class="n">doNotThin</span> <span class="o">=</span> <span class="n">doNotThin</span><span class="p">,</span>
                    <span class="n">heatBelowThreshold</span> <span class="o">=</span> <span class="n">heatBelowThreshold</span><span class="p">,</span> <span class="n">heatAllEDomain</span> <span class="o">=</span> <span class="n">heatAllEDomain</span><span class="p">,</span> <span class="n">setThresholdToZero</span> <span class="o">=</span> <span class="n">setThresholdToZero</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.getProjectileFrame"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getProjectileFrame">[docs]</a>    <span class="k">def</span> <span class="nf">getProjectileFrame</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectileFrame</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.getDocumentation"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getDocumentation">[docs]</a>    <span class="k">def</span> <span class="nf">getDocumentation</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentation</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.getParticle"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getParticle">[docs]</a>    <span class="k">def</span> <span class="nf">getParticle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.getMassRatio"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getMassRatio">[docs]</a>    <span class="k">def</span> <span class="nf">getMassRatio</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__massRatio&#39;</span> <span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">(</span> <span class="s1">&#39;amu&#39;</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__massRatio</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">+</span><span class="n">m</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__massRatio</span></div>

<span class="c1"># BRB6 This does not belong here.</span>
<div class="viewcode-block" id="reactionSuite.getIsotopeName"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getIsotopeName">[docs]</a>    <span class="k">def</span> <span class="nf">getIsotopeName</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return name of compound nucleus formed by nuc1+nuc2+...</span>
<span class="sd">        if a nucleus in &#39;args&#39; starts with &#39;-&#39;, subtract instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<span class="c1"># CALEB: This logic need to use PoPs stuff.</span>
        <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="ow">in</span> <span class="n">name</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span>
            <span class="n">sign</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([-]?)([0-9]+)?([a-zA-Z]+)(_natural|[0-9]*)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mult</span><span class="p">:</span> <span class="n">mult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span> <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">A</span> <span class="p">)</span> <span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">A</span><span class="o">!=</span><span class="s1">&#39;_natural&#39;</span><span class="p">:</span> <span class="n">A</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">name</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">neutron</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZFromSymbol</span><span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span> <span class="n">sign</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span> <span class="p">),</span> <span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">mult</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">retZ</span><span class="p">,</span> <span class="n">retA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nucleus</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">sign</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">nucleus</span><span class="p">)</span>
                <span class="n">retZ</span> <span class="o">+=</span> <span class="n">sign</span><span class="o">*</span><span class="n">mult</span><span class="o">*</span><span class="n">Z</span>
                <span class="k">if</span> <span class="s1">&#39;_natural&#39;</span> <span class="ow">in</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">retA</span><span class="p">):</span>
                    <span class="n">retA</span><span class="o">=</span><span class="s1">&#39;_natural&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">retA</span> <span class="o">+=</span> <span class="n">sign</span><span class="o">*</span><span class="n">mult</span><span class="o">*</span><span class="n">A</span>
            <span class="k">return</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">symbolFromZ</span><span class="p">[</span><span class="n">retZ</span><span class="p">],</span> <span class="n">retA</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;      WARNING: couldn&#39;t extract isotope name from product list!&quot;</span><span class="p">)</span></div>

<span class="c1"># BRB6 many hardwired in this method.</span>
<div class="viewcode-block" id="reactionSuite.getReaction"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getReaction">[docs]</a>    <span class="k">def</span> <span class="nf">getReaction</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">channel</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search list of reactions for a specified channel.</span>
<span class="sd">        The &#39;channel&#39; argument should be either a reaction type (&#39;elastic&#39;,&#39;capture&#39;,&#39;fission&#39;, etc) or</span>
<span class="sd">        the list of outgoing particles (&#39;n + Pu239&#39; for example).</span>

<span class="sd">        If &#39;channel&#39; is an int, then we assume it&#39;s an ENDF MT</span>

<span class="sd">        Raises &#39;KeyError&#39; if specified channel can&#39;t be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If channel is an int, it might be an ENDF MT, so check those first</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span> <span class="c1"># must be an ENDF MT</span>
            <span class="k">for</span> <span class="n">reactionList</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSections</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">reactionList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">reaction</span><span class="o">.</span><span class="n">ENDF_MT</span> <span class="o">==</span> <span class="n">channel</span><span class="p">:</span> <span class="k">return</span> <span class="n">reaction</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># translate special channel names:</span>
        <span class="k">if</span> <span class="n">channel</span><span class="o">==</span><span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">channel_tr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">channel</span><span class="o">==</span><span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="n">channel_tr</span><span class="o">=</span><span class="s1">&#39;z,gamma&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">channel_tr</span> <span class="o">=</span> <span class="n">channel</span>

        <span class="c1"># check if &#39;channel&#39; == one of the fudge reactions:</span>
        <span class="n">chStrings</span><span class="p">,</span> <span class="n">reacs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="o">==</span> <span class="n">channel</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span>
            <span class="n">chStrings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">reacs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span>

        <span class="c1"># make list containing a set() of products for each reaction.</span>
        <span class="n">chStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chStrings</span><span class="p">]</span>
        <span class="n">chSets</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chStrings</span><span class="p">]</span>
        <span class="n">chSetsNoPhoton</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span> <span class="n">tmp</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;photon&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSets</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSetsNoPhoton</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">))</span> <span class="p">)</span> <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">in</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">channel_fiss</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">def</span> <span class="nf">matchlist</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">any</span><span class="p">(</span> <span class="p">[</span><span class="n">a</span> <span class="ow">in</span> <span class="n">channel_fiss</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">channel_fiss</span><span class="o">==</span><span class="s1">&#39;fission&#39;</span> <span class="ow">or</span> <span class="s1">&#39;total&#39;</span> <span class="ow">in</span> <span class="n">channel_fiss</span><span class="p">:</span> <span class="n">genre</span><span class="o">=</span><span class="s1">&#39;total&#39;</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="s1">&#39;1st&#39;</span><span class="p">):</span> <span class="n">genre</span><span class="o">=</span><span class="s1">&#39;firstChance&#39;</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span><span class="s1">&#39;2nd&#39;</span><span class="p">):</span> <span class="n">genre</span><span class="o">=</span><span class="s1">&#39;secondChance&#39;</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;third&#39;</span><span class="p">,</span><span class="s1">&#39;3rd&#39;</span><span class="p">):</span> <span class="n">genre</span><span class="o">=</span><span class="s1">&#39;thirdChance&#39;</span>
            <span class="k">elif</span> <span class="n">matchlist</span><span class="p">(</span><span class="s1">&#39;fourth&#39;</span><span class="p">,</span><span class="s1">&#39;4th&#39;</span><span class="p">):</span> <span class="n">genre</span><span class="o">=</span><span class="s1">&#39;fourthChance&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can&#39;t determine fission genre from &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">channel_fiss</span><span class="p">)</span>
                <span class="n">genre</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">retVal</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">r1</span> <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span>         <span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">fissionGenre</span> <span class="o">==</span> <span class="n">genre</span> <span class="p">]</span>
            <span class="n">retVal</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">r1</span> <span class="k">for</span> <span class="n">r1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">fissionGenre</span> <span class="o">==</span> <span class="n">genre</span> <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">retVal</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">retVal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check if channel is in form &#39;(z,2na)&#39;, &#39;n,4n&#39; or similar:</span>
            <span class="n">patt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;^[(]?[znpdthag],([a-zA-Z0-9]+)[)]?$&#39;</span><span class="p">,</span> <span class="n">channel_tr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">patt</span><span class="p">:</span>
                <span class="n">thisChannelSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;([1-9]?)(gamma|He3|[npagdt]?)[+]?&#39;</span><span class="p">,</span> <span class="n">patt</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">mul</span><span class="p">,</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">match</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prod</span> <span class="p">:</span> <span class="k">continue</span>
                    <span class="n">prod</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;g&#39;</span> <span class="p">:</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="p">,</span> <span class="s1">&#39;gamma&#39;</span> <span class="p">:</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span> <span class="p">:</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span> <span class="p">:</span> <span class="s1">&#39;H1&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;d&#39;</span> <span class="p">:</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span> <span class="p">:</span> <span class="s1">&#39;H3&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span> <span class="p">:</span> <span class="s1">&#39;He3&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="p">:</span> <span class="s1">&#39;He4&#39;</span> <span class="p">}[</span><span class="n">prod</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">mul</span><span class="p">:</span> <span class="n">prod</span> <span class="o">=</span> <span class="n">mul</span> <span class="o">+</span> <span class="n">prod</span>
                    <span class="k">if</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">thisChannelSet</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Please specify multiplicity explicitly (&#39;z,2n&#39; instead of &#39;z,nn&#39;)&quot;</span><span class="p">)</span>
                    <span class="n">thisChannelSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">thisChannelSet</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="c1"># also add residual to the set:</span>
                <span class="n">proj</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
                <span class="n">thisChannelSet</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIsotopeName</span><span class="p">(</span> <span class="o">*</span><span class="p">([</span><span class="n">proj</span><span class="p">,</span> <span class="n">target</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">thisChannelSet</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">thisChannelSet</span> <span class="ow">in</span> <span class="n">chSets</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSets</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">thisChannelSet</span> <span class="p">)</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">thisChannelSet</span> <span class="ow">in</span> <span class="n">chSetsNoPhoton</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">reacs</span><span class="p">[</span> <span class="n">chSetsNoPhoton</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">thisChannelSet</span> <span class="p">)</span> <span class="p">]</span>

        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="reactionSuite.getTemperature"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.getTemperature">[docs]</a>    <span class="k">def</span> <span class="nf">getTemperature</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">[</span><span class="n">style</span><span class="p">]</span><span class="o">.</span><span class="n">temperature</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.calculateAverageProductData"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.calculateAverageProductData">[docs]</a>    <span class="k">def</span> <span class="nf">calculateAverageProductData</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate average energy and momentum data for all products of all reactions.</span>
<span class="sd">        Resulting data are stored within each product. Example usage is:</span>

<span class="sd">        from fudge.gnds import reactionSuite as reactionSuiteModule</span>
<span class="sd">        from fudge.gnds import styles as stylesSuiteModule</span>
<span class="sd">        reactionSuite = reactionSuiteModule.readXML( &quot;16.xml&quot; )</span>

<span class="sd">        style = stylesModule.averageProductData( label = &#39;productData&#39;, &#39;eval&#39; )</span>
<span class="sd">        reactionSuite.calculateAverageProductData( style )</span>

<span class="sd">        :param style: The style to use.</span>
<span class="sd">        :param indent: string; The amount to indent and verbose output.</span>
<span class="sd">        :param kwargs: string; All other parameters.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">averageProductData</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;Invalid style&#39;</span> <span class="p">)</span>

        <span class="n">verbosity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;verbosity&#39;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">logFile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;logFile&#39;</span><span class="p">,</span> <span class="n">nullDevice</span><span class="p">(</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logFile</span>

        <span class="n">energyAccuracy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;energyAccuracy&#39;</span><span class="p">,</span> <span class="mf">1e-5</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;energyAccuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energyAccuracy</span>
        <span class="n">momentumAccuracy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">,</span> <span class="mf">1e-3</span> <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;momentumAccuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">momentumAccuracy</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainUnit</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;momentumDepositionUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">chemicalElement</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span> <span class="p">)</span> <span class="p">:</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">calculateAverageProductData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">calculateAverageProductData</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.inputParticlesToReactionString"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.inputParticlesToReactionString">[docs]</a>    <span class="k">def</span> <span class="nf">inputParticlesToReactionString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2"> + </span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">suffix</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.cullStyles"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.cullStyles">[docs]</a>    <span class="k">def</span> <span class="nf">cullStyles</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">removeDocumentation</span><span class="p">,</span> <span class="n">removeApplicationData</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all forms from each component except for the requested style or, if it is not present</span>
<span class="sd">        its nearest derived from style.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__styles</span><span class="p">[</span><span class="n">styleName</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">heatedMultiGroup</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">styleList</span> <span class="o">=</span> <span class="p">[</span> <span class="n">style</span> <span class="p">]</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">griddedCrossSection</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">styleList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span><span class="p">(</span> <span class="n">style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">styleList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span>
                <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">derivedFromStyle</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span> <span class="s1">&#39;style name &quot;</span><span class="si">%s</span><span class="s1">&quot; is for type &quot;</span><span class="si">%s</span><span class="s1">&quot; which is not supported for culling.&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">style</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__reactions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__orphanProducts</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sums</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__productions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__incompleteReactions</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fissionComponents</span><span class="o">.</span><span class="n">cullStyles</span><span class="p">(</span> <span class="n">styleList</span> <span class="p">)</span></div>
<span class="c1"># FIXME What about self.resonances</span>

<div class="viewcode-block" id="reactionSuite.CoulombPlusNuclearMuCutoffs"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.CoulombPlusNuclearMuCutoffs">[docs]</a>    <span class="k">def</span> <span class="nf">CoulombPlusNuclearMuCutoffs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">CoulombPlusNuclearElastic</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">doubleDifferentialCrossSection</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">doubleDifferentialCrossSection</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">doubleDifferentialCrossSection</span><span class="p">,</span> <span class="n">CoulombPlusNuclearElasticModule</span><span class="o">.</span><span class="n">form</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">CoulombPlusNuclearElastic</span> <span class="o">=</span> <span class="n">doubleDifferentialCrossSection</span>
                    <span class="k">break</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">CoulombPlusNuclearElastic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">CoulombPlusNuclearElastic</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span><span class="p">(</span> <span class="kc">None</span> <span class="p">)</span>

        <span class="n">muCutoffs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">CoulombPlusNuclearElastic</span><span class="o">.</span><span class="n">nuclearPlusInterference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">muCutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">CoulombPlusNuclearElastic</span><span class="o">.</span><span class="n">nuclearPlusInterference</span><span class="o">.</span><span class="n">muCutoff</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">CoulombPlusNuclearElasticMuCutoff</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">muCutoffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">style</span><span class="o">.</span><span class="n">muCutoff</span> <span class="p">)</span>

        <span class="k">return</span><span class="p">(</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">muCutoffs</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.processCoulombPlusNuclearMuCutoff"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.processCoulombPlusNuclearMuCutoff">[docs]</a>    <span class="k">def</span> <span class="nf">processCoulombPlusNuclearMuCutoff</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processCoulombPlusNuclearMuCutoff</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.processMC_cdf"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.processMC_cdf">[docs]</a>    <span class="k">def</span> <span class="nf">processMC_cdf</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>

        <span class="n">tempInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
        <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;brokenLinks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processMC_cdf</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="n">reaction</span><span class="o">.</span><span class="n">processMC_cdf</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">tempInfo</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">original</span><span class="p">,</span> <span class="n">newReference</span> <span class="ow">in</span> <span class="n">tempInfo</span><span class="p">[</span><span class="s1">&#39;brokenLinks&#39;</span><span class="p">]:</span>
            <span class="n">newReference</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">referenceInstance</span><span class="o">.</span><span class="n">ancestor</span><span class="p">[</span> <span class="n">newReference</span><span class="o">.</span><span class="n">label</span> <span class="p">]</span></div>

<div class="viewcode-block" id="reactionSuite.processGriddedCrossSections"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.processGriddedCrossSections">[docs]</a>    <span class="k">def</span> <span class="nf">processGriddedCrossSections</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a union grid for all cross sections, spanning the same domain as elastic scattering.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span>

            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">regions1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">crossSection</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="p">)</span>
            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainSlice</span><span class="p">(</span> <span class="n">domainMin</span><span class="p">,</span> <span class="n">domainMax</span> <span class="p">)</span>                 <span class="c1"># truncate to match elastic domain</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">&gt;</span> <span class="n">domainMin</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING, domains not mutual, setting first y-value to 0.&#39;</span><span class="p">)</span>
                <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span> <span class="p">]</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">&lt;</span> <span class="n">domainMax</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    WARNING, domains not mutual, setting last y-value to 0.&#39;</span><span class="p">)</span>
                <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">crossSection</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span> <span class="p">]</span>
            <span class="n">thresholds</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">return</span><span class="p">(</span> <span class="n">crossSection</span> <span class="p">)</span>

        <span class="k">def</span> <span class="nf">photoAtomic</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span>

            <span class="n">crossSection</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">crossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">regions1d</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">iRegion</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">crossSection</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">domainGrid</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">domainGrid</span>
                    <span class="n">values</span> <span class="o">+=</span> <span class="n">domainGrid</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">crossSection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">crossSection</span><span class="o">.</span><span class="n">domainGrid</span>
            <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">domainMin</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="n">y1</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">xEpsilon</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">x1</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">xEpsilon</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xEpsilon</span> <span class="p">)</span>
            
            <span class="k">return</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">domainMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="p">[</span> <span class="n">reaction</span><span class="o">.</span><span class="n">domainMin</span> <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">domainMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span> <span class="n">reaction</span><span class="o">.</span><span class="n">domainMax</span> <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">]</span> <span class="p">)</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">findFormMatchingDerivedStyle</span><span class="p">(</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="p">)</span>

        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
        <span class="n">isChemicalElement</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">chemicalElement</span> <span class="p">)</span>
        <span class="n">isPhotoAtomic</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">==</span> <span class="n">IDsPoPsModule</span><span class="o">.</span><span class="n">photon</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">isChemicalElement</span>

        <span class="n">thresholds</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">XYs1d</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="n">photoAtomic</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span> <span class="n">total</span> <span class="o">+=</span> <span class="n">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span> <span class="n">total</span> <span class="o">+=</span> <span class="n">mutualDomain</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">thresholds</span> <span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">total</span><span class="o">.</span><span class="n">domainGrid</span>

        <span class="n">tooCloseXsIndicies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">x2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span> <span class="o">*</span> <span class="n">x2</span> <span class="p">)</span> <span class="p">:</span> <span class="n">tooCloseXsIndicies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">i1</span> <span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x2</span>
        <span class="n">tooCloseXsIndicies</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">tooCloseXsIndicies</span> <span class="p">:</span>                   <span class="c1"># Remove close points but any threshold points.</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="ow">in</span> <span class="n">thresholds</span> <span class="p">)</span> <span class="p">:</span> <span class="n">index</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">del</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">valuesModule</span><span class="o">.</span><span class="n">values</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span> <span class="n">total</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">axesModule</span><span class="o">.</span><span class="n">pointsGridToken</span><span class="p">,</span> <span class="n">values</span> <span class="p">)</span>
        <span class="n">style</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span><span class="p">,</span> <span class="n">isPhotoAtomic</span> <span class="o">=</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="n">isPhotoAtomic</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">:</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">production</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span> <span class="p">:</span>
                <span class="n">production</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
                
            <span class="k">for</span> <span class="nb">sum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">crossSections</span> <span class="p">:</span>
                <span class="nb">sum</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

            <span class="k">for</span> <span class="n">fissionComponent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span> <span class="p">:</span>
                <span class="n">fissionComponent</span><span class="o">.</span><span class="n">processGriddedCrossSections</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="n">verbosity</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">incrementalIndent</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.processMultiGroup"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.processMultiGroup">[docs]</a>    <span class="k">def</span> <span class="nf">processMultiGroup</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">verbosity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">logFile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">workDir</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>

        <span class="kn">from</span> <span class="nn">fudge.core.utilities</span> <span class="k">import</span> <span class="n">times</span> <span class="k">as</span> <span class="n">timesModule</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">verbosity</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot; --&gt;&quot;</span><span class="p">)))</span>
        <span class="k">if</span><span class="p">(</span> <span class="ow">not</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">heatedMultiGroup</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span><span class="p">(</span> <span class="s1">&#39;Instance is not a heatedMultiGroup style.&#39;</span> <span class="p">)</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">timesModule</span><span class="o">.</span><span class="n">times</span><span class="p">(</span> <span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbosity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbosity</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementalIndent</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logFile</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">domainUnit</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incidentEnergyUnit&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/c**2&#39;</span>

            <span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projectile</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileZA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="n">projectile</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">chemicalElementPoPsModule</span><span class="o">.</span><span class="n">chemicalElement</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">aliases</span> <span class="p">)</span> <span class="p">:</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;massUnit&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetZA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chemicalElementMiscPoPsModule</span><span class="o">.</span><span class="n">ZA</span><span class="p">(</span> <span class="n">target</span> <span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;masses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Projectile&#39;</span> <span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;projectileMass&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Product&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;Residual&#39;</span> <span class="p">:</span> <span class="kc">None</span> <span class="p">}</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;masses&#39;</span><span class="p">][</span><span class="s1">&#39;Target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;targetMass&#39;</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">workDir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="s1">&#39;Merced.work&#39;</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workDir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">workDir</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;workFile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">style</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;groupedFlux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">style</span><span class="o">.</span><span class="n">multiGroupFlux</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">constructArray</span><span class="p">(</span> <span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>

<span class="c1"># BRB FIXME, must have test to determine if reconstructResonances is needed.</span>
<span class="c1">#        self.reconstructResonances( styleName = &#39;reconstructed&#39;, accuracy = 1e-3, verbose = False )</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reactionIndex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;o</span><span class="si">%.4d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i1</span>
                <span class="n">reaction</span><span class="o">.</span><span class="n">processMultiGroup</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span> <span class="p">)</span>

        <span class="n">logFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">t0</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s2">&quot;kwargs[&#39;failures&#39;] = </span><span class="si">%d</span><span class="s2">  &gt; 0&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">]</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.supportsResonanceReconstruction"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.supportsResonanceReconstruction">[docs]</a>    <span class="k">def</span> <span class="nf">supportsResonanceReconstruction</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether self.resonances contains any resonance parameters that can be reconstructed into</span>
<span class="sd">        cross sections and/or product distributions.</span>
<span class="sd">        :return: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span></div>

<div class="viewcode-block" id="reactionSuite.reconstructResonances"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.reconstructResonances">[docs]</a>    <span class="k">def</span> <span class="nf">reconstructResonances</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">significantDigits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn resonance parameters into pointwise cross sections, then merge the results with</span>
<span class="sd">        tabulated pointwise cross sections. Resulting pointwise cross sections are stored</span>
<span class="sd">        alongside the original &#39;resonancesWithBackground&#39; data in the reactionSuite.</span>

<span class="sd">        @:param styleName: string - label for reconstructed cross section style</span>
<span class="sd">        @:param accuracy: float - target accuracy during reconstruction. For example, 0.001</span>
<span class="sd">        @:param thin: boolean - enable/disable thinning after reconstruction</span>
<span class="sd">                Disabling thinning makes it easier to check for consistency of summed cross sections.</span>
<span class="sd">        @:param significantDigits: int - energy grid will only include points that can be exactly represented using</span>
<span class="sd">                specified number of significant digits</span>
<span class="sd">        @:param verbose: boolean - turn on/off verbosity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">reconstructCrossSection</span><span class="p">:</span>
            <span class="k">return</span> <span class="c1"># nothing to do</span>
        <span class="kn">from</span> <span class="nn">fudge.processing.resonances</span> <span class="k">import</span> <span class="n">reconstructResonances</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">crossSectionReconstructed</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;style must be an instance of crossSectionReconstructed, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

        <span class="n">xsecs</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="o">.</span><span class="n">reconstructResonances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span><span class="p">,</span>
                <span class="n">significantDigits</span> <span class="o">=</span> <span class="n">significantDigits</span><span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-8</span>  <span class="c1"># for joining multiple regions together</span>

        <span class="c1"># for each reaction, add tabulated pointwise data (ENDF MF=3) to reconstructed resonances:</span>
<span class="c1"># BRB6 hardwired?</span>
        <span class="n">possibleChannels</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;elastic&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;capture&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;fission&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;nonelastic&#39;</span> <span class="p">:</span> <span class="kc">False</span> <span class="p">}</span>
        <span class="n">derivedFromLabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">reaction</span><span class="p">,</span> <span class="n">sumsModule</span><span class="o">.</span><span class="n">multiplicitySum</span> <span class="p">):</span> <span class="k">continue</span>
            <span class="n">evaluatedCrossSection</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">evaluated</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">evaluatedCrossSection</span><span class="p">,</span> <span class="n">crossSectionModule</span><span class="o">.</span><span class="n">resonancesWithBackground</span> <span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># which reconstructed cross section corresponds to this reaction?</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">derivedFromLabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">:</span> <span class="n">derivedFromLabel</span> <span class="o">=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">derivedFromLabel</span> <span class="o">!=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;WARNING derivedFromLabel = &quot;</span><span class="si">%s</span><span class="s1">&quot; != &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">derivedFromLabel</span><span class="p">,</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">xsecs</span><span class="p">:</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">possibleChannel</span> <span class="ow">in</span> <span class="n">possibleChannels</span> <span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">possibleChannels</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">possibleChannel</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span> <span class="n">reaction</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">reaction</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span> <span class="n">possibleChannel</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">xsecs</span><span class="p">[</span><span class="n">possibleChannel</span><span class="p">]</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Warning: couldn&#39;t find appropriate reconstructed cross section to add to reaction </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">reaction</span> <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">background</span> <span class="o">=</span> <span class="n">evaluatedCrossSection</span><span class="o">.</span><span class="n">background</span>
            <span class="n">background</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="p">)</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">toPointwise_withLinearXYs</span><span class="p">(</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">lowerEps</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">upperEps</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="p">)</span>
            <span class="n">RRxsec</span><span class="o">.</span><span class="n">convertUnits</span><span class="p">(</span> <span class="p">{</span><span class="n">RRxsec</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">:</span> <span class="n">background</span><span class="o">.</span><span class="n">domainUnit</span><span class="p">,</span>  <span class="n">RRxsec</span><span class="o">.</span><span class="n">rangeUnit</span><span class="p">:</span> <span class="n">background</span><span class="o">.</span><span class="n">rangeUnit</span> <span class="p">}</span> <span class="p">)</span>

            <span class="n">background</span><span class="p">,</span> <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">background</span><span class="o">.</span><span class="n">mutualify</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">RRxsec</span><span class="p">,</span> <span class="o">-</span><span class="n">epsilon</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">background</span> <span class="o">+</span> <span class="n">RRxsec</span>    <span class="c1"># result is a crossSection.XYs1d instance</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">rangeMin</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
                <span class="c1"># turn any negative xsc to 0</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span> <span class="n">rangeMin</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Warning: negative cross section encountered for </span><span class="si">%s</span><span class="s2">; changed to 0 b&quot;</span> <span class="o">%</span> <span class="n">reaction</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">thin</span><span class="p">:</span>
                <span class="n">RRxsec</span> <span class="o">=</span> <span class="n">RRxsec</span><span class="o">.</span><span class="n">thin</span><span class="p">(</span> <span class="n">accuracy</span> <span class="ow">or</span> <span class="o">.</span><span class="mi">01</span> <span class="p">)</span>
            <span class="n">RRxsec</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>
            <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">RRxsec</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.reconstructResonancesAngularDistributions"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.reconstructResonancesAngularDistributions">[docs]</a>    <span class="k">def</span> <span class="nf">reconstructResonancesAngularDistributions</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">thin</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn resonance parameters into Legendre-expanded angular distributions, then merge the results with</span>
<span class="sd">        tabulated angular distributions (overwriting original values in the resonance region). Resulting pointwise</span>
<span class="sd">        angular distributions are stored alongside the original angular distributions in the reactionSuite.</span>

<span class="sd">        @:param styleName: string - label for reconstructed distribution style</span>
<span class="sd">        @:param overwrite: boolean - if style already in use for another distribution, overwrite it with the reconstructed distribution</span>
<span class="sd">        @:param accuracy: float - giving target accuracy during reconstruction. For example, 0.001</span>
<span class="sd">        @:param thin: boolean - enable/disable thinning after reconstruction</span>
<span class="sd">        @:param verbose: boolean - turn on/off verbosity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">accuracy</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Refining interpolation grid for angular distributions still TBD&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thin</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Thinning for angular distributions still TBD&quot;</span><span class="p">)</span>

        <span class="k">if</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span> <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">fudge.processing.resonances</span> <span class="k">import</span> <span class="n">reconstructResonances</span>
        <span class="kn">from</span> <span class="nn">fudge.gnds.productData.distributions</span> <span class="k">import</span> <span class="n">angular</span> <span class="k">as</span> <span class="n">angularModule</span>

        <span class="n">newStyle</span> <span class="o">=</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">angularDistributionReconstructed</span><span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span> <span class="p">)</span>       <span class="c1"># BRB6, FIXME - &#39;eval&#39; should not be hardwired.</span>

        <span class="n">distributions</span> <span class="o">=</span> <span class="n">reconstructResonances</span><span class="o">.</span><span class="n">reconstructAngularDistributions</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">distributions</span><span class="p">:</span>
            <span class="n">reaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span> <span class="n">key</span> <span class="p">)</span>
            <span class="c1"># Kludgy way to discern the product&#39;s name so we can look it up</span>
<span class="c1"># BRB6 hardwired.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;elastic&#39;</span><span class="p">:</span> <span class="n">productName</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
            <span class="k">else</span><span class="p">:</span>
<span class="c1"># BRB6 hardwired.</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="n">p</span><span class="o">.</span><span class="n">particle</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s1">&#39;amu&#39;</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">products</span> <span class="p">]</span>
                <span class="n">productName</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pairs</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># pick&#39;s the lightest product</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="o">.</span><span class="n">getProductWithName</span><span class="p">(</span><span class="n">productName</span><span class="p">)</span>
            <span class="n">original</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">angularSubform</span>
            <span class="n">reconstructed</span> <span class="o">=</span> <span class="n">distributions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="n">merged</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">regions2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">axes</span> <span class="p">)</span>     <span class="c1"># Caleb, FIXME - check that this is correct.</span>
            <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">reconstructed</span> <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">original</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span> <span class="p">):</span>
                <span class="n">newregion</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                        <span class="n">interpolationQualifier</span><span class="o">=</span><span class="n">original</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="p">)</span>
                <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">original</span><span class="o">.</span><span class="n">getAtEnergy</span><span class="p">(</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">original</span><span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">val</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">continue</span>
                    <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">val</span> <span class="p">)</span>
                <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">newregion</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">original</span><span class="p">,</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">regions2d</span> <span class="p">):</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">region</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original</span><span class="p">):</span>
                    <span class="k">if</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMax</span> <span class="o">&gt;</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">break</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">domainMin</span> <span class="o">!=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">newregion</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">XYs2d</span><span class="p">(</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
                            <span class="n">interpolationQualifier</span><span class="o">=</span><span class="n">region</span><span class="o">.</span><span class="n">interpolationQualifier</span> <span class="p">)</span>
                    <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">region</span><span class="o">.</span><span class="n">getAtEnergy</span><span class="p">(</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">region</span><span class="p">:</span>
                        <span class="k">if</span><span class="p">(</span> <span class="n">val</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">reconstructed</span><span class="o">.</span><span class="n">domainMax</span> <span class="p">)</span> <span class="p">:</span> <span class="k">continue</span>
                        <span class="n">newregion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">val</span> <span class="p">)</span>
                    <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">newregion</span> <span class="p">)</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">original</span><span class="p">[</span><span class="n">idx</span><span class="p">:]:</span>
                    <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">region</span> <span class="p">)</span>

            <span class="n">newForm</span> <span class="o">=</span> <span class="n">angularModule</span><span class="o">.</span><span class="n">twoBodyForm</span><span class="p">(</span> <span class="n">label</span> <span class="o">=</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">productFrame</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">evaluated</span><span class="o">.</span><span class="n">productFrame</span><span class="p">,</span> <span class="n">angularSubform</span> <span class="o">=</span> <span class="n">merged</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="p">:</span>
                <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="p">)</span>
            <span class="n">product</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">newForm</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">newStyle</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">newStyle</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.removeStyle"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.removeStyle">[docs]</a>    <span class="k">def</span> <span class="nf">removeStyle</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">style</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the given style everywhere it appears in this reactionSuite</span>
<span class="sd">        :param style: may be a style instance or its name</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">stylesModule</span><span class="o">.</span><span class="n">style</span><span class="p">):</span> <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">label</span>

        <span class="k">def</span> <span class="nf">removeStyleFromComponent</span><span class="p">(</span> <span class="n">styleName</span><span class="p">,</span> <span class="n">component</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">styleName</span> <span class="ow">in</span> <span class="n">component</span><span class="p">:</span>
                <span class="n">component</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">styleName</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">:</span>
            <span class="c1"># currently checks in cross section and deposition data, should also check multiplicity and distributions</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="s1">&#39;crossSection&#39;</span><span class="p">):</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">reaction</span><span class="o">.</span><span class="n">crossSection</span> <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reaction</span><span class="p">,</span> <span class="s1">&#39;outputChannel&#39;</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">:</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">product</span><span class="o">.</span><span class="n">energyDeposition</span> <span class="p">)</span>
                <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">product</span><span class="o">.</span><span class="n">momentumDeposition</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">product</span><span class="o">.</span><span class="n">outputChannel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">for</span> <span class="n">dproduct</span> <span class="ow">in</span> <span class="n">product</span><span class="o">.</span><span class="n">outputChannel</span><span class="p">:</span>
                    <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">dproduct</span><span class="o">.</span><span class="n">energyDeposition</span> <span class="p">)</span>
                    <span class="n">removeStyleFromComponent</span><span class="p">(</span> <span class="n">style</span><span class="p">,</span> <span class="n">dproduct</span><span class="o">.</span><span class="n">momentumDeposition</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">style</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.saveToOpenedFile"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.saveToOpenedFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveToOpenedFile</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">fOut</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">xmlString</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">fOut</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.saveToFile"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.saveToFile">[docs]</a>    <span class="k">def</span> <span class="nf">saveToFile</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save the reactionSuite in GNDS/xml structure to specified file.</span>
<span class="sd">        To suppress extra messages, change the &#39;verbosity&#39; flag:</span>
<span class="sd">            &gt;&gt;&gt;self.saveToFile( &quot;output.xml&quot;, flags={&#39;verbosity&#39;:0} )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span> <span class="n">fileName</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dirname</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span> <span class="n">dirname</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span> <span class="n">dirname</span> <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">fout</span> <span class="p">:</span>
<span class="c1"># BRB6 hardwired.</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveToOpenedFile</span><span class="p">(</span> <span class="n">fout</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.toXML"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.toXML">[docs]</a>    <span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="k">return</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.toXMLList"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.toXMLList">[docs]</a>    <span class="k">def</span> <span class="nf">toXMLList</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span> <span class="p">:</span>

        <span class="n">incrementalIndent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;incrementalIndent&#39;</span><span class="p">,</span> <span class="s1">&#39;  &#39;</span><span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="n">incrementalIndent</span>
        <span class="n">indent3</span> <span class="o">=</span> <span class="n">indent2</span> <span class="o">+</span> <span class="n">incrementalIndent</span>

        <span class="n">xmlString</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;</span><span class="si">%s</span><span class="s1"> projectile=&quot;</span><span class="si">%s</span><span class="s1">&quot; target=&quot;</span><span class="si">%s</span><span class="s1">&quot; evaluation=&quot;</span><span class="si">%s</span><span class="s1">&quot; format=&quot;</span><span class="si">%s</span><span class="s1">&quot; projectileFrame=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span>
            <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GNDS_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectileFrame</span> <span class="p">)</span> <span class="p">]</span>

        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># BRB6 documentation should have its own toXMLList.</span>
        <span class="n">xmlString</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;documentations&gt;&#39;</span> <span class="o">%</span> <span class="n">indent2</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentation</span> <span class="p">:</span> <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentation</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent3</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/documentations&gt;&#39;</span>

        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>

        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span> <span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xmlString</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applicationData</span><span class="o">.</span><span class="n">toXMLList</span><span class="p">(</span><span class="n">indent2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">xmlString</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&lt;/</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">xmlString</span> <span class="p">)</span></div>

<div class="viewcode-block" id="reactionSuite.toString"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.reactionSuite.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns a string representation of an reactionSuite.&quot;&quot;&quot;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputParticlesToReactionString</span><span class="p">(</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39; --&gt; &#39;</span> <span class="p">)</span>
        <span class="n">indent2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>
        <span class="n">indent3</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactions</span> <span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">channel</span><span class="o">.</span><span class="n">toString</span><span class="p">(</span> <span class="n">indent</span> <span class="o">=</span> <span class="n">indent3</span> <span class="p">)</span>
            <span class="n">indent3</span> <span class="o">=</span> <span class="n">indent2</span>
        <span class="k">return</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span></div></div>

<div class="viewcode-block" id="readXML"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.readXML">[docs]</a><span class="k">def</span> <span class="nf">readXML</span><span class="p">(</span> <span class="n">gndsFile</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a GNDS/xml file and create a new reactionSuite instance from the result.</span>

<span class="sd">    :param gndsFile: path to a GNDS file, as a string.</span>
<span class="sd">    :return: reactionSuite instance containing all data from the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">xml.etree</span> <span class="k">import</span> <span class="n">cElementTree</span>
    <span class="c1"># wrapper around the xml parser:</span>
    <span class="kn">from</span> <span class="nn">fudge.core.utilities.xmlNode</span> <span class="k">import</span> <span class="n">xmlNode</span>

    <span class="n">rsElement</span> <span class="o">=</span> <span class="n">cElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span> <span class="n">gndsFile</span> <span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">rsElement</span> <span class="o">=</span> <span class="n">xmlNode</span><span class="p">(</span> <span class="n">rsElement</span><span class="p">,</span> <span class="n">xmlNode</span><span class="o">.</span><span class="n">etree</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">rsElement</span> <span class="p">)</span></div>

<div class="viewcode-block" id="parseXMLNode"><a class="viewcode-back" href="../../../fudge/fudge.gnds.html#fudge.gnds.reactionSuite.parseXMLNode">[docs]</a><span class="k">def</span> <span class="nf">parseXMLNode</span><span class="p">(</span> <span class="n">rsElement</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Translates a &lt;reactionSuite&gt; xml node into a reactionSuite instance. Users should use the &#39;readXML&#39; function instead.&quot;&quot;&quot;</span>

    <span class="n">xPath</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reactionSuite&#39;</span><span class="p">]</span>   <span class="c1"># Keep track of location in the tree, in case errors come up.</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="n">GNDS_version</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;format&#39;</span> <span class="p">)</span>

        <span class="n">projectile</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;projectile&#39;</span> <span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;target&#39;</span> <span class="p">)</span>
        <span class="n">evaluation</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;evaluation&#39;</span> <span class="p">)</span>
        <span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s1">&#39;projectileFrame&#39;</span> <span class="p">)</span>

        <span class="n">rs</span> <span class="o">=</span> <span class="n">reactionSuite</span><span class="p">(</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">GNDS_version</span> <span class="o">=</span> <span class="n">GNDS_version</span><span class="p">,</span> <span class="n">projectileFrame</span> <span class="o">=</span> <span class="n">projectileFrame</span> <span class="p">)</span>

        <span class="n">linkData</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;reactionSuite&#39;</span> <span class="p">:</span> <span class="n">rs</span><span class="p">,</span> <span class="s1">&#39;unresolvedLinks&#39;</span> <span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;format&#39;</span> <span class="p">:</span> <span class="n">GNDS_version</span> <span class="p">}</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">styles</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;styles&#39;</span><span class="p">),</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">rs</span><span class="o">.</span><span class="n">PoPs</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;PoPs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">rsElement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s1">&#39;documentations&#39;</span> <span class="p">)</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">documents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">addDocumentation</span><span class="p">(</span> <span class="n">fudge</span><span class="o">.</span><span class="n">gnds</span><span class="o">.</span><span class="n">documentation</span><span class="o">.</span><span class="n">documentation</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">doc</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">rsElement</span> <span class="p">:</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span> <span class="s1">&#39;styles&#39;</span><span class="p">,</span> <span class="s1">&#39;documentations&#39;</span><span class="p">,</span> <span class="s1">&#39;PoPs&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
                <span class="k">continue</span>    <span class="c1"># already read above</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">suitesModule</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">externalFiles</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">fudge</span><span class="o">.</span><span class="n">gnds</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">moniker</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">addResonances</span><span class="p">(</span> <span class="n">fudge</span><span class="o">.</span><span class="n">gnds</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">resonances</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">))</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">reactions</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">orphanProducts</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">sums</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">productions</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">incompleteReactions</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span><span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">fissionComponents</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">elif</span><span class="p">(</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">rs</span><span class="o">.</span><span class="n">applicationData</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">rs</span><span class="o">.</span><span class="n">applicationData</span><span class="o">.</span><span class="n">parseXMLNode</span><span class="p">(</span> <span class="n">child</span><span class="p">,</span> <span class="n">xPath</span><span class="p">,</span> <span class="n">linkData</span> <span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Warning: encountered unexpected element &#39;</span><span class="si">%s</span><span class="s2">&#39; in reactionSuite!&quot;</span> <span class="o">%</span> <span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Error encountered at xpath = /</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">xPath</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">raise</span>

    <span class="c1"># Fix links.</span>
    <span class="k">for</span> <span class="n">quant</span> <span class="ow">in</span> <span class="n">linkData</span><span class="p">[</span><span class="s1">&#39;unresolvedLinks&#39;</span><span class="p">]</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">quant</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">reactionSuite</span><span class="o">.</span><span class="n">moniker</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">quant</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">quant</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span> <span class="n">rs</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">quant</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span> <span class="s1">&#39;/covarianceSuite&#39;</span> <span class="p">)</span> <span class="p">:</span>
            <span class="n">rs</span><span class="o">.</span><span class="n">_externalLinks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">quant</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>   <span class="c1"># relative link</span>
            <span class="n">quant</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">quant</span><span class="o">.</span><span class="n">follow</span><span class="p">(</span> <span class="n">quant</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span> <span class="n">rs</span> <span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/gnd.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Fudge and GNDS 4.2.3 beta documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, B.Beck, D. Brown, C. Mattoon, N. Patel, N. Summers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>